import{u as te,a as le,b as x,j as e}from"./query-CZD0ZRD-.js";import{r as c}from"./vendor-izpyVFLd.js";import{c as N}from"./index-CJixA8aD.js";import{a as d}from"./api-Tqb-OO70.js";import{p as K,t as P,a6 as ne,k as re,ao as ie,af as ce,al as de,m as k,av as oe,as as me,N as ue,b1 as $,a9 as M,at as xe,A as pe,X as he,aY as ge,O as be}from"./ui-CAO-iScS.js";import"./charts-Db6Lds24.js";const o="/admin",fe=async a=>(await d.get(`${o}/users`,{params:a})).data,ye=async a=>(await d.post(`${o}/users`,a)).data.data.user,je=async(a,l=!1)=>{await d.delete(`${o}/users/${a}`,{params:{hard:l}})},ve=async a=>(await d.post(`${o}/users/${a}/activate`)).data.data.user,Ne=async a=>(await d.post(`${o}/users/${a}/deactivate`)).data.data.user,ke=async(a,l)=>(await d.post(`${o}/users/${a}/reset-password`,{new_password:l})).data.data,we=async a=>(await d.post(`${o}/users/bulk`,a)).data.data,Se=[{key:"all",label:"Tüm Roller"},{key:"student",label:"Öğrenci"},{key:"teacher",label:"Öğretmen"},{key:"admin",label:"Admin"}],_e=[{key:"all",label:"Tüm Durumlar"},{key:"active",label:"Aktif"},{key:"inactive",label:"Pasif"},{key:"pending",label:"Beklemede"}];function $e(){var C,U;const a=te(),[l,S]=c.useState(""),[g,E]=c.useState("all"),[b,R]=c.useState("all"),[i,f]=c.useState([]),[p,_]=c.useState(1),[F,h]=c.useState(!1),[r,m]=c.useState({email:"",first_name:"",last_name:"",password:"",role:"student"}),{data:w,isLoading:T,error:q}=le({queryKey:["adminUsers",{page:p,role:g,status:b,search:l}],queryFn:()=>fe({page:p,per_page:20,role:g!=="all"?g:void 0,is_active:b==="active"?!0:b==="inactive"?!1:void 0,search:l||void 0})}),z=x({mutationFn:s=>ve(s),onSuccess:()=>{a.invalidateQueries({queryKey:["adminUsers"]})}}),Q=x({mutationFn:s=>Ne(s),onSuccess:()=>{a.invalidateQueries({queryKey:["adminUsers"]})}}),B=x({mutationFn:s=>je(s),onSuccess:()=>{a.invalidateQueries({queryKey:["adminUsers"]})}}),y=x({mutationFn:ye,onSuccess:()=>{a.invalidateQueries({queryKey:["adminUsers"]}),h(!1),m({email:"",first_name:"",last_name:"",password:"",role:"student"})}}),L=x({mutationFn:s=>ke(s),onSuccess:s=>{alert(`Geçici şifre: ${s.temporary_password}`)}}),j=x({mutationFn:s=>we(s),onSuccess:()=>{a.invalidateQueries({queryKey:["adminUsers"]}),f([])}}),Y=c.useMemo(()=>{var t;const s=w;return((t=s==null?void 0:s.data)==null?void 0:t.users)||(s==null?void 0:s.users)||[]},[w]),n=w,G=((C=n==null?void 0:n.data)==null?void 0:C.total)||(n==null?void 0:n.total)||0,A=((U=n==null?void 0:n.data)==null?void 0:U.pages)||(n==null?void 0:n.pages)||1,u=Y,O=s=>{switch(s){case"admin":case"super_admin":return e.jsx("span",{className:"badge bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",children:"Admin"});case"teacher":return e.jsx("span",{className:"badge bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:"Öğretmen"});case"student":return e.jsx("span",{className:"badge bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:"Öğrenci"});default:return e.jsx("span",{className:"badge",children:s})}},X=s=>s.is_verified?s.is_active?e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(M,{className:"h-4 w-4"})," Aktif"]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx($,{className:"h-4 w-4"})," Pasif"]}):e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(be,{className:"h-4 w-4"})," Beklemede"]}),V=s=>{f(t=>t.includes(s)?t.filter(v=>v!==s):[...t,s])},H=()=>{i.length===u.length?f([]):f(u.map(s=>s.id))},J=async s=>{await z.mutateAsync(s)},W=async s=>{await Q.mutateAsync(s)},Z=async s=>{confirm("Bu kullanıcıyı silmek istediğinize emin misiniz?")&&await B.mutateAsync(s)},I=async s=>{await L.mutateAsync(s)},ee=async()=>{confirm(`${i.length} kullanıcıyı deaktive etmek istediğinize emin misiniz?`)&&await j.mutateAsync({action:"deactivate",user_ids:i})},se=async()=>{confirm(`${i.length} kullanıcıyı silmek istediğinize emin misiniz?`)&&await j.mutateAsync({action:"delete",user_ids:i})},ae=async()=>{if(!r.email||!r.first_name||!r.last_name||!r.password){alert("Tüm alanları doldurun");return}await y.mutateAsync(r)};return T?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Kullanıcılar yükleniyor..."})]})}):q?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Kullanıcılar yüklenirken hata oluştu"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Kullanıcı Yönetimi"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Sisteme kayıtlı tüm kullanıcıları yönetin"})]}),e.jsxs("button",{onClick:()=>h(!0),className:N("flex items-center gap-2 px-4 py-2 rounded-lg font-medium","bg-primary text-primary-foreground hover:bg-primary/90 transition-colors"),children:[e.jsx(ne,{className:"h-4 w-4"}),"Yeni Kullanıcı"]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx("input",{type:"text",value:l,onChange:s=>S(s.target.value),placeholder:"İsim veya e-posta ara...",className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("select",{value:g,onChange:s=>E(s.target.value),className:"px-3 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/50",children:Se.map(s=>e.jsx("option",{value:s.key,children:s.label},s.key))})]}),e.jsx("select",{value:b,onChange:s=>R(s.target.value),className:"px-3 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/50",children:_e.map(s=>e.jsx("option",{value:s.key,children:s.label},s.key))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:N("flex items-center gap-2 px-3 py-2 rounded-lg text-sm","border hover:bg-muted transition-colors"),children:[e.jsx(ce,{className:"h-4 w-4"}),"Dışa Aktar"]}),e.jsxs("button",{className:N("flex items-center gap-2 px-3 py-2 rounded-lg text-sm","border hover:bg-muted transition-colors"),children:[e.jsx(de,{className:"h-4 w-4"}),"İçe Aktar"]})]})]}),i.length>0&&e.jsxs(k.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-4 p-3 bg-primary/10 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium",children:[i.length," kullanıcı seçildi"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 text-sm rounded hover:bg-primary/20",onClick:ee,disabled:j.isPending,children:"Deaktive Et"}),e.jsx("button",{className:"px-3 py-1 text-sm rounded hover:bg-primary/20",children:"E-posta Gönder"}),e.jsx("button",{className:"px-3 py-1 text-sm text-destructive rounded hover:bg-destructive/10",onClick:se,disabled:j.isPending,children:"Sil"})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-cell w-10",children:e.jsx("input",{type:"checkbox",checked:i.length===u.length&&u.length>0,onChange:H,className:"rounded"})}),e.jsx("th",{className:"table-cell text-left",children:"Kullanıcı"}),e.jsx("th",{className:"table-cell text-left",children:"Rol"}),e.jsx("th",{className:"table-cell text-left",children:"Durum"}),e.jsx("th",{className:"table-cell text-left",children:"Kayıt Tarihi"}),e.jsx("th",{className:"table-cell text-left",children:"Son Giriş"}),e.jsx("th",{className:"table-cell w-10"})]})}),e.jsx("tbody",{children:u.map((s,t)=>{var v,D;return e.jsxs(k.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:t*.02},className:"table-row",children:[e.jsx("td",{className:"table-cell",children:e.jsx("input",{type:"checkbox",checked:i.includes(s.id),onChange:()=>V(s.id),className:"rounded"})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-medium text-primary",children:[((v=s.first_name)==null?void 0:v[0])||"",((D=s.last_name)==null?void 0:D[0])||""]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx("td",{className:"table-cell",children:O(s.role)}),e.jsx("td",{className:"table-cell text-sm",children:X(s)}),e.jsx("td",{className:"table-cell text-sm text-muted-foreground",children:s.created_at?new Date(s.created_at).toLocaleDateString("tr-TR"):"-"}),e.jsx("td",{className:"table-cell text-sm text-muted-foreground",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString("tr-TR"):"-"}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:"p-1 hover:bg-muted rounded",children:e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-40 bg-background border rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:[e.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-2 text-sm hover:bg-muted",children:[e.jsx(me,{className:"h-4 w-4"})," Düzenle"]}),e.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-2 text-sm hover:bg-muted",onClick:()=>I(s.id),children:[e.jsx(ue,{className:"h-4 w-4"})," Şifre Sıfırla"]}),s.is_active?e.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-2 text-sm hover:bg-muted",onClick:()=>W(s.id),children:[e.jsx($,{className:"h-4 w-4"})," Deaktive Et"]}):e.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-2 text-sm hover:bg-muted",onClick:()=>J(s.id),children:[e.jsx(M,{className:"h-4 w-4"})," Aktive Et"]}),e.jsx("hr",{className:"my-1"}),e.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-destructive hover:bg-destructive/10",onClick:()=>Z(s.id),children:[e.jsx(xe,{className:"h-4 w-4"})," Sil"]})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Toplam ",G," kullanıcıdan ",u.length," tanesi gösteriliyor"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 text-sm border rounded hover:bg-muted disabled:opacity-50",disabled:p===1,onClick:()=>_(s=>Math.max(1,s-1)),children:"Önceki"}),e.jsxs("span",{className:"px-3 py-1 text-sm",children:["Sayfa ",p," / ",A]}),e.jsx("button",{className:"px-3 py-1 text-sm border rounded hover:bg-muted disabled:opacity-50",disabled:p>=A,onClick:()=>_(s=>s+1),children:"Sonraki"})]})]})]}),e.jsx(pe,{children:F&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>h(!1),children:e.jsx(k.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-background rounded-xl shadow-xl w-full max-w-md border",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Yeni Kullanıcı Ekle"}),e.jsx("button",{onClick:()=>h(!1),className:"p-2 hover:bg-muted rounded-lg",children:e.jsx(he,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ad *"}),e.jsx("input",{type:"text",value:r.first_name,onChange:s=>m(t=>({...t,first_name:s.target.value})),placeholder:"Ad",className:"w-full px-3 py-2 border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Soyad *"}),e.jsx("input",{type:"text",value:r.last_name,onChange:s=>m(t=>({...t,last_name:s.target.value})),placeholder:"Soyad",className:"w-full px-3 py-2 border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:r.email,onChange:s=>m(t=>({...t,email:s.target.value})),placeholder:"kullanici@email.com",className:"w-full px-3 py-2 border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Şifre *"}),e.jsx("input",{type:"password",value:r.password,onChange:s=>m(t=>({...t,password:s.target.value})),placeholder:"••••••••",className:"w-full px-3 py-2 border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rol"}),e.jsxs("select",{value:r.role,onChange:s=>m(t=>({...t,role:s.target.value})),className:"w-full px-3 py-2 border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary/50",children:[e.jsx("option",{value:"student",children:"Öğrenci"}),e.jsx("option",{value:"teacher",children:"Öğretmen"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-muted transition-colors",children:"İptal"}),e.jsx("button",{onClick:ae,disabled:y.isPending,className:N("flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium","bg-primary text-primary-foreground hover:bg-primary/90 transition-colors","disabled:opacity-50 disabled:cursor-not-allowed"),children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 animate-spin"}),"Kaydediliyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"}),"Kaydet"]})})]}),y.isError&&e.jsxs("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-sm text-destructive",children:[e.jsx(P,{className:"h-4 w-4 inline mr-2"}),"Kullanıcı oluşturulurken hata oluştu. Lütfen tekrar deneyin."]})]})})})})]})}export{$e as default};
