import{u as L,b as A,j as e}from"./query-CZD0ZRD-.js";import{b as B,f as F,r}from"./vendor-izpyVFLd.js";import{B as m,c as p,I as b}from"./index-CJixA8aD.js";import{aU as G,al as K,m as I,t as O,X as q,aV as z,p as U,aW as D,y as Q,a6 as _,aS as J,V as W,q as X,E as Z,at as H,Q as ee}from"./ui-CAO-iScS.js";import"./charts-Db6Lds24.js";function ie(){const j=B(),{courseId:g,topicId:P}=F(),S=L(),y=r.useRef(null),[d,N]=r.useState("youtube"),[i,x]=r.useState([]),[l,c]=r.useState({title:"",description:"",youtubeUrl:"",duration:0,isPublished:!1,orderIndex:i.length}),[v,w]=r.useState(!1),[k,f]=r.useState(0),[C,o]=r.useState(null),h=s=>{const t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/^([a-zA-Z0-9_-]{11})$/];for(const a of t){const n=s.match(a);if(n)return n[1]}return null},E=s=>h(s)!==null,Y=async s=>{c(a=>({...a,youtubeUrl:s})),h(s)&&o(null)},M=()=>{if(!l.title.trim()){o("Video başlığı gerekli");return}if(d==="youtube"&&!E(l.youtubeUrl)){o("Geçerli bir YouTube URL'si girin");return}x(s=>[...s,{...l,orderIndex:s.length}]),c({title:"",description:"",youtubeUrl:"",duration:0,isPublished:!1,orderIndex:i.length+1}),o(null)},T=s=>{x(t=>t.filter((a,n)=>n!==s))},$=s=>{x(t=>t.map((a,n)=>n===s?{...a,isPublished:!a.isPublished}:a))},u=A({mutationFn:async()=>{const s=await fetch(`/api/v1/courses/${g}/topics/${P}/videos`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videos:i})});if(!s.ok)throw new Error("Videolar kaydedilemedi");return s.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["course",g]}),j(`/courses/${g}/manage`)},onError:s=>{o(s.message)}}),R=async s=>{if(!s||s.length===0)return;w(!0),f(0);const t=setInterval(()=>{f(a=>a>=100?(clearInterval(t),100):a+10)},500);setTimeout(()=>{clearInterval(t),w(!1),f(100)},5e3)},V=h(l.youtubeUrl);return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Video Ekle"}),e.jsx("p",{className:"text-muted-foreground",children:"Kursunuza yeni videolar ekleyin"})]}),e.jsx(m,{variant:"outline",onClick:()=>j(-1),children:"Geri"})]}),e.jsxs("div",{className:"flex gap-2 p-1 bg-muted rounded-lg w-fit",children:[e.jsxs("button",{onClick:()=>N("youtube"),className:p("flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all",d==="youtube"?"bg-background shadow text-primary":"text-muted-foreground hover:text-foreground"),children:[e.jsx(G,{className:"h-4 w-4"}),"YouTube URL"]}),e.jsxs("button",{onClick:()=>N("upload"),className:p("flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all",d==="upload"?"bg-background shadow text-primary":"text-muted-foreground hover:text-foreground"),children:[e.jsx(K,{className:"h-4 w-4"}),"Dosya Yükle"]})]}),C&&e.jsxs(I.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2 p-4 bg-destructive/10 text-destructive rounded-lg",children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{children:C}),e.jsx("button",{onClick:()=>o(null),className:"ml-auto",children:e.jsx(q,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"bg-card border rounded-xl p-6 space-y-4",children:[e.jsx("h2",{className:"font-semibold",children:"Yeni Video"}),d==="youtube"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"YouTube URL"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(b,{placeholder:"https://www.youtube.com/watch?v=...",value:l.youtubeUrl,onChange:s=>Y(s.target.value),leftIcon:e.jsx(z,{className:"h-4 w-4"})})}),V&&e.jsx("div",{className:"aspect-video w-full max-w-md rounded-lg overflow-hidden bg-muted",children:e.jsx("iframe",{src:`https://www.youtube.com/embed/${V}`,className:"w-full h-full",allowFullScreen:!0})})]}),d==="upload"&&e.jsxs("div",{className:p("border-2 border-dashed rounded-xl p-8 text-center transition-colors",v?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary"),children:[e.jsx("input",{ref:y,type:"file",accept:"video/*",className:"hidden",onChange:s=>R(s.target.files)}),v?e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{className:"h-12 w-12 mx-auto text-primary animate-spin"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Yükleniyor..."}),e.jsx("div",{className:"w-full max-w-xs mx-auto h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${k}%`}})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[k,"%"]})]})]}):e.jsxs("div",{className:"cursor-pointer",onClick:()=>{var s;return(s=y.current)==null?void 0:s.click()},children:[e.jsx(D,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"font-medium",children:"Video dosyası yükleyin"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"MP4, MOV, AVI • Maks 500MB"}),e.jsx(m,{variant:"outline",className:"mt-4",children:"Dosya Seç"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Video Başlığı *"}),e.jsx(b,{placeholder:"Ders 1: Giriş",value:l.title,onChange:s=>c(t=>({...t,title:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Süre (dakika)"}),e.jsx(b,{type:"number",placeholder:"15",value:l.duration||"",onChange:s=>c(t=>({...t,duration:parseInt(s.target.value)||0})),leftIcon:e.jsx(Q,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Açıklama"}),e.jsx("textarea",{className:"w-full min-h-[100px] rounded-lg border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Bu videoda neler öğrenilecek...",value:l.description,onChange:s=>c(t=>({...t,description:s.target.value}))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{onClick:M,leftIcon:e.jsx(_,{className:"h-4 w-4"}),children:"Listeye Ekle"})})]}),i.length>0&&e.jsxs("div",{className:"bg-card border rounded-xl p-6 space-y-4",children:[e.jsxs("h2",{className:"font-semibold",children:["Eklenecek Videolar (",i.length,")"]}),e.jsx("div",{className:"space-y-2",children:i.map((s,t)=>e.jsxs(I.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg group",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground cursor-grab"}),e.jsx("div",{className:"h-10 w-16 bg-muted rounded flex items-center justify-center",children:s.youtubeUrl?e.jsx("img",{src:`https://img.youtube.com/vi/${h(s.youtubeUrl)}/default.jpg`,alt:"",className:"h-full w-full object-cover rounded"}):e.jsx(W,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.duration>0&&`${s.duration} dk`})]}),e.jsx("button",{onClick:()=>$(t),className:p("p-2 rounded-lg transition-colors",s.isPublished?"text-green-600 bg-green-100":"text-muted-foreground bg-muted"),children:s.isPublished?e.jsx(X,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>T(t),className:"p-2 rounded-lg text-destructive hover:bg-destructive/10 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(H,{className:"h-4 w-4"})})]},t))}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(m,{variant:"outline",onClick:()=>x([]),disabled:u.isPending,children:"Temizle"}),e.jsx(m,{onClick:()=>u.mutate(),disabled:u.isPending,leftIcon:u.isPending?e.jsx(U,{className:"h-4 w-4 animate-spin"}):e.jsx(ee,{className:"h-4 w-4"}),children:u.isPending?"Kaydediliyor...":"Videoları Kaydet"})]})]})]})}export{ie as default};
