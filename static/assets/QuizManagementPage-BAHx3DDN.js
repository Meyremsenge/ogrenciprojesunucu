import{j as e}from"./query-CZD0ZRD-.js";import{r as m}from"./vendor-izpyVFLd.js";import{B as o,I as f}from"./index-D2ID2HJ6.js";import{a as h}from"./api-CsRKlOc7.js";import{F as E,a5 as w,i as ce,n as K,d as oe,w as de,ax as me,aA as xe,aq as ue,as as R,a1 as $,X as O,q as he,b0 as pe,r as ge,g as H,aZ as je}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";const V=[{value:"1",label:"1. Sınıf"},{value:"2",label:"2. Sınıf"},{value:"3",label:"3. Sınıf"},{value:"4",label:"4. Sınıf"},{value:"5",label:"5. Sınıf"},{value:"6",label:"6. Sınıf"},{value:"7",label:"7. Sınıf"},{value:"8",label:"8. Sınıf"},{value:"9",label:"9. Sınıf"},{value:"10",label:"10. Sınıf"},{value:"11",label:"11. Sınıf"},{value:"12",label:"12. Sınıf"},{value:"tyt",label:"TYT"},{value:"ayt",label:"AYT"}],y=()=>({question_text:"",question_type:"single_choice",points:10,answers:[{answer_text:"",is_correct:!0},{answer_text:"",is_correct:!1},{answer_text:"",is_correct:!1},{answer_text:"",is_correct:!1}]}),X=()=>({title:"",description:"",exam_type:"quiz",grade_level:"",duration_minutes:30,pass_score:60,max_attempts:1});function _e(){const[Z,D]=m.useState([]),[J,T]=m.useState(!0),[Y,U]=m.useState(""),[W,v]=m.useState(!1),[_,k]=m.useState(1),[g,L]=m.useState(null),[A,F]=m.useState(!1),[n,p]=m.useState(X()),[r,u]=m.useState([y()]),[l,j]=m.useState(0),N=m.useCallback(async()=>{var s,a,t;try{T(!0);const i=await h.get("/exams",{params:{exam_type:"quiz"}}),d=((a=(s=i.data)==null?void 0:s.data)==null?void 0:a.items)||((t=i.data)==null?void 0:t.items)||[];D(d)}catch(i){console.error("Quiz listesi yüklenemedi:",i),D([])}finally{T(!1)}},[]);m.useEffect(()=>{N()},[N]);const I=()=>{L(null),p(X()),u([y()]),j(0),k(1),v(!0)},ee=async s=>{var a,t;L(s),p({title:s.title,description:s.description||"",exam_type:s.exam_type,grade_level:s.grade_level||"",duration_minutes:s.duration_minutes,pass_score:s.pass_score,max_attempts:s.max_attempts});try{const d=((t=(a=(await h.get(`/exams/${s.id}/questions`)).data)==null?void 0:a.data)==null?void 0:t.questions)||[];u(d.length>0?d:[y()])}catch{u([y()])}j(0),k(1),v(!0)},se=()=>{if(!n.title.trim()){alert("Lütfen quiz başlığı girin");return}if(!n.grade_level){alert("Lütfen kademe seçin");return}k(2)},z=(s,a)=>{const t=[...r];t[l]={...t[l],[s]:a},u(t)},M=(s,a,t)=>{const i=[...r],d=[...i[l].answers];a==="is_correct"&&t===!0?d.forEach((C,S)=>{C.is_correct=S===s}):d[s]={...d[s],[a]:t},i[l].answers=d,u(i)},P=()=>{u([...r,y()]),j(r.length)},ae=s=>{if(r.length<=1)return;const a=r.filter((t,i)=>i!==s);u(a),j(Math.min(l,a.length-1))},te=()=>{const s=[...r];s[l].answers.push({answer_text:"",is_correct:!1}),u(s)},le=s=>{const a=[...r];a[l].answers.length<=2||(a[l].answers=a[l].answers.filter((t,i)=>i!==s),u(a))},re=async()=>{var a,t,i,d,C,S,B;const s=r.filter(x=>x.question_text.trim()&&x.answers.filter(c=>c.answer_text.trim()).length>=2&&x.answers.some(c=>c.is_correct&&c.answer_text.trim()));if(s.length===0){alert("En az bir geçerli soru eklemelisiniz (soru metni + en az 2 cevap + 1 doğru cevap)");return}try{F(!0);let x=g==null?void 0:g.id;if(g)await h.put(`/exams/${g.id}`,n);else{const c=await h.post("/exams",n);x=((i=(t=(a=c.data)==null?void 0:a.data)==null?void 0:t.exam)==null?void 0:i.id)||((C=(d=c.data)==null?void 0:d.data)==null?void 0:C.id)}if(!x)throw new Error("Quiz ID alınamadı");for(const c of s){const G={question_text:c.question_text,question_type:c.question_type,points:c.points,answers:c.answers.filter(Q=>Q.answer_text.trim()).map(Q=>({answer_text:Q.answer_text,is_correct:Q.is_correct}))};c.id?await h.put(`/exams/questions/${c.id}`,G):await h.post(`/exams/${x}/questions`,G)}v(!1),N(),alert("Quiz başarıyla kaydedildi!")}catch(x){console.error("Quiz kaydetme hatası:",x),alert(((B=(S=x.response)==null?void 0:S.data)==null?void 0:B.message)||"Quiz kaydedilemedi")}finally{F(!1)}},ne=async s=>{if(confirm(`"${s.title}" quizini silmek istediğinize emin misiniz?`))try{await h.delete(`/exams/${s.id}`),N()}catch(a){console.error("Silme hatası:",a),alert("Quiz silinemedi")}},ie=async s=>{try{s.status==="draft"?await h.post(`/exams/${s.id}/publish`):await h.post(`/exams/${s.id}/unpublish`),N()}catch(a){console.error("Yayım hatası:",a),alert("İşlem başarısız")}},q=Z.filter(s=>s.title.toLowerCase().includes(Y.toLowerCase())),b=r[l];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(E,{className:"h-7 w-7 text-primary"}),"Quiz Yönetimi"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Quiz oluşturun ve yönetin"})]}),e.jsxs(o,{onClick:I,className:"gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Yeni Quiz"]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(f,{placeholder:"Quiz ara...",value:Y,onChange:s=>U(s.target.value),className:"pl-10"})]}),J?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-primary"})}):q.length===0?e.jsxs("div",{className:"bg-card border rounded-xl p-12 text-center",children:[e.jsx(E,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Henüz quiz yok"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"İlk quizinizi oluşturun"}),e.jsxs(o,{onClick:I,className:"gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Quiz Oluştur"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(s=>{var a;return e.jsxs("div",{className:"bg-card border rounded-xl p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground truncate mt-1",children:s.description})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.status==="published"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:s.status==="published"?"Yayında":"Taslak"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:((a=V.find(t=>t.value===s.grade_level))==null?void 0:a.label)||s.grade_level||"-"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.duration_minutes," dakika"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.total_questions||0," soru"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>ee(s),className:"flex-1",children:[e.jsx(me,{className:"h-4 w-4 mr-1"})," Düzenle"]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>ie(s),className:s.status==="published"?"text-orange-600":"text-green-600",children:s.status==="published"?e.jsx(xe,{className:"h-4 w-4"}):e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>ne(s),className:"text-red-600",children:e.jsx(R,{className:"h-4 w-4"})})]})]},s.id)})}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-background rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:g?"Quiz Düzenle":"Yeni Quiz Oluştur"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:`px-3 py-1 rounded-full ${_===1?"bg-primary text-white":"bg-muted"}`,children:"1. Bilgiler"}),e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:`px-3 py-1 rounded-full ${_===2?"bg-primary text-white":"bg-muted"}`,children:"2. Sorular"})]})]}),e.jsx("button",{onClick:()=>v(!1),className:"p-2 hover:bg-muted rounded-lg",children:e.jsx(O,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:_===1?e.jsxs("div",{className:"space-y-4 max-w-xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quiz Başlığı *"}),e.jsx(f,{value:n.title,onChange:s=>p({...n,title:s.target.value}),placeholder:"Örn: Matematik Tarama Testi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Açıklama"}),e.jsx("textarea",{value:n.description,onChange:s=>p({...n,description:s.target.value}),placeholder:"Quiz hakkında kısa açıklama...",className:"w-full min-h-[80px] rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kademe/Sınıf *"}),e.jsxs("select",{value:n.grade_level,onChange:s=>p({...n,grade_level:s.target.value}),className:"w-full h-10 rounded-md border border-input bg-background px-3 text-sm",children:[e.jsx("option",{value:"",children:"Seçin..."}),V.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Süre (dk)"}),e.jsx(f,{type:"number",min:5,max:180,value:n.duration_minutes,onChange:s=>p({...n,duration_minutes:parseInt(s.target.value)||30})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Geçme (%)"}),e.jsx(f,{type:"number",min:0,max:100,value:n.pass_score,onChange:s=>p({...n,pass_score:parseInt(s.target.value)||60})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Max Deneme"}),e.jsx(f,{type:"number",min:1,max:10,value:n.max_attempts,onChange:s=>p({...n,max_attempts:parseInt(s.target.value)||1})})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted/50 rounded-lg overflow-x-auto",children:[r.map((s,a)=>e.jsx("button",{onClick:()=>j(a),className:`flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center text-sm font-medium transition-all ${l===a?"bg-primary text-white":s.question_text.trim()?"bg-green-100 text-green-700 border border-green-300":"bg-white border"}`,children:a+1},a)),e.jsx("button",{onClick:P,className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center border-2 border-dashed border-primary/50 text-primary hover:bg-primary/10",children:e.jsx(w,{className:"h-5 w-5"})}),e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:[r.filter(s=>s.question_text.trim()).length,"/",r.length," tamamlandı"]})]}),b&&e.jsxs("div",{className:"bg-card border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium",children:["Soru ",l+1]}),r.length>1&&e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>ae(l),className:"text-red-500",children:[e.jsx(R,{className:"h-4 w-4 mr-1"})," Sil"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Soru Metni *"}),e.jsx("textarea",{value:b.question_text,onChange:s=>z("question_text",s.target.value),placeholder:"Sorunuzu buraya yazın...",className:"w-full min-h-[100px] rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Soru Tipi"}),e.jsxs("select",{value:b.question_type,onChange:s=>z("question_type",s.target.value),className:"w-full h-10 rounded-md border border-input bg-background px-3 text-sm",children:[e.jsx("option",{value:"single_choice",children:"Tek Seçimli"}),e.jsx("option",{value:"multiple_choice",children:"Çok Seçimli"}),e.jsx("option",{value:"true_false",children:"Doğru/Yanlış"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Puan"}),e.jsx(f,{type:"number",min:1,max:100,value:b.points,onChange:s=>z("points",parseInt(s.target.value)||10)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Cevap Seçenekleri"}),e.jsxs(o,{variant:"ghost",size:"sm",onClick:te,className:"text-primary",children:[e.jsx(w,{className:"h-4 w-4 mr-1"})," Seçenek Ekle"]})]}),e.jsx("div",{className:"space-y-2",children:b.answers.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>M(a,"is_correct",!s.is_correct),className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-colors ${s.is_correct?"bg-green-500 text-white":"bg-gray-200 hover:bg-gray-300"}`,title:s.is_correct?"Doğru cevap":"Doğru olarak işaretle",children:s.is_correct?e.jsx(he,{className:"h-5 w-5"}):e.jsx(pe,{className:"h-5 w-5"})}),e.jsx(f,{value:s.answer_text,onChange:t=>M(a,"answer_text",t.target.value),placeholder:`${String.fromCharCode(65+a)}) Cevap seçeneği`,className:"flex-1"}),b.answers.length>2&&e.jsx("button",{onClick:()=>le(a),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx(O,{className:"h-4 w-4"})})]},a))}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),"Yeşil daire doğru cevabı gösterir. Tıklayarak değiştirebilirsiniz."]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs(o,{variant:"outline",onClick:()=>j(Math.max(0,l-1)),disabled:l===0,children:[e.jsx(H,{className:"h-4 w-4 mr-1"})," Önceki"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l+1," / ",r.length]}),l<r.length-1?e.jsxs(o,{variant:"outline",onClick:()=>j(l+1),children:["Sonraki ",e.jsx($,{className:"h-4 w-4 ml-1"})]}):e.jsxs(o,{variant:"outline",onClick:P,className:"text-primary",children:[e.jsx(w,{className:"h-4 w-4 mr-1"})," Yeni Soru"]})]})]})]})}),e.jsx("div",{className:"flex items-center justify-between p-4 border-t bg-muted/30",children:_===1?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",onClick:()=>v(!1),children:"İptal"}),e.jsxs(o,{onClick:se,className:"gap-2",children:["Sorulara Geç ",e.jsx($,{className:"h-4 w-4"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"outline",onClick:()=>k(1),children:[e.jsx(H,{className:"h-4 w-4 mr-1"})," Bilgilere Dön"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[r.filter(s=>s.question_text.trim()).length," soru hazır"]}),e.jsx(o,{onClick:re,disabled:A,className:"gap-2",children:A?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 animate-spin"})," Kaydediliyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4"})," ",g?"Güncelle":"Kaydet"]})})]})]})})]})})]})}export{_e as default};
