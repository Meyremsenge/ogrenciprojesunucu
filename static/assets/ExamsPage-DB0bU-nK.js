import{a as k,j as s}from"./query-CZD0ZRD-.js";import{r as i,L as f}from"./vendor-izpyVFLd.js";import{c as a}from"./index-D2ID2HJ6.js";import{g as E,a as Q}from"./examService-oLBGGbW_.js";import{n as M,F as p,a0 as b,C as _,q as B,i as G,an as K,m as R,w as Y,o as $,r as D}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";import"./api-CsRKlOc7.js";const I=[{key:"all",label:"Tümü"},{key:"available",label:"Alınabilir"},{key:"upcoming",label:"Yaklaşan"},{key:"completed",label:"Tamamlanan"},{key:"failed",label:"Başarısız"}];function X(){const[c,A]=i.useState(""),[d,C]=i.useState("all"),{data:o,isLoading:L}=k({queryKey:["exams"],queryFn:()=>E({status:"published"})}),{data:y}=k({queryKey:["myAttempts"],queryFn:()=>Q()}),r=i.useMemo(()=>{var n;const e=((n=o==null?void 0:o.data)==null?void 0:n.exams)||[],l=y||[];return e.map(t=>{var w;const g=l.filter(T=>T.exam_id===t.id),F=g.length,x=g[g.length-1],h=x==null?void 0:x.score,v=new Date,N=t.start_time?new Date(t.start_time):null,S=t.due_date||t.end_time?new Date(t.due_date||t.end_time):null;let m="available";return N&&N>v?m="upcoming":h!==void 0?m=h>=t.passing_score?"completed":"failed":S&&S<v&&(m="expired"),{...t,usedAttempts:F,lastScore:h,userStatus:m,course:t.course_title||((w=t.course)==null?void 0:w.title)||"Kurs",type:t.exam_type||"quiz",questions:t.question_count||0,duration:t.duration_minutes||0,passingScore:t.passing_score||50,attempts:t.max_attempts||1,dueDate:t.due_date||t.end_time||new Date().toISOString()}})},[o,y]),j=i.useMemo(()=>r.filter(e=>{const l=e.title.toLowerCase().includes(c.toLowerCase())||e.course&&e.course.toLowerCase().includes(c.toLowerCase()),n=d==="all"||e.userStatus===d;return l&&n}),[r,c,d]),u=i.useMemo(()=>({total:r.length,available:r.filter(e=>e.userStatus==="available").length,upcoming:r.filter(e=>e.userStatus==="upcoming").length,completed:r.filter(e=>e.userStatus==="completed").length}),[r]),q=(e,l,n)=>{switch(e){case"available":return s.jsx("span",{className:"badge badge-primary",children:"Alınabilir"});case"upcoming":return s.jsx("span",{className:"badge bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",children:"Yaklaşan"});case"completed":return s.jsx("span",{className:"badge badge-success",children:"Tamamlandı"});case"failed":return s.jsx("span",{className:"badge badge-destructive",children:"Başarısız"});case"expired":return s.jsx("span",{className:"badge bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400",children:"Süresi Doldu"});default:return null}},z=e=>{switch(e){case"quiz":return"Quiz";case"exam":return"Sınav";case"midterm":return"Ara Sınav";case"final":return"Final";case"assignment":return"Ödev";default:return e}};return L?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx(M,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Sınavlar yükleniyor..."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Sınavlarım"}),s.jsx("p",{className:"text-muted-foreground mt-1",children:"Quiz, sınav ve ödevlerinizi buradan takip edebilirsiniz"})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Toplam",value:u.total,icon:p,color:"text-primary"},{label:"Alınabilir",value:u.available,icon:b,color:"text-green-500"},{label:"Yaklaşan",value:u.upcoming,icon:_,color:"text-yellow-500"},{label:"Tamamlanan",value:u.completed,icon:B,color:"text-blue-500"}].map(e=>s.jsx("div",{className:"card p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(e.icon,{className:a("h-8 w-8",e.color)}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold",children:e.value}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e.label})]})]})},e.label))}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),s.jsx("input",{type:"text",value:c,onChange:e=>A(e.target.value),placeholder:"Sınav veya kurs ara...",className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),s.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[s.jsx(K,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),I.map(e=>s.jsx("button",{onClick:()=>C(e.key),className:a("px-4 py-2 rounded-lg text-sm whitespace-nowrap transition-colors",d===e.key?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"),children:e.label},e.key))]})]}),s.jsx("div",{className:"space-y-4",children:j.map((e,l)=>s.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:l*.05},children:s.jsxs("div",{className:"card p-4 hover:shadow-lg transition-shadow",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[s.jsx("div",{className:a("w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0",e.userStatus==="available"&&"bg-green-100 dark:bg-green-900/30",e.userStatus==="upcoming"&&"bg-yellow-100 dark:bg-yellow-900/30",e.userStatus==="completed"&&"bg-blue-100 dark:bg-blue-900/30",e.userStatus==="failed"&&"bg-red-100 dark:bg-red-900/30",e.userStatus==="expired"&&"bg-gray-100 dark:bg-gray-900/30"),children:s.jsx(p,{className:a("h-6 w-6",e.userStatus==="available"&&"text-green-600 dark:text-green-400",e.userStatus==="upcoming"&&"text-yellow-600 dark:text-yellow-400",e.userStatus==="completed"&&"text-blue-600 dark:text-blue-400",e.userStatus==="failed"&&"text-red-600 dark:text-red-400",e.userStatus==="expired"&&"text-gray-600 dark:text-gray-400")})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h3",{className:"font-semibold",children:e.title}),q(e.userStatus,e.lastScore,e.passingScore)]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.course}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-2 text-sm text-muted-foreground",children:[s.jsx("span",{className:"badge bg-muted",children:z(e.type)}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(p,{className:"h-4 w-4"}),e.questions," soru"]}),e.duration>0&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Y,{className:"h-4 w-4"}),e.duration," dakika"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(_,{className:"h-4 w-4"}),"Son tarih: ",new Date(e.dueDate).toLocaleDateString("tr-TR")]})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[e.lastScore!==void 0&&s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:a("text-2xl font-bold",e.lastScore>=e.passingScore?"text-green-500":"text-red-500"),children:e.lastScore}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["Geçme: ",e.passingScore]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[e.userStatus==="available"&&e.usedAttempts<e.attempts&&s.jsxs(f,{to:`/exams/${e.id}/take`,className:a("flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium","bg-primary text-primary-foreground hover:bg-primary/90 transition-colors"),children:[s.jsx(b,{className:"h-4 w-4"}),"Sınava Gir"]}),e.userStatus==="failed"&&e.usedAttempts<e.attempts&&s.jsxs(f,{to:`/exams/${e.id}/take`,className:a("flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium","bg-primary text-primary-foreground hover:bg-primary/90 transition-colors"),children:[s.jsx(b,{className:"h-4 w-4"}),"Tekrar Dene"]}),(e.userStatus==="completed"||e.userStatus==="failed")&&s.jsxs(f,{to:`/exams/${e.id}/results`,className:a("flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium","border hover:bg-muted transition-colors"),children:[s.jsx($,{className:"h-4 w-4"}),"Sonuçları Gör"]}),e.userStatus==="upcoming"&&s.jsxs("span",{className:"flex items-center gap-2 px-4 py-2 text-sm text-muted-foreground",children:[s.jsx(D,{className:"h-4 w-4"}),"Henüz başlamadı"]}),e.userStatus==="expired"&&s.jsxs("span",{className:"flex items-center gap-2 px-4 py-2 text-sm text-muted-foreground",children:[s.jsx(D,{className:"h-4 w-4"}),"Süresi doldu"]})]})]})]}),e.attempts>1&&s.jsxs("div",{className:"mt-3 pt-3 border-t text-sm text-muted-foreground",children:["Deneme hakkı: ",e.usedAttempts,"/",e.attempts," kullanıldı"]})]})},e.id))}),j.length===0&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(p,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold",children:"Sınav bulunamadı"}),s.jsx("p",{className:"text-muted-foreground mt-1",children:"Arama kriterlerinize uygun sınav yok."})]})]})}export{X as default};
