import{j as e}from"./query-CZD0ZRD-.js";import{r}from"./vendor-izpyVFLd.js";import{B as v,I as x,c as R}from"./index-D2ID2HJ6.js";import{a as u}from"./api-CsRKlOc7.js";import{F as k,a5 as E,i as U,n as L,m as f,au as V,A as O,ax as X,aS as Z,aq as J,aA as W,as as ee,d as ae,w as le,c as se,D as te,X as re,aZ as ie}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";const o=[{value:"1",label:"1. Sinif",category:"Ilkokul"},{value:"2",label:"2. Sinif",category:"Ilkokul"},{value:"3",label:"3. Sinif",category:"Ilkokul"},{value:"4",label:"4. Sinif",category:"Ilkokul"},{value:"5",label:"5. Sinif",category:"Ortaokul"},{value:"6",label:"6. Sinif",category:"Ortaokul"},{value:"7",label:"7. Sinif",category:"Ortaokul"},{value:"8",label:"8. Sinif",category:"Ortaokul"},{value:"9",label:"9. Sinif",category:"Lise"},{value:"10",label:"10. Sinif",category:"Lise"},{value:"11",label:"11. Sinif",category:"Lise"},{value:"12",label:"12. Sinif",category:"Lise"},{value:"mezun",label:"Mezun",category:"Sinav Hazirlik"},{value:"tyt",label:"TYT",category:"Sinav Hazirlik"},{value:"ayt",label:"AYT",category:"Sinav Hazirlik"}],T={draft:{label:"Taslak",color:"text-gray-600",bgColor:"bg-gray-100"},published:{label:"Yayinda",color:"text-green-600",bgColor:"bg-green-100"},closed:{label:"Kapali",color:"text-red-600",bgColor:"bg-red-100"},archived:{label:"Arsiv",color:"text-slate-600",bgColor:"bg-slate-100"}},ne=[{value:"quiz",label:"Quiz"},{value:"midterm",label:"Ara Sinav"},{value:"final",label:"Final"},{value:"practice",label:"Pratik"},{value:"homework",label:"Odev"}];function pe(){const[w,Q]=r.useState([]),[Y,S]=r.useState(!0),[p,A]=r.useState(""),[h,D]=r.useState("all"),[g,M]=r.useState("all"),[P,m]=r.useState(!1),[b,z]=r.useState(null),[_,C]=r.useState(!1),[j,c]=r.useState(null),y=r.useRef(null),[t,n]=r.useState({title:"",description:"",exam_type:"quiz",grade_level:"",duration_minutes:30,pass_score:60,max_attempts:1}),d=r.useCallback(async()=>{var a,l;try{S(!0);const s={};p&&(s.search=p),h!=="all"&&(s.grade_level=h),g!=="all"&&(s.status=g);const i=await u.get("/exams",{params:s});Q(((l=(a=i.data)==null?void 0:a.data)==null?void 0:l.items)||[])}catch(s){console.error("Sinavlar yuklenirken hata:",s)}finally{S(!1)}},[p,h,g]);r.useEffect(()=>{d()},[d]),r.useEffect(()=>{const a=l=>{y.current&&!y.current.contains(l.target)&&c(null)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const I=()=>{z(null),n({title:"",description:"",exam_type:"quiz",grade_level:"",duration_minutes:30,pass_score:60,max_attempts:1}),m(!0)},q=a=>{z(a),n({title:a.title,description:a.description||"",exam_type:a.exam_type,grade_level:a.grade_level||"",duration_minutes:a.duration_minutes,pass_score:a.pass_score,max_attempts:a.max_attempts}),m(!0),c(null)},F=async()=>{var a,l;if(!t.title.trim()){alert("Lutfen quiz basligi girin");return}if(!t.grade_level){alert("Lutfen kademe/sinif secin");return}try{C(!0),b?await u.put(`/exams/${b.id}`,t):await u.post("/exams",t),m(!1),d()}catch(s){alert(((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Bir hata olustu")}finally{C(!1)}},H=async a=>{var l,s;if(confirm(`"${a.title}" quizini silmek istediginize emin misiniz?`)){try{await u.delete(`/exams/${a.id}`),d()}catch(i){alert(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Silme islemi basarisiz")}c(null)}},K=async a=>{var l,s;try{await u.post(`/exams/${a.id}/publish`),d()}catch(i){alert(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Yayimlama basarisiz")}c(null)},G=async a=>{var l,s;try{await u.post(`/exams/${a.id}/unpublish`),d()}catch(i){alert(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Yayindan kaldirma basarisiz")}c(null)},$=async a=>{var l,s;try{await u.post(`/exams/${a.id}/duplicate`),d()}catch(i){alert(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Kopyalama basarisiz")}c(null)},B=a=>{if(!a)return"-";const l=o.find(s=>s.value===a);return l?l.label:a};return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(k,{className:"h-7 w-7 text-primary"}),"Quiz Yonetimi"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Quiz olusturun, duzenleyin ve yonetin"})]}),e.jsxs(v,{onClick:I,className:"gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Yeni Quiz Olustur"]})]}),e.jsx("div",{className:"bg-card border rounded-xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Quiz ara...",value:p,onChange:a=>A(a.target.value),className:"pl-10"})]}),e.jsxs("select",{value:h,onChange:a=>D(a.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tum Kademeler"}),e.jsx("optgroup",{label:"Ilkokul",children:o.filter(a=>a.category==="Ilkokul").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("optgroup",{label:"Ortaokul",children:o.filter(a=>a.category==="Ortaokul").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("optgroup",{label:"Lise",children:o.filter(a=>a.category==="Lise").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("optgroup",{label:"Sinav Hazirlik",children:o.filter(a=>a.category==="Sinav Hazirlik").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("select",{value:g,onChange:a=>M(a.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tum Durumlar"}),e.jsx("option",{value:"draft",children:"Taslak"}),e.jsx("option",{value:"published",children:"Yayinda"}),e.jsx("option",{value:"closed",children:"Kapali"})]})]})}),Y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-primary"})}):w.length===0?e.jsxs("div",{className:"bg-card border rounded-xl p-12 text-center",children:[e.jsx(k,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Henuz quiz yok"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Ilk quizinizi olusturarak baslayin"}),e.jsxs(v,{onClick:I,className:"gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Quiz Olustur"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(a=>{const l=T[a.status]||T.draft;return e.jsxs(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card border rounded-xl overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:a.title}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground truncate mt-1",children:a.description})]}),e.jsxs("div",{className:"relative",ref:j===a.id?y:null,children:[e.jsx("button",{onClick:()=>c(j===a.id?null:a.id),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx(O,{children:j===a.id&&e.jsxs(f.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},className:"absolute right-0 top-full mt-1 w-48 bg-popover border rounded-lg shadow-lg z-50 py-1",children:[e.jsxs("button",{onClick:()=>q(a),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"})," Duzenle"]}),e.jsxs("button",{onClick:()=>$(a),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"})," Kopyala"]}),e.jsx("div",{className:"border-t my-1"}),a.status==="draft"?e.jsxs("button",{onClick:()=>K(a),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted flex items-center gap-2 text-green-600",children:[e.jsx(J,{className:"h-4 w-4"})," Yayimla"]}):a.status==="published"?e.jsxs("button",{onClick:()=>G(a),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted flex items-center gap-2 text-orange-600",children:[e.jsx(W,{className:"h-4 w-4"})," Yayindan Kaldir"]}):null,e.jsx("div",{className:"border-t my-1"}),e.jsxs("button",{onClick:()=>H(a),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted flex items-center gap-2 text-red-600",children:[e.jsx(ee,{className:"h-4 w-4"})," Sil"]})]})})]})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:R("px-2.5 py-1 rounded-full text-xs font-medium",l.bgColor,l.color),children:l.label}),e.jsxs("span",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ae,{className:"h-4 w-4"}),B(a.grade_level)]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center text-sm",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2",children:[e.jsx(le,{className:"h-4 w-4 mx-auto mb-1 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[a.duration_minutes,"dk"]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2",children:[e.jsx(k,{className:"h-4 w-4 mx-auto mb-1 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:[a.total_questions||0," soru"]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-2",children:[e.jsx(se,{className:"h-4 w-4 mx-auto mb-1 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:a.attempt_count||0})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(te,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["Hedef: %",a.pass_score," basari"]})]})]})]},a.id)})}),e.jsx(O,{children:P&&e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>m(!1),children:e.jsxs(f.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-background rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:b?"Quiz Duzenle":"Yeni Quiz Olustur"}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 hover:bg-muted rounded-lg",children:e.jsx(re,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1.5",children:["Quiz Basligi ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{value:t.title,onChange:a=>n({...t,title:a.target.value}),placeholder:"Orn: Matematik Tarama Testi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Aciklama"}),e.jsx("textarea",{value:t.description,onChange:a=>n({...t,description:a.target.value}),placeholder:"Quiz hakkinda kisa aciklama...",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1.5",children:["Kademe / Sinif ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.grade_level,onChange:a=>n({...t,grade_level:a.target.value}),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Kademe Secin"}),e.jsx("optgroup",{label:"Ilkokul",children:o.filter(a=>a.category==="Ilkokul").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("optgroup",{label:"Ortaokul",children:o.filter(a=>a.category==="Ortaokul").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("optgroup",{label:"Lise",children:o.filter(a=>a.category==="Lise").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("optgroup",{label:"Sinav Hazirlik",children:o.filter(a=>a.category==="Sinav Hazirlik").map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Quiz sadece secili kademe ogrencilerine gosterilecek"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Tur"}),e.jsx("select",{value:t.exam_type,onChange:a=>n({...t,exam_type:a.target.value}),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:ne.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Sure (dk)"}),e.jsx(x,{type:"number",min:5,max:180,value:t.duration_minutes,onChange:a=>n({...t,duration_minutes:parseInt(a.target.value)||30})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Gecme (%)"}),e.jsx(x,{type:"number",min:0,max:100,value:t.pass_score,onChange:a=>n({...t,pass_score:parseInt(a.target.value)||60})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Max Deneme"}),e.jsx(x,{type:"number",min:1,max:10,value:t.max_attempts,onChange:a=>n({...t,max_attempts:parseInt(a.target.value)||1})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t",children:[e.jsx(v,{variant:"outline",onClick:()=>m(!1),children:"Iptal"}),e.jsx(v,{onClick:F,disabled:_,className:"gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 animate-spin"}),"Kaydediliyor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4"}),b?"Guncelle":"Olustur"]})})]})]})})})]})}export{pe as default};
