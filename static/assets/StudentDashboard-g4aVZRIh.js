import{a as A,j as e}from"./query-CZD0ZRD-.js";import{u as V,B as w,c as p}from"./index-D2ID2HJ6.js";import{M as C,D as j,S as O,A as Y,P as Q}from"./DashboardComponents-QpE30HAi.js";import{a as W}from"./api-CsRKlOc7.js";import{g as J}from"./courseService-BuQoanZ9.js";import{g as X}from"./examService-oLBGGbW_.js";import{g as Z}from"./liveSessionService-CS9pfqF2.js";import{g as ee}from"./userService-15brR9Ux.js";import{b as se}from"./vendor-izpyVFLd.js";import{n as te,r as re,m as ne,$ as ae,B as b,a0 as $,a1 as G,w as ie,D as P,a2 as le,C as ce,T as oe,a3 as de,a4 as me,q as ue}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";async function xe(){var t,i,n,l,h,d,m,o;try{const[f,y,v,S]=await Promise.all([J().catch(()=>({data:{enrollments:[]}})),X({status:"published"}).catch(()=>({data:{exams:[]}})),Z().catch(()=>({data:{sessions:[]}})),ee().catch(()=>null)]),u=f,x=((t=u==null?void 0:u.data)==null?void 0:t.enrollments)||(u==null?void 0:u.enrollments)||[],k=((i=y==null?void 0:y.data)==null?void 0:i.exams)||[],L=((n=v==null?void 0:v.data)==null?void 0:n.sessions)||[],c=[...x].sort((s,a)=>{const g=new Date(s.last_accessed_at||0).getTime();return new Date(a.last_accessed_at||0).getTime()-g})[0],K=c?{id:((l=c.course)==null?void 0:l.id)||c.course_id,title:((h=c.course)==null?void 0:h.title)||"Kurs",instructor:((d=c.course)==null?void 0:d.teacher_name)||"Eƒüitmen",progress:c.progress_percentage||0,currentLesson:c.current_lesson_title||"Ders",currentLessonNumber:c.completed_lessons||1,totalLessons:((m=c.course)==null?void 0:m.lesson_count)||1,thumbnail:(o=c.course)==null?void 0:o.thumbnail}:null,z=x.filter(s=>s.progress_percentage<100).length,H=x.reduce((s,a)=>s+(a.completed_lessons||0),0),q=x.length>0?Math.round(x.reduce((s,a)=>s+(a.progress_percentage||0),0)/x.length):0,B=new Date,I=k.filter(s=>new Date(s.due_date||s.end_time)>B&&s.status!=="completed").slice(0,3).map(s=>{var M;const a=new Date(s.due_date||s.end_time),g=a.getTime()-B.getTime(),N=Math.ceil(g/(1e3*60*60*24));return{id:s.id,title:s.title,course:s.course_title||((M=s.course)==null?void 0:M.title)||"Kurs",date:a.toLocaleDateString("tr-TR",{day:"numeric",month:"short"}),timeLeft:N<=0?"Bug√ºn":`${N} g√ºn`,questions:s.question_count||0,duration:s.duration_minutes?`${s.duration_minutes} dk`:"-"}}),F=x.filter(s=>s.progress_percentage>0&&s.progress_percentage<100).slice(0,3).map(s=>{var a,g,N;return{id:((a=s.course)==null?void 0:a.id)||s.course_id,title:((g=s.course)==null?void 0:g.title)||"Kurs",instructor:((N=s.course)==null?void 0:N.teacher_name)||"Eƒüitmen",progress:s.progress_percentage||0,nextLesson:s.current_lesson_title||"Sonraki ders"}}),T=new Date;T.setHours(0,0,0,0);const D=new Date;D.setHours(23,59,59,999);const _=[];L.forEach(s=>{const a=new Date(s.scheduled_at);if(a>=T&&a<=D){const g=s.status==="live";_.push({time:a.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}),title:`Canlƒ± Ders: ${s.title}`,type:"live",isNow:g})}}),k.forEach(s=>{const a=new Date(s.due_date||s.end_time);a>=T&&a<=D&&_.push({time:a.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}),title:`Sƒ±nav: ${s.title}`,type:"exam"})}),_.sort((s,a)=>s.time.localeCompare(a.time));const R=["Pzt","Sal","√áar","Per","Cum","Cmt","Paz"],E=(new Date().getDay()+6)%7,U=R.map((s,a)=>({day:s,value:a<E?Math.floor(Math.random()*100):a===E?Math.floor(Math.random()*50):0,active:a===E}));return{metrics:{activeCourses:z,weeklyStudyHours:12,completedLessons:H,overallProgress:q,streak:7},currentCourse:K,upcomingExams:I,continueLearning:F,todaySchedule:_,weeklyProgress:U,achievements:[{emoji:"üî•",label:"7 G√ºn Seri",isNew:!0},{emoji:"üèÜ",label:"ƒ∞lk Sertifika",isNew:!1}]}}catch(f){throw console.error("Student dashboard fetch error:",f),f}}async function he(t){return(await W.get("/goals/my",{params:t})).data.data}const ge={pending:"Bekliyor",in_progress:"Devam Ediyor",completed:"Tamamlandƒ±",expired:"S√ºresi Dolmu≈ü",cancelled:"ƒ∞ptal Edildi"},pe=t=>{switch(t){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"expired":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},fe=t=>{switch(t){case"quiz":return"üìù";case"course":return"üìö";case"video":return"üé¨";case"lesson":return"üìñ";default:return"üéØ"}};function $e(){const t=V(),i=se(),{data:n,isLoading:l,error:h}=A({queryKey:["studentDashboard"],queryFn:xe,staleTime:1e3*60*5,refetchOnWindowFocus:!0}),{data:d}=A({queryKey:["myGoals"],queryFn:()=>he({status:"pending"}),staleTime:1e3*60*2});if(l)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Veriler y√ºkleniyor..."})]})});if(h)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Veriler y√ºklenirken bir hata olu≈ütu"}),e.jsx(w,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Tekrar Dene"})]})});const m=(n==null?void 0:n.metrics)||{activeCourses:0,weeklyStudyHours:0,completedLessons:0,overallProgress:0,streak:0},o=n==null?void 0:n.currentCourse,f=(n==null?void 0:n.upcomingExams)||[],y=(n==null?void 0:n.continueLearning)||[],v=(n==null?void 0:n.todaySchedule)||[],S=(n==null?void 0:n.weeklyProgress)||[],u=(n==null?void 0:n.achievements)||[],x=()=>{i(o?`/courses/${o.id}/watch`:"/courses")},k=r=>{i(`/exams/${r}`)},L=r=>{i(`/courses/${r}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-br from-primary via-primary/95 to-blue-600 rounded-2xl p-6 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,white_1px,transparent_1px)] bg-[size:20px_20px]"})}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:m.streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white/20 rounded-full text-sm",children:[e.jsx(ae,{className:"h-4 w-4 text-orange-300"}),e.jsxs("span",{children:[m.streak," g√ºn seri!"]})]})}),e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold mb-2",children:["Ho≈ü geldin, ",t==null?void 0:t.first_name,"! üëã"]}),o?e.jsxs("p",{className:"text-white/80 mb-4",children:["‚Äú",o.title,"‚Äù dersinde kaldƒ±ƒüƒ±n yerden devam et."]}):e.jsx("p",{className:"text-white/80 mb-4",children:"Yeni bir kursa kaydol ve √∂ƒürenmeye ba≈üla!"}),o&&e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 max-w-md",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(b,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:o.currentLesson}),e.jsxs("p",{className:"text-sm text-white/70",children:["Ders ",o.currentLessonNumber,"/",o.totalLessons]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white/70",children:"Kurs ilerlemesi"}),e.jsxs("span",{className:"font-medium",children:[o.progress,"%"]})]}),e.jsx("div",{className:"h-2 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white rounded-full transition-all",style:{width:`${o.progress}%`}})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(w,{onClick:x,size:"lg",className:"bg-white text-primary hover:bg-white/90 shadow-lg",leftIcon:e.jsx($,{className:"h-5 w-5"}),children:"Derse Devam Et"}),e.jsxs(w,{variant:"ghost",className:"text-white hover:bg-white/10",onClick:()=>i("/courses"),children:["T√ºm Kurslarƒ±m",e.jsx(G,{className:"h-4 w-4 ml-1"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(C,{icon:b,label:"Aktif Kurslar",value:m.activeCourses,color:"primary",delay:.1,onClick:()=>i("/courses")}),e.jsx(C,{icon:ie,label:"Bu Hafta",value:`${m.weeklyStudyHours} saat`,change:25,trend:"up",color:"info",delay:.2}),e.jsx(C,{icon:P,label:"Tamamlanan Ders",value:m.completedLessons,change:5,trend:"up",color:"success",delay:.3}),e.jsx(C,{icon:le,label:"Genel ƒ∞lerleme",value:`%${m.overallProgress}`,color:"warning",delay:.4})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[f.length>0&&e.jsx(j,{title:"Yakla≈üan Sƒ±navlar",icon:P,action:"T√ºm√ºn√º G√∂r",onAction:()=>i("/exams"),children:e.jsx("div",{className:"space-y-3",children:f.slice(0,3).map(r=>e.jsx(je,{exam:r,onClick:()=>k(r.id)},r.id))})}),y.length>0?e.jsx(j,{title:"Devam Et",icon:$,action:"T√ºm Kurslar",onAction:()=>i("/courses"),children:e.jsx("div",{className:"space-y-3",children:y.slice(0,3).map(r=>e.jsx(ye,{course:r,onClick:()=>L(r.id)},r.id))})}):e.jsx(j,{title:"Kurs Yok",icon:b,action:"Kurslara G√∂z At",onAction:()=>i("/courses"),children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Hen√ºz bir kursa kayƒ±tlƒ± deƒüilsiniz"}),e.jsx(w,{className:"mt-4",onClick:()=>i("/courses"),children:"Kurslara G√∂z At"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(j,{title:"Bug√ºn√ºn Programƒ±",icon:ce,children:e.jsx("div",{className:"space-y-1",children:v.length>0?v.map((r,c)=>e.jsx(O,{time:r.time,title:r.title,type:r.type,isNow:r.isNow,onClick:()=>{r.type==="live"&&i("/live-classes"),r.type==="exam"&&i("/exams")}},c)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Bug√ºn i√ßin planlanmƒ±≈ü etkinlik yok"})})}),S.length>0&&e.jsx(j,{title:"Haftalƒ±k √áalƒ±≈üma",icon:oe,children:e.jsx("div",{className:"space-y-3",children:S.map(r=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:p("text-sm w-8",r.active?"font-semibold text-primary":"text-muted-foreground"),children:r.day}),e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:p("h-full rounded-full transition-all",r.active?"bg-primary/50":"bg-primary"),style:{width:`${r.value}%`}})}),e.jsx("span",{className:"text-xs font-medium w-10 text-right",children:r.value>0?`${r.value}%`:"-"})]},r.day))})}),d&&d.goals.length>0&&e.jsxs(j,{title:"Hedeflerim",icon:P,children:[e.jsx("div",{className:"space-y-2",children:d.goals.slice(0,4).map(r=>e.jsx(ve,{goal:r,onClick:()=>{r.target_type==="exam"&&r.target_id&&i(`/exams/${r.target_id}`)}},r.id))}),d.count>4&&e.jsxs(w,{variant:"ghost",className:"w-full mt-2 text-sm",onClick:()=>i("/goals"),children:["T√ºm√ºn√º G√∂r (",d.count,")",e.jsx(G,{className:"h-4 w-4 ml-1"})]})]}),u.length>0&&e.jsx(j,{title:"Ba≈üarƒ±lar",icon:de,children:e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((r,c)=>e.jsx(Y,{emoji:r.emoji,label:r.label,isNew:r.isNew},c))})})]})]})]})}function je({exam:t,onClick:i}){const n=t.timeLeft.includes("g√ºn")&&parseInt(t.timeLeft)<=2;return e.jsxs("div",{onClick:i,className:p("flex items-center gap-4 p-4 rounded-xl border transition-all cursor-pointer",n?"bg-orange-500/5 border-orange-500/20 hover:border-orange-500/40":"bg-muted/50 border-transparent hover:bg-muted"),children:[e.jsx("div",{className:p("w-12 h-12 rounded-xl flex items-center justify-center shrink-0",n?"bg-orange-500/10 text-orange-500":"bg-primary/10 text-primary"),children:e.jsx(me,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium truncate",children:t.title}),n&&e.jsx("span",{className:"shrink-0 px-2 py-0.5 bg-orange-500 text-white text-xs rounded-full",children:"Yakla≈üƒ±yor"})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:t.course})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"font-medium",children:t.timeLeft}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.questions," soru ‚Ä¢ ",t.duration]})]})]})}function ye({course:t,onClick:i}){return e.jsxs("div",{onClick:i,className:"flex items-center gap-4 p-4 rounded-xl bg-muted/50 hover:bg-muted transition-colors cursor-pointer",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center shrink-0",children:e.jsx(b,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["Sonraki: ",t.nextLesson]}),e.jsx("div",{className:"mt-2",children:e.jsx(Q,{value:t.progress,size:"sm",showValue:!1})})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("span",{className:"text-sm font-medium",children:[t.progress,"%"]}),e.jsx("button",{className:"w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors",children:e.jsx($,{className:"h-4 w-4"})})]})]})}function ve({goal:t,onClick:i}){const n=t.due_date?new Date(t.due_date):null,l=n?Math.ceil((n.getTime()-Date.now())/(1e3*60*60*24)):null,h=l!==null&&l<=3&&l>0,d=l!==null&&l<0;return e.jsxs("div",{onClick:i,className:p("flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer",t.status==="completed"?"bg-green-500/5 border-green-500/20":h?"bg-orange-500/5 border-orange-500/20 hover:border-orange-500/40":d?"bg-red-500/5 border-red-500/20":"bg-muted/50 border-transparent hover:bg-muted"),children:[e.jsx("div",{className:p("w-8 h-8 rounded-lg flex items-center justify-center text-lg shrink-0",t.status==="completed"?"bg-green-500/10":h?"bg-orange-500/10":"bg-primary/10"),children:t.status==="completed"?e.jsx(ue,{className:"h-4 w-4 text-green-500"}):fe(t.goal_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:p("text-xs px-1.5 py-0.5 rounded",pe(t.status)),children:ge[t.status]}),l!==null&&t.status!=="completed"&&e.jsx("span",{className:p("text-xs",d?"text-red-500":h?"text-orange-500":"text-muted-foreground"),children:d?`${Math.abs(l)} g√ºn ge√ßti`:l===0?"Bug√ºn!":`${l} g√ºn kaldƒ±`})]})]}),t.target_score&&e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Hedef"}),e.jsxs("p",{className:"text-sm font-medium",children:["%",t.target_score]})]})]})}export{$e as default};
