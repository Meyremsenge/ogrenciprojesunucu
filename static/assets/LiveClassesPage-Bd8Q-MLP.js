import{u as D,a as R,b as G,j as e}from"./query-CZD0ZRD-.js";import{b as I,r as h}from"./vendor-izpyVFLd.js";import{I as V,B as l,C as B,h as E,T as J,b as O,d as T,e as _,f as Y,c as H,g as U,A as W}from"./index-D2ID2HJ6.js";import{B as X}from"./Badge-D9ELTbf4.js";import{r as Z,a as ee,g as se}from"./liveSessionService-CS9pfqF2.js";import{n as F,i as ae,an as te,m as Q,c as $,a0 as z,V as g,aJ as q,aK as re,C as ie,w as ne}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";import"./api-CsRKlOc7.js";function ge(){const a=I(),u=D(),[i,j]=h.useState(""),[m,p]=h.useState({}),{data:c,isLoading:d}=R({queryKey:["liveSessions"],queryFn:()=>ee({per_page:50})}),{data:n}=R({queryKey:["myLiveSessions"],queryFn:()=>se()}),o=G({mutationFn:s=>Z(s),onSuccess:()=>{u.invalidateQueries({queryKey:["liveSessions"]}),u.invalidateQueries({queryKey:["myLiveSessions"]})}}),x=h.useMemo(()=>{var k,S;const s=((k=c==null?void 0:c.data)==null?void 0:k.sessions)||[],t=((S=n==null?void 0:n.data)==null?void 0:S.sessions)||[],P=new Set(t.map(r=>r.id));return s.map(r=>{var L,K,C;return{...r,is_registered:P.has(r.id),instructor:{name:((L=r.host)==null?void 0:L.name)||r.host_name||"Eğitmen",avatar:(K=r.host)==null?void 0:K.avatar},scheduledAt:r.scheduled_at,duration:r.duration_minutes?`${r.duration_minutes} dk`:"1 saat",participantCount:r.participant_count||0,maxParticipants:r.max_participants||100,category:((C=r.course)==null?void 0:C.title)||r.course_title||"Genel"}})},[c,n]),w=s=>{p(t=>({...t,[s]:!t[s]}))},M=async s=>{try{await o.mutateAsync(s)}catch(t){console.error("Kayıt hatası:",t)}},f=h.useMemo(()=>x.filter(s=>s.title.toLowerCase().includes(i.toLowerCase())||s.description&&s.description.toLowerCase().includes(i.toLowerCase())),[x,i]),v=f.filter(s=>s.status==="live"),N=f.filter(s=>s.status==="scheduled"),y=f.filter(s=>s.status==="ended"),b=s=>new Date(s).toLocaleDateString("tr-TR",{weekday:"long",day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"});return d?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Canlı dersler yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Canlı Dersler"}),e.jsx("p",{className:"text-muted-foreground",children:"Eğitmenlerle canlı etkileşimli dersler"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 sm:w-64",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Ders ara...",value:i,onChange:s=>j(s.target.value),className:"pl-9"})]}),e.jsxs(l,{variant:"outline",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Filtrele"]})]})]}),v.length>0&&e.jsx(Q.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:e.jsx(B,{className:"bg-gradient-to-r from-red-500 to-red-600 text-white border-0",children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"font-semibold",children:"Şu Anda Canlı"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:v.map(s=>{var t;return e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:((t=s.instructor)==null?void 0:t.name)||"Eğitmen"}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx($,{className:"h-4 w-4"}),s.participantCount," katılımcı"]}),e.jsxs(l,{size:"sm",className:"bg-white text-red-600 hover:bg-white/90",onClick:()=>a(`/live/${s.id}`),children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Katıl"]})]})]},s.id)})})]})})}),e.jsxs(J,{defaultValue:"upcoming",children:[e.jsxs(O,{children:[e.jsxs(T,{value:"upcoming",children:["Yaklaşan (",N.length,")"]}),e.jsxs(T,{value:"ended",children:["Geçmiş (",y.length,")"]})]}),e.jsx(_,{value:"upcoming",children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(g,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Yaklaşan canlı ders bulunmuyor"})]}):N.map((s,t)=>e.jsx(A,{liveClass:s,index:t,isReminded:m[s.id]||!1,onToggleReminder:()=>w(s.id),onJoin:()=>a(`/live/${s.id}`),onRegister:()=>M(s.id),formatDate:b,isRegistering:o.isPending},s.id))})}),e.jsx(_,{value:"ended",children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(g,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Geçmiş canlı ders bulunmuyor"})]}):y.map((s,t)=>e.jsx(A,{liveClass:s,index:t,isReminded:m[s.id]||!1,onToggleReminder:()=>w(s.id),onJoin:()=>a(`/live/${s.id}/recording`),onRegister:()=>{},formatDate:b,isEnded:!0},s.id))})})]})]})}function A({liveClass:a,index:u,isReminded:i,onToggleReminder:j,onJoin:m,onRegister:p,formatDate:c,isEnded:d=!1,isRegistering:n=!1}){var o,x;return e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:u*.05},children:e.jsxs(B,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(Y,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(X,{variant:d?"secondary":"info",children:a.category}),!d&&e.jsx(l,{variant:"ghost",size:"icon-sm",onClick:j,className:H(i&&"text-primary"),children:i?e.jsx(q,{className:"h-4 w-4 fill-current"}):e.jsx(re,{className:"h-4 w-4"})})]}),e.jsx(U,{className:"text-lg mt-2",children:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.description})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(W,{alt:((o=a.instructor)==null?void 0:o.name)||"Eğitmen",size:"sm"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:((x=a.instructor)==null?void 0:x.name)||"Eğitmen"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Eğitmen"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:c(a.scheduledAt)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:a.duration})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:d?`${a.participantCount} katılımcı`:`${a.maxParticipants} kişi kapasiteli`})]})]}),a.status==="live"?e.jsxs(l,{className:"w-full mt-4",onClick:m,children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Canlı Derse Katıl"]}):d?e.jsxs(l,{className:"w-full mt-4",variant:"outline",onClick:m,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Kaydı İzle"]}):a.is_registered?e.jsxs(l,{className:"w-full mt-4",variant:"secondary",disabled:!0,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Kayıtlısınız"]}):e.jsxs(l,{className:"w-full mt-4",onClick:p,disabled:n,children:[n?e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(g,{className:"h-4 w-4 mr-2"}),"Kayıt Ol"]})]})]})})}export{ge as default};
