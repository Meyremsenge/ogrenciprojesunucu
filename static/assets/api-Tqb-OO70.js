import{l as h}from"./index-CJixA8aD.js";const u="/api/v1",g=3e4,a=h.create({baseURL:u,timeout:g,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0}),f=()=>{var e;try{const t=localStorage.getItem("auth-storage");if(t){const r=JSON.parse(t);return((e=r==null?void 0:r.state)==null?void 0:e.accessToken)||null}}catch{}return localStorage.getItem("access_token")},p=()=>{var e;try{const t=localStorage.getItem("auth-storage");if(t){const r=JSON.parse(t);return((e=r==null?void 0:r.state)==null?void 0:e.refreshToken)||null}}catch{}return localStorage.getItem("refresh_token")};a.interceptors.request.use(e=>{const t=f();return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),e.headers["X-Request-ID"]=crypto.randomUUID(),e},e=>(console.error("Request error:",e),Promise.reject(e)));a.interceptors.response.use(e=>e,async e=>{var r;const t=e.config;if(((r=e.response)==null?void 0:r.status)===401&&!t._retry){t._retry=!0;try{const s=p();if(s){const l=await h.post(`${u}/auth/refresh`,{refresh_token:s}),{access_token:n,refresh_token:c}=l.data.data,i=localStorage.getItem("auth-storage");if(i){const o=JSON.parse(i);o.state.accessToken=n,c&&(o.state.refreshToken=c),localStorage.setItem("auth-storage",JSON.stringify(o))}return t.headers&&(t.headers.Authorization=`Bearer ${n}`),a(t)}}catch(s){return localStorage.removeItem("auth-storage"),window.location.href="/login",Promise.reject(s)}}return Promise.reject(e)});export{a};
