import{a as V,j as e}from"./query-CZD0ZRD-.js";import{u as F,B as _,c as S}from"./index-CJixA8aD.js";import{M as C,D as f,S as Y,A as U,P as O}from"./DashboardComponents--1gaBlXE.js";import"./api-Tqb-OO70.js";import{g as Q}from"./courseService-DBMG8AyS.js";import{g as W}from"./examService-C7pnWbcS.js";import{g as J}from"./liveSessionService-D-Goqs38.js";import{g as X}from"./userService-LCe-qciv.js";import{b as Z}from"./vendor-izpyVFLd.js";import{p as ee,t as se,m as te,a0 as re,B as v,a1 as D,a2 as ne,y as ae,K as M,a3 as ie,C as le,T as ce,a4 as oe,a5 as de}from"./ui-CAO-iScS.js";import"./charts-Db6Lds24.js";async function me(){var a,i,r,N,y,o,l,j;try{const[x,h,g,L]=await Promise.all([Q().catch(()=>({data:{enrollments:[]}})),W({status:"published"}).catch(()=>({data:{exams:[]}})),J().catch(()=>({data:{sessions:[]}})),X().catch(()=>null)]),m=x,d=((a=m==null?void 0:m.data)==null?void 0:a.enrollments)||(m==null?void 0:m.enrollments)||[],w=((i=h==null?void 0:h.data)==null?void 0:i.exams)||[],t=((r=g==null?void 0:g.data)==null?void 0:r.sessions)||[],c=[...d].sort((s,n)=>{const u=new Date(s.last_accessed_at||0).getTime();return new Date(n.last_accessed_at||0).getTime()-u})[0],$=c?{id:((N=c.course)==null?void 0:N.id)||c.course_id,title:((y=c.course)==null?void 0:y.title)||"Kurs",instructor:((o=c.course)==null?void 0:o.teacher_name)||"Eƒüitmen",progress:c.progress_percentage||0,currentLesson:c.current_lesson_title||"Ders",currentLessonNumber:c.completed_lessons||1,totalLessons:((l=c.course)==null?void 0:l.lesson_count)||1,thumbnail:(j=c.course)==null?void 0:j.thumbnail}:null,z=d.filter(s=>s.progress_percentage<100).length,A=d.reduce((s,n)=>s+(n.completed_lessons||0),0),H=d.length>0?Math.round(d.reduce((s,n)=>s+(n.progress_percentage||0),0)/d.length):0,B=new Date,q=w.filter(s=>new Date(s.due_date||s.end_time)>B&&s.status!=="completed").slice(0,3).map(s=>{var K;const n=new Date(s.due_date||s.end_time),u=n.getTime()-B.getTime(),p=Math.ceil(u/(1e3*60*60*24));return{id:s.id,title:s.title,course:s.course_title||((K=s.course)==null?void 0:K.title)||"Kurs",date:n.toLocaleDateString("tr-TR",{day:"numeric",month:"short"}),timeLeft:p<=0?"Bug√ºn":`${p} g√ºn`,questions:s.question_count||0,duration:s.duration_minutes?`${s.duration_minutes} dk`:"-"}}),G=d.filter(s=>s.progress_percentage>0&&s.progress_percentage<100).slice(0,3).map(s=>{var n,u,p;return{id:((n=s.course)==null?void 0:n.id)||s.course_id,title:((u=s.course)==null?void 0:u.title)||"Kurs",instructor:((p=s.course)==null?void 0:p.teacher_name)||"Eƒüitmen",progress:s.progress_percentage||0,nextLesson:s.current_lesson_title||"Sonraki ders"}}),T=new Date;T.setHours(0,0,0,0);const E=new Date;E.setHours(23,59,59,999);const k=[];t.forEach(s=>{const n=new Date(s.scheduled_at);if(n>=T&&n<=E){const u=s.status==="live";k.push({time:n.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}),title:`Canlƒ± Ders: ${s.title}`,type:"live",isNow:u})}}),w.forEach(s=>{const n=new Date(s.due_date||s.end_time);n>=T&&n<=E&&k.push({time:n.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}),title:`Sƒ±nav: ${s.title}`,type:"exam"})}),k.sort((s,n)=>s.time.localeCompare(n.time));const I=["Pzt","Sal","√áar","Per","Cum","Cmt","Paz"],P=(new Date().getDay()+6)%7,R=I.map((s,n)=>({day:s,value:n<P?Math.floor(Math.random()*100):n===P?Math.floor(Math.random()*50):0,active:n===P}));return{metrics:{activeCourses:z,weeklyStudyHours:12,completedLessons:A,overallProgress:H,streak:7},currentCourse:$,upcomingExams:q,continueLearning:G,todaySchedule:k,weeklyProgress:R,achievements:[{emoji:"üî•",label:"7 G√ºn Seri",isNew:!0},{emoji:"üèÜ",label:"ƒ∞lk Sertifika",isNew:!1}]}}catch(x){throw console.error("Student dashboard fetch error:",x),x}}function Ce(){const a=F(),i=Z(),{data:r,isLoading:N,error:y}=V({queryKey:["studentDashboard"],queryFn:me,staleTime:1e3*60*5,refetchOnWindowFocus:!0});if(N)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Veriler y√ºkleniyor..."})]})});if(y)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Veriler y√ºklenirken bir hata olu≈ütu"}),e.jsx(_,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Tekrar Dene"})]})});const o=(r==null?void 0:r.metrics)||{activeCourses:0,weeklyStudyHours:0,completedLessons:0,overallProgress:0,streak:0},l=r==null?void 0:r.currentCourse,j=(r==null?void 0:r.upcomingExams)||[],x=(r==null?void 0:r.continueLearning)||[],h=(r==null?void 0:r.todaySchedule)||[],g=(r==null?void 0:r.weeklyProgress)||[],L=(r==null?void 0:r.achievements)||[],m=()=>{i(l?`/courses/${l.id}/watch`:"/courses")},d=t=>{i(`/exams/${t}`)},w=t=>{i(`/courses/${t}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(te.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden bg-gradient-to-br from-primary via-primary/95 to-blue-600 rounded-2xl p-6 text-white",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,white_1px,transparent_1px)] bg-[size:20px_20px]"})}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:o.streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white/20 rounded-full text-sm",children:[e.jsx(re,{className:"h-4 w-4 text-orange-300"}),e.jsxs("span",{children:[o.streak," g√ºn seri!"]})]})}),e.jsxs("h1",{className:"text-2xl lg:text-3xl font-bold mb-2",children:["Ho≈ü geldin, ",a==null?void 0:a.first_name,"! üëã"]}),l?e.jsxs("p",{className:"text-white/80 mb-4",children:["‚Äú",l.title,"‚Äù dersinde kaldƒ±ƒüƒ±n yerden devam et."]}):e.jsx("p",{className:"text-white/80 mb-4",children:"Yeni bir kursa kaydol ve √∂ƒürenmeye ba≈üla!"}),l&&e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 max-w-md",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx(v,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:l.currentLesson}),e.jsxs("p",{className:"text-sm text-white/70",children:["Ders ",l.currentLessonNumber,"/",l.totalLessons]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white/70",children:"Kurs ilerlemesi"}),e.jsxs("span",{className:"font-medium",children:[l.progress,"%"]})]}),e.jsx("div",{className:"h-2 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white rounded-full transition-all",style:{width:`${l.progress}%`}})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(_,{onClick:m,size:"lg",className:"bg-white text-primary hover:bg-white/90 shadow-lg",leftIcon:e.jsx(D,{className:"h-5 w-5"}),children:"Derse Devam Et"}),e.jsxs(_,{variant:"ghost",className:"text-white hover:bg-white/10",onClick:()=>i("/courses"),children:["T√ºm Kurslarƒ±m",e.jsx(ne,{className:"h-4 w-4 ml-1"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(C,{icon:v,label:"Aktif Kurslar",value:o.activeCourses,color:"primary",delay:.1,onClick:()=>i("/courses")}),e.jsx(C,{icon:ae,label:"Bu Hafta",value:`${o.weeklyStudyHours} saat`,change:25,trend:"up",color:"info",delay:.2}),e.jsx(C,{icon:M,label:"Tamamlanan Ders",value:o.completedLessons,change:5,trend:"up",color:"success",delay:.3}),e.jsx(C,{icon:ie,label:"Genel ƒ∞lerleme",value:`%${o.overallProgress}`,color:"warning",delay:.4})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[j.length>0&&e.jsx(f,{title:"Yakla≈üan Sƒ±navlar",icon:M,action:"T√ºm√ºn√º G√∂r",onAction:()=>i("/exams"),children:e.jsx("div",{className:"space-y-3",children:j.slice(0,3).map(t=>e.jsx(ue,{exam:t,onClick:()=>d(t.id)},t.id))})}),x.length>0?e.jsx(f,{title:"Devam Et",icon:D,action:"T√ºm Kurslar",onAction:()=>i("/courses"),children:e.jsx("div",{className:"space-y-3",children:x.slice(0,3).map(t=>e.jsx(xe,{course:t,onClick:()=>w(t.id)},t.id))})}):e.jsx(f,{title:"Kurs Yok",icon:v,action:"Kurslara G√∂z At",onAction:()=>i("/courses"),children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Hen√ºz bir kursa kayƒ±tlƒ± deƒüilsiniz"}),e.jsx(_,{className:"mt-4",onClick:()=>i("/courses"),children:"Kurslara G√∂z At"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{title:"Bug√ºn√ºn Programƒ±",icon:le,children:e.jsx("div",{className:"space-y-1",children:h.length>0?h.map((t,b)=>e.jsx(Y,{time:t.time,title:t.title,type:t.type,isNow:t.isNow,onClick:()=>{t.type==="live"&&i("/live-classes"),t.type==="exam"&&i("/exams")}},b)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Bug√ºn i√ßin planlanmƒ±≈ü etkinlik yok"})})}),g.length>0&&e.jsx(f,{title:"Haftalƒ±k √áalƒ±≈üma",icon:ce,children:e.jsx("div",{className:"space-y-3",children:g.map(t=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:S("text-sm w-8",t.active?"font-semibold text-primary":"text-muted-foreground"),children:t.day}),e.jsx("div",{className:"flex-1 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:S("h-full rounded-full transition-all",t.active?"bg-primary/50":"bg-primary"),style:{width:`${t.value}%`}})}),e.jsx("span",{className:"text-xs font-medium w-10 text-right",children:t.value>0?`${t.value}%`:"-"})]},t.day))})}),L.length>0&&e.jsx(f,{title:"Ba≈üarƒ±lar",icon:oe,children:e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map((t,b)=>e.jsx(U,{emoji:t.emoji,label:t.label,isNew:t.isNew},b))})})]})]})]})}function ue({exam:a,onClick:i}){const r=a.timeLeft.includes("g√ºn")&&parseInt(a.timeLeft)<=2;return e.jsxs("div",{onClick:i,className:S("flex items-center gap-4 p-4 rounded-xl border transition-all cursor-pointer",r?"bg-orange-500/5 border-orange-500/20 hover:border-orange-500/40":"bg-muted/50 border-transparent hover:bg-muted"),children:[e.jsx("div",{className:S("w-12 h-12 rounded-xl flex items-center justify-center shrink-0",r?"bg-orange-500/10 text-orange-500":"bg-primary/10 text-primary"),children:e.jsx(de,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium truncate",children:a.title}),r&&e.jsx("span",{className:"shrink-0 px-2 py-0.5 bg-orange-500 text-white text-xs rounded-full",children:"Yakla≈üƒ±yor"})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.course})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("p",{className:"font-medium",children:a.timeLeft}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.questions," soru ‚Ä¢ ",a.duration]})]})]})}function xe({course:a,onClick:i}){return e.jsxs("div",{onClick:i,className:"flex items-center gap-4 p-4 rounded-xl bg-muted/50 hover:bg-muted transition-colors cursor-pointer",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center shrink-0",children:e.jsx(v,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:a.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["Sonraki: ",a.nextLesson]}),e.jsx("div",{className:"mt-2",children:e.jsx(O,{value:a.progress,size:"sm",showValue:!1})})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("span",{className:"text-sm font-medium",children:[a.progress,"%"]}),e.jsx("button",{className:"w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors",children:e.jsx(D,{className:"h-4 w-4"})})]})]})}export{Ce as default};
