import{j as e}from"./query-CZD0ZRD-.js";import{r as l}from"./vendor-izpyVFLd.js";import{c as f}from"./index-CJixA8aD.js";import{j as L,u as z,k as I,r as R}from"./aiAdminService-v5FjVEwA.js";import{G as F,R as C,k as P,r as T,c as B,A,b9 as S,av as M,as as Q,ba as D,bb as G,b2 as $,v as Y,i as V,m as q}from"./ui-CAO-iScS.js";import"./charts-Db6Lds24.js";import"./api-Tqb-OO70.js";function _({used:s,limit:d,label:p,isUnlimited:o}){const t=o?0:Math.min(s/d*100,100),m=t>=75,x=t>=90;return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:p}),e.jsxs("span",{className:"font-medium",children:[s.toLocaleString()," / ",o?"∞":d.toLocaleString()]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx(q.div,{initial:{width:0},animate:{width:`${t}%`},transition:{duration:.5},className:f("h-full rounded-full",x?"bg-red-500":m?"bg-yellow-500":"bg-green-500")})})]})}function W({user:s,onEdit:d,onBlock:p,onReset:o,expanded:t,onToggleExpand:m}){var g;const[x,c]=l.useState(!1),u=s.quota.daily.tokens_used/s.quota.daily.tokens_limit*100,i=(g=s.custom_quota)==null?void 0:g.is_unlimited;return e.jsxs("div",{className:f("border rounded-lg transition-colors",s.is_blocked?"border-red-500/30 bg-red-500/5":"border-border"),children:[e.jsxs("div",{className:"p-4 flex items-center gap-4 cursor-pointer hover:bg-muted/50",onClick:m,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:s.user_name}),s.is_blocked&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-red-500/20 text-red-500",children:"Engelli"}),i&&e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs bg-purple-500/20 text-purple-500 flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3"}),"Sınırsız"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.user_email})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx("span",{className:f("px-2 py-1 rounded-full text-xs",s.role==="super_admin"?"bg-purple-500/20 text-purple-500":s.role==="admin"?"bg-blue-500/20 text-blue-500":s.role==="teacher"?"bg-green-500/20 text-green-500":"bg-muted text-muted-foreground"),children:s.role==="super_admin"?"Süper Admin":s.role==="admin"?"Admin":s.role==="teacher"?"Öğretmen":"Öğrenci"})}),e.jsxs("div",{className:"hidden md:block w-32",children:[e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:f("h-full rounded-full transition-all",i?"bg-purple-500 w-0":u>=90?"bg-red-500":u>=75?"bg-yellow-500":"bg-green-500"),style:{width:i?"0%":`${Math.min(u,100)}%`}})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-1",children:i?"∞":`${u.toFixed(0)}%`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),c(!x)},className:"p-2 rounded-lg hover:bg-muted transition-colors",children:e.jsx(M,{className:"h-4 w-4"})}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 w-48 bg-background border rounded-lg shadow-lg py-1",children:[e.jsxs("button",{onClick:n=>{n.stopPropagation(),d(s),c(!1)},className:"w-full px-4 py-2 text-sm text-left hover:bg-muted flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Kota Düzenle"]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),p(s.user_id,!s.is_blocked),c(!1)},className:"w-full px-4 py-2 text-sm text-left hover:bg-muted flex items-center gap-2",children:s.is_blocked?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-green-500",children:"Engeli Kaldır"})]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-red-500",children:"Engelle"})]})}),e.jsxs("button",{onClick:n=>{n.stopPropagation(),o(s.user_id),c(!1)},className:"w-full px-4 py-2 text-sm text-left hover:bg-muted flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Kotayı Sıfırla"]})]})]})]}),e.jsx("button",{onClick:m,className:"p-2",children:t?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"})})]})]}),e.jsx(A,{children:t&&e.jsx(q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 pt-2 border-t space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Günlük Kota"}),e.jsx(_,{used:s.quota.daily.tokens_used,limit:s.quota.daily.tokens_limit,label:"Token",isUnlimited:i}),e.jsx(_,{used:s.quota.daily.requests_used,limit:s.quota.daily.requests_limit,label:"İstek",isUnlimited:i})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Aylık Kota"}),e.jsx(_,{used:s.quota.monthly.tokens_used,limit:s.quota.monthly.tokens_limit,label:"Token",isUnlimited:i})]})]}),s.is_blocked&&s.blocked_reason&&e.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30",children:[e.jsx("p",{className:"text-sm font-medium text-red-500",children:"Engelleme Nedeni"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.blocked_reason}),s.blocked_until&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Engel bitiş: ",new Date(s.blocked_until).toLocaleString("tr-TR")]})]}),s.custom_quota&&e.jsxs("div",{className:"p-3 rounded-lg bg-purple-500/10 border border-purple-500/30",children:[e.jsx("p",{className:"text-sm font-medium text-purple-500",children:"Özel Kota Ayarları"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-sm",children:[s.custom_quota.daily_limit!==void 0&&e.jsxs("p",{children:["Günlük: ",s.custom_quota.daily_limit.toLocaleString()]}),s.custom_quota.monthly_limit!==void 0&&e.jsxs("p",{children:["Aylık: ",s.custom_quota.monthly_limit.toLocaleString()]}),s.custom_quota.is_unlimited&&e.jsxs("p",{className:"col-span-2 flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4"}),"Sınırsız kota"]})]})]})]})})})]})}function H({user:s,onClose:d,onSave:p}){var N,k,y,w,j;const[o,t]=l.useState(((N=s==null?void 0:s.custom_quota)==null?void 0:N.is_unlimited)||!1),[m,x]=l.useState(((y=(k=s==null?void 0:s.custom_quota)==null?void 0:k.daily_limit)==null?void 0:y.toString())||(s==null?void 0:s.quota.daily.tokens_limit.toString())||""),[c,u]=l.useState(((j=(w=s==null?void 0:s.custom_quota)==null?void 0:w.monthly_limit)==null?void 0:j.toString())||(s==null?void 0:s.quota.monthly.tokens_limit.toString())||""),[i,g]=l.useState(!1);if(!s)return null;const n=async()=>{g(!0),await p(s.user_id,{daily_limit:o?void 0:Number(m),monthly_limit:o?void 0:Number(c),is_unlimited:o}),g(!1),d()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsx(q.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-background rounded-lg shadow-lg w-full max-w-md mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Kota Düzenle"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[s.user_name," (",s.user_email,")"]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border cursor-pointer hover:bg-muted/50",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:b=>t(b.target.checked),className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Sınırsız Kota"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bu kullanıcı için tüm limitleri kaldır"})]})]}),!o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Günlük Token Limiti"}),e.jsx("input",{type:"number",value:m,onChange:b=>x(b.target.value),className:"w-full px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/50",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Aylık Token Limiti"}),e.jsx("input",{type:"number",value:c,onChange:b=>u(b.target.value),className:"w-full px-4 py-2 rounded-lg border bg-background focus:outline-none focus:ring-2 focus:ring-primary/50",min:0})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 rounded-lg border hover:bg-muted",children:"İptal"}),e.jsx("button",{onClick:n,disabled:i,className:f("px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90",i&&"opacity-50 cursor-not-allowed"),children:i?"Kaydediliyor...":"Kaydet"})]})]})})})}function ae(){const[s,d]=l.useState(!0),[p,o]=l.useState([]),[t,m]=l.useState({page:1,pages:1,total:0}),[x,c]=l.useState(null),[u,i]=l.useState(null),[g,n]=l.useState(null),[N,k]=l.useState(""),[y,w]=l.useState(""),[j,b]=l.useState(""),h=l.useCallback(async(a=1)=>{try{d(!0);const r=await L({page:a,per_page:20,search:N||void 0,role:y||void 0,is_blocked:j==="true"?!0:j==="false"?!1:void 0});o(r.items),m({page:r.page,pages:r.pages,total:r.total}),n(null)}catch(r){n(r.message||"Kullanıcılar yüklenirken hata oluştu")}finally{d(!1)}},[N,y,j]);l.useEffect(()=>{h()},[h]);const U=async(a,r)=>{try{await z(a,r),await h(t.page)}catch(v){n(v.message)}},E=async(a,r)=>{try{const v=r?prompt("Engelleme nedeni:"):void 0;if(r&&!v)return;await I(a,r,v||void 0),await h(t.page)}catch(v){n(v.message)}},K=async a=>{if(confirm("Bu kullanıcının kotasını sıfırlamak istediğinize emin misiniz?"))try{await R(a),await h(t.page)}catch(r){n(r.message)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(F,{className:"h-7 w-7 text-primary"}),"AI Kota Yönetimi"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Kullanıcı kotalarını görüntüle ve yönet"})]}),e.jsxs("button",{onClick:()=>h(),className:"flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-muted",children:[e.jsx(C,{className:"h-4 w-4"}),"Yenile"]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı ara...",value:N,onChange:a=>k(a.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border bg-background"})]}),e.jsxs("select",{value:y,onChange:a=>w(a.target.value),className:"px-4 py-2 rounded-lg border bg-background",children:[e.jsx("option",{value:"",children:"Tüm Roller"}),e.jsx("option",{value:"student",children:"Öğrenci"}),e.jsx("option",{value:"teacher",children:"Öğretmen"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Süper Admin"})]}),e.jsxs("select",{value:j,onChange:a=>b(a.target.value),className:"px-4 py-2 rounded-lg border bg-background",children:[e.jsx("option",{value:"",children:"Tümü"}),e.jsx("option",{value:"false",children:"Aktif"}),e.jsx("option",{value:"true",children:"Engelli"})]})]})}),g&&e.jsxs("div",{className:"p-4 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-3",children:[e.jsx(T,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-sm text-red-500",children:g})]}),s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"})}):p.length===0?e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(B,{className:"h-12 w-12 mx-auto text-muted-foreground"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Kullanıcı bulunamadı"})]}):e.jsx("div",{className:"space-y-3",children:p.map(a=>e.jsx(W,{user:a,expanded:x===a.user_id,onToggleExpand:()=>c(x===a.user_id?null:a.user_id),onEdit:i,onBlock:E,onReset:K},a.user_id))}),t.pages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>h(t.page-1),disabled:t.page===1,className:f("px-4 py-2 rounded-lg border",t.page===1?"opacity-50 cursor-not-allowed":"hover:bg-muted"),children:"Önceki"}),e.jsxs("span",{className:"px-4 py-2 text-sm",children:["Sayfa ",t.page," / ",t.pages]}),e.jsx("button",{onClick:()=>h(t.page+1),disabled:t.page===t.pages,className:f("px-4 py-2 rounded-lg border",t.page===t.pages?"opacity-50 cursor-not-allowed":"hover:bg-muted"),children:"Sonraki"})]}),e.jsx(A,{children:u&&e.jsx(H,{user:u,onClose:()=>i(null),onSave:U})})]})}export{ae as default};
