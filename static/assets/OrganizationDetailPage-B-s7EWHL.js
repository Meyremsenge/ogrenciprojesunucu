import{u as oe,a as D,b as K,j as e}from"./query-CZD0ZRD-.js";import{f as de,b as me,r as i}from"./vendor-izpyVFLd.js";import{B as c,c as h,I as o}from"./index-D2ID2HJ6.js";import{a as xe,u as ue,b as he,e as pe,f as ge}from"./organizationService-gsUiKwkj.js";import{n as _,e as je,Q as L,A as E,m as y,q as fe,ab as be,c as G,d as P,B as M,be as O,i as ye,a5 as S,P as Ne,a8 as ve,b2 as ke,ax as R,as as we,X as $,aZ as Ce}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";import"./api-CsRKlOc7.js";const N={student:{label:"Öğrenci",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:P},teacher:{label:"Öğretmen",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:M},admin:{label:"Admin",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",icon:O}},_e=[{key:"all",label:"Tümü",icon:G},{key:"student",label:"Öğrenciler",icon:P},{key:"teacher",label:"Öğretmenler",icon:M},{key:"admin",label:"Adminler",icon:O}];function Me(){var B,F;const{id:Y}=de(),T=me(),p=oe(),r=parseInt(Y||"0"),[g,H]=i.useState("all"),[z,W]=i.useState(""),[Z,j]=i.useState(!1),[J,f]=i.useState(!1),[l,d]=i.useState(null),[v,X]=i.useState(null),[t,m]=i.useState({email:"",password:"",first_name:"",last_name:"",phone:"",role:"student"}),x=(s,a)=>{X({type:s,message:a}),setTimeout(()=>X(null),3e3)},{data:q,isLoading:V,isError:ee}=D({queryKey:["organization",r],queryFn:async()=>{console.log("Fetching organization:",r);const s=await pe(r);return console.log("Organization response:",s),s},enabled:!!r,retry:1}),{data:I,isLoading:se,refetch:ae}=D({queryKey:["organizationUsers",r,{role:g,search:z}],queryFn:async()=>{console.log("Fetching users for org:",r);const s=await ge(r,{role:g!=="all"?g:void 0,search:z||void 0,per_page:100});return console.log("Users response:",s),s},enabled:!!r,retry:1}),U=K({mutationFn:async s=>{console.log("Creating user:",s);const a=await xe(r,{...s,is_active:!0,is_verified:!0});return console.log("Create user response:",a),a},onSuccess:()=>{p.invalidateQueries({queryKey:["organizationUsers",r]}),p.invalidateQueries({queryKey:["organization",r]}),setTimeout(()=>ae(),100),j(!1),m({email:"",password:"",first_name:"",last_name:"",phone:"",role:"student"}),x("success","Kullanıcı başarıyla eklendi")},onError:s=>{var a,n,C,b;console.error("Create user error:",s),x("error",((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.error)||((b=(C=s.response)==null?void 0:C.data)==null?void 0:b.message)||"Kullanıcı eklenemedi")}}),A=K({mutationFn:({userId:s,data:a})=>ue(r,s,a),onSuccess:()=>{p.invalidateQueries({queryKey:["organizationUsers",r]}),f(!1),d(null),x("success","Kullanıcı güncellendi")},onError:()=>{x("error","Kullanıcı güncellenemedi")}}),le=K({mutationFn:s=>he(r,s),onSuccess:()=>{p.invalidateQueries({queryKey:["organizationUsers",r]}),p.invalidateQueries({queryKey:["organization",r]}),x("success","Kullanıcı silindi")},onError:()=>{x("error","Kullanıcı silinemedi")}}),k=i.useMemo(()=>{const s=q;return console.log("Processing org data:",s),s!=null&&s.data&&typeof s.data=="object"&&!Array.isArray(s.data)?s.data:s&&s.id?s:null},[q]),u=i.useMemo(()=>{var a;const s=I;return Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray((a=s==null?void 0:s.data)==null?void 0:a.items)?s.data.items:Array.isArray(s)?s:[]},[I]),te=i.useMemo(()=>({all:u.length,student:u.filter(s=>s.role==="student").length,teacher:u.filter(s=>s.role==="teacher").length,admin:u.filter(s=>s.role==="admin").length}),[u]),re=()=>{if(!t.email||!t.first_name||!t.last_name||!t.password){x("error","Tüm zorunlu alanları doldurun");return}if(t.password.length<6){x("error","Şifre en az 6 karakter olmalıdır");return}U.mutate(t)},ne=s=>{d(s),f(!0)},ie=()=>{l&&A.mutate({userId:l.id,data:{email:l.email,first_name:l.first_name,last_name:l.last_name,phone:l.phone,role:l.role,is_active:l.is_active}})},ce=s=>{const a=s.full_name||`${s.first_name} ${s.last_name}`;confirm(`"${a}" kullanıcısını silmek istediğinize emin misiniz?`)&&le.mutate(s.id)},w=s=>{m({...t,role:s}),j(!0)};return V?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})}):ee||!k?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(je,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Kurum Bulunamadı"}),e.jsx("p",{className:"text-muted-foreground mb-4 text-sm",children:"Bu kurum mevcut değil veya erişim yetkiniz yok."}),e.jsxs(c,{onClick:()=>T("/super-admin/organizations"),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Geri Dön"]})]}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsx(E,{children:v&&e.jsxs(y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:h("fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",v.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"),children:[v.type==="success"?e.jsx(fe,{className:"h-5 w-5"}):e.jsx(be,{className:"h-5 w-5"}),v.message]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>T("/super-admin/organizations"),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Geri"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold",style:{backgroundColor:k.primary_color||"#3B82F6"},children:(B=k.name)==null?void 0:B.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:k.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Kullanıcı Yönetimi"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:_e.map(s=>{const a=s.icon,n=te[s.key]||0;return e.jsx("button",{onClick:()=>H(s.key),className:h("p-4 rounded-xl border text-left transition-all",g===s.key?"border-primary bg-primary/5 ring-2 ring-primary/20":"bg-card hover:border-primary/50"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:h("p-2 rounded-lg",g===s.key?"bg-primary text-white":"bg-muted"),children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:n}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.label})]})]})},s.key)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{value:z,onChange:s=>W(s.target.value),placeholder:"Kullanıcı ara (ad, e-posta)...",className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:()=>w("student"),variant:"outline",className:"gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Öğrenci Ekle"]}),e.jsxs(c,{onClick:()=>w("teacher"),variant:"outline",className:"gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Öğretmen Ekle"]}),e.jsxs(c,{onClick:()=>w("admin"),variant:"outline",className:"gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Admin Ekle"]})]})]}),se?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})}):u.length===0?e.jsxs("div",{className:"text-center py-12 bg-card border rounded-xl",children:[e.jsx(G,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Henüz Kullanıcı Yok"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Bu kuruma kullanıcı ekleyerek başlayın"}),e.jsx("div",{className:"flex justify-center gap-2",children:e.jsxs(c,{onClick:()=>w("student"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Öğrenci Ekle"]})})]}):e.jsx("div",{className:"bg-card border rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-medium",children:"Kullanıcı"}),e.jsx("th",{className:"text-left p-4 font-medium",children:"Rol"}),e.jsx("th",{className:"text-left p-4 font-medium hidden md:table-cell",children:"İletişim"}),e.jsx("th",{className:"text-left p-4 font-medium hidden sm:table-cell",children:"Durum"}),e.jsx("th",{className:"text-right p-4 font-medium",children:"İşlemler"})]})}),e.jsx("tbody",{className:"divide-y",children:u.map(s=>{var b,Q;const a=N[s.role]||N.student,n=a.icon,C=s.full_name||`${s.first_name} ${s.last_name}`;return e.jsxs("tr",{className:"hover:bg-muted/30",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-medium text-primary",children:[(b=s.first_name)==null?void 0:b[0],(Q=s.last_name)==null?void 0:Q[0]]})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:C}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:h("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",a.color),children:[e.jsx(n,{className:"h-3.5 w-3.5"}),a.label]})}),e.jsx("td",{className:"p-4 hidden md:table-cell",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:s.phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),s.phone]})})}),e.jsx("td",{className:"p-4 hidden sm:table-cell",children:s.is_active?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 text-sm",children:[e.jsx(ve,{className:"h-4 w-4"}),"Aktif"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-500 text-sm",children:[e.jsx(ke,{className:"h-4 w-4"}),"Pasif"]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>ne(s),className:"p-2 hover:bg-muted rounded-lg",title:"Düzenle",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>ce(s),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg text-red-600",title:"Sil",children:e.jsx(we,{className:"h-4 w-4"})})]})})]},s.id)})})]})}),e.jsx(E,{children:Z&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>j(!1),children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-card rounded-xl shadow-xl w-full max-w-md mx-4",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),((F=N[t.role])==null?void 0:F.label)||"Kullanıcı"," Ekle"]}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-muted rounded-lg",children:e.jsx($,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Ad *",value:t.first_name,onChange:s=>m({...t,first_name:s.target.value}),placeholder:"Ad"}),e.jsx(o,{label:"Soyad *",value:t.last_name,onChange:s=>m({...t,last_name:s.target.value}),placeholder:"Soyad"})]}),e.jsx(o,{label:"E-posta *",type:"email",value:t.email,onChange:s=>m({...t,email:s.target.value}),placeholder:"ornek@email.com"}),e.jsx(o,{label:"Şifre *",type:"password",value:t.password,onChange:s=>m({...t,password:s.target.value}),placeholder:"En az 6 karakter"}),e.jsx(o,{label:"Telefon",value:t.phone,onChange:s=>m({...t,phone:s.target.value}),placeholder:"+90 5XX XXX XX XX"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rol *"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(N).map(([s,a])=>{const n=a.icon;return e.jsxs("button",{type:"button",onClick:()=>m({...t,role:s}),className:h("flex flex-col items-center gap-1 p-3 rounded-lg border transition-all",t.role===s?"border-primary bg-primary/5 ring-2 ring-primary/20":"hover:border-primary/50"),children:[e.jsx(n,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:a.label})]},s)})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t",children:[e.jsx(c,{variant:"ghost",onClick:()=>j(!1),children:"İptal"}),e.jsxs(c,{onClick:re,disabled:U.isPending,children:[U.isPending?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(S,{className:"h-4 w-4 mr-2"}),"Ekle"]})]})]})})}),e.jsx(E,{children:J&&l&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>f(!1),children:e.jsxs(y.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-card rounded-xl shadow-xl w-full max-w-md mx-4",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Kullanıcı Düzenle"]}),e.jsx("button",{onClick:()=>f(!1),className:"p-2 hover:bg-muted rounded-lg",children:e.jsx($,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Ad",value:l.first_name,onChange:s=>d({...l,first_name:s.target.value})}),e.jsx(o,{label:"Soyad",value:l.last_name,onChange:s=>d({...l,last_name:s.target.value})})]}),e.jsx(o,{label:"E-posta",type:"email",value:l.email,onChange:s=>d({...l,email:s.target.value})}),e.jsx(o,{label:"Telefon",value:l.phone||"",onChange:s=>d({...l,phone:s.target.value})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rol"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(N).map(([s,a])=>{const n=a.icon;return e.jsxs("button",{type:"button",onClick:()=>d({...l,role:s}),className:h("flex flex-col items-center gap-1 p-3 rounded-lg border transition-all",l.role===s?"border-primary bg-primary/5 ring-2 ring-primary/20":"hover:border-primary/50"),children:[e.jsx(n,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:a.label})]},s)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:l.is_active,onChange:s=>d({...l,is_active:s.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Aktif Kullanıcı"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t",children:[e.jsx(c,{variant:"ghost",onClick:()=>f(!1),children:"İptal"}),e.jsxs(c,{onClick:ie,disabled:A.isPending,children:[A.isPending?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Kaydet"]})]})]})})})]})}export{Me as default};
