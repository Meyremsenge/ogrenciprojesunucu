import{j as e}from"./query-CZD0ZRD-.js";import{r as o}from"./vendor-izpyVFLd.js";import{c as l}from"./index-CJixA8aD.js";import{g as E,a as L,b as H,c as T,t as Y,d as $,s as G,e as U}from"./aiAdminService-v5FjVEwA.js";import{R as f,ac as y,a as V,a7 as _,r as S,Z as O,T as Z,S as A,f as C,A as R,m as k,u as I,b4 as q,b5 as M,b6 as X,b7 as J,G as Q,c as W}from"./ui-CAO-iScS.js";import"./charts-Db6Lds24.js";import"./api-Tqb-OO70.js";function N({title:a,value:m,icon:i,status:n="info",subtitle:s,loading:d}){const r={success:"text-green-500 bg-green-500/10",warning:"text-yellow-500 bg-yellow-500/10",error:"text-red-500 bg-red-500/10",info:"text-blue-500 bg-blue-500/10"};return e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:l("p-2 rounded-lg",r[n]),children:e.jsx(i,{className:"h-5 w-5"})}),d&&e.jsx(f,{className:"h-4 w-4 animate-spin text-muted-foreground"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-2xl font-bold",children:m}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a}),s&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s})]})]})}function ee({feature:a,onToggle:m,onRolloutChange:i,disabled:n}){const[s,d]=o.useState(!1),r=async()=>{d(!0),await m(a.id,!a.enabled),d(!1)},p=async c=>{d(!0),await i(a.id,c),d(!1)};return e.jsxs("div",{className:l("p-4 rounded-lg border transition-colors",a.enabled?"border-green-500/30 bg-green-500/5":"border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,disabled:n||s,className:l("transition-colors",s&&"opacity-50 cursor-not-allowed"),children:a.enabled?e.jsx(X,{className:"h-8 w-8 text-green-500"}):e.jsx(J,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:T(a.id)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:a.rollout_stage,onChange:c=>p(c.target.value),disabled:n||s||!a.enabled,className:l("px-3 py-1.5 rounded-lg border bg-background text-sm","focus:outline-none focus:ring-2 focus:ring-primary/50",(!a.enabled||n)&&"opacity-50 cursor-not-allowed"),children:[e.jsx("option",{value:"disabled",children:"Devre Dışı"}),e.jsx("option",{value:"internal_testing",children:"İç Test"}),e.jsx("option",{value:"beta",children:"Beta"}),e.jsx("option",{value:"gradual_rollout",children:"Kademeli Yayın"}),e.jsx("option",{value:"full_release",children:"Tam Yayın"})]}),a.rollout_stage==="gradual_rollout"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium",children:[a.rollout_percentage,"%"]})]})]})]}),(a.beta_users.length>0||a.blacklisted_users.length>0)&&e.jsxs("div",{className:"mt-3 pt-3 border-t flex items-center gap-4 text-xs text-muted-foreground",children:[a.beta_users.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),a.beta_users.length," beta kullanıcı"]}),a.blacklisted_users.length>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[e.jsx(y,{className:"h-3 w-3"}),a.blacklisted_users.length," engelli"]})]})]})}function se({active:a,activatedAt:m,reason:i,onToggle:n,loading:s}){const[d,r]=o.useState(!1),[p,c]=o.useState(""),g=()=>{a?n(!1):r(!0)},b=()=>{n(!0,p||"Admin tarafından manuel olarak etkinleştirildi"),r(!1),c("")};return e.jsxs("div",{className:l("p-6 rounded-lg border-2 transition-all",a?"border-red-500 bg-red-500/5":"border-green-500/30 bg-green-500/5"),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:l("p-3 rounded-lg",a?"bg-red-500/10 text-red-500":"bg-green-500/10 text-green-500"),children:e.jsx(q,{className:"h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"AI Kill Switch"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a?"AI sistemi şu anda DEVRE DIŞI. Tüm AI istekleri engellenecek.":"AI sistemi aktif ve çalışıyor. Acil durumda kill switch'i etkinleştirin."}),a&&m&&e.jsxs("p",{className:"text-xs text-red-500 mt-2",children:["Etkinleştirilme: ",new Date(m).toLocaleString("tr-TR"),i&&` - Neden: ${i}`]})]})]}),e.jsx("button",{onClick:g,disabled:s,className:l("px-6 py-3 rounded-lg font-medium transition-all",a?"bg-green-500 text-white hover:bg-green-600":"bg-red-500 text-white hover:bg-red-600",s&&"opacity-50 cursor-not-allowed"),children:s?e.jsx(f,{className:"h-5 w-5 animate-spin"}):a?"Sistemi Aç":"Sistemi Kapat"})]}),e.jsx(R,{children:d&&e.jsx(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 pt-4 border-t border-red-500/30",children:e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-red-500/10",children:[e.jsx(M,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-red-500",children:"Kill Switch'i Etkinleştir?"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Bu işlem TÜM AI özelliklerini anında devre dışı bırakacak. Kullanıcılar AI asistanı kullanamayacak."}),e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"text",placeholder:"Neden (opsiyonel)",value:p,onChange:v=>c(v.target.value),className:"w-full px-3 py-2 rounded-lg border bg-background text-sm"})}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:b,className:"px-4 py-2 rounded-lg bg-red-500 text-white text-sm font-medium hover:bg-red-600",children:"Evet, Kapat"}),e.jsx("button",{onClick:()=>r(!1),className:"px-4 py-2 rounded-lg border text-sm hover:bg-muted",children:"İptal"})]})]})]})})})]})}function oe(){const[a,m]=o.useState(!0),[i,n]=o.useState(!1),[s,d]=o.useState(null),[r,p]=o.useState(null),[c,g]=o.useState(null),[b,v]=o.useState("status"),x=o.useCallback(async(t=!1)=>{try{t?n(!0):m(!0);const[u,h]=await Promise.all([E(),L()]);d(u),p(h),g(null)}catch(u){g(u.message||"Veri yüklenirken hata oluştu")}finally{m(!1),n(!1)}},[]);o.useEffect(()=>{x();const t=setInterval(()=>x(!0),3e4);return()=>clearInterval(t)},[x]);const D=async(t,u)=>{try{n(!0),await Y({action:t?"activate":"deactivate",reason:u}),await x(!0)}catch(h){g(h.message)}},z=async(t,u)=>{try{await $(t,u),await x(!0)}catch(h){g(h.message)}},B=async(t,u)=>{try{await G(t,u),await x(!0)}catch(h){g(h.message)}},K=async()=>{try{n(!0);const t=await U();await x(!0)}catch(t){g(t.message)}},F=t=>{switch(t){case"operational":return{color:"text-green-500",bg:"bg-green-500",icon:I,label:"Çalışıyor"};case"degraded":return{color:"text-yellow-500",bg:"bg-yellow-500",icon:S,label:"Düşük Performans"};case"maintenance":return{color:"text-blue-500",bg:"bg-blue-500",icon:A,label:"Bakımda"};case"offline":return{color:"text-red-500",bg:"bg-red-500",icon:y,label:"Çevrimdışı"};default:return{color:"text-gray-500",bg:"bg-gray-500",icon:_,label:"Bilinmiyor"}}},P=t=>{switch(t){case"closed":return{color:"text-green-500",label:"Kapalı (Normal)",description:"Sistem normal çalışıyor"};case"open":return{color:"text-red-500",label:"Açık (Engelli)",description:"Çok fazla hata - istekler engelleniyor"};case"half_open":return{color:"text-yellow-500",label:"Yarı Açık (Test)",description:"Sistem test ediliyor"};default:return{color:"text-gray-500",label:"Bilinmiyor",description:""}}};if(a)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(f,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"AI sistemi yükleniyor..."})]})});if(c&&!s)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsx(y,{className:"h-12 w-12 text-red-500"}),e.jsx("p",{className:"font-medium",children:"Hata Oluştu"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:c}),e.jsx("button",{onClick:()=>x(),className:"mt-4 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90",children:"Tekrar Dene"})]})});const w=s?F(s.status):null,j=s!=null&&s.circuit_breaker?P(s.circuit_breaker.state):null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(V,{className:"h-7 w-7 text-primary"}),"AI Kontrol Paneli"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"AI sisteminin durumunu izleyin ve yönetin"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4 animate-spin"}),"Güncelleniyor..."]}),e.jsxs("button",{onClick:()=>x(!0),disabled:i,className:l("flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-muted transition-colors",i&&"opacity-50 cursor-not-allowed"),children:[e.jsx(f,{className:l("h-4 w-4",i&&"animate-spin")}),"Yenile"]}),e.jsxs("button",{onClick:K,disabled:i,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors",children:[e.jsx(_,{className:"h-4 w-4"}),"Health Check"]})]})]}),c&&e.jsxs("div",{className:"p-4 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-sm text-red-500",children:c})]}),s&&w&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(N,{title:"Sistem Durumu",value:w.label,icon:w.icon,status:s.status==="operational"?"success":s.status==="degraded"?"warning":"error",subtitle:`Güncelleme: ${new Date(s.last_updated).toLocaleTimeString("tr-TR")}`}),e.jsx(N,{title:"API Latency",value:`${s.health.api_latency_ms}ms`,icon:O,status:s.health.api_latency_ms<500?"success":s.health.api_latency_ms<1e3?"warning":"error"}),e.jsx(N,{title:"Uptime (24s)",value:`${s.health.uptime_percent_24h.toFixed(1)}%`,icon:Z,status:s.health.uptime_percent_24h>=99?"success":s.health.uptime_percent_24h>=95?"warning":"error"}),e.jsx(N,{title:"Aktif Özellikler",value:s.features.filter(t=>t.enabled).length,icon:A,status:"info",subtitle:`/ ${s.features.length} toplam`})]}),r&&e.jsx(se,{active:r.kill_switch.active,activatedAt:r.kill_switch.activated_at,reason:r.kill_switch.reason,onToggle:D,loading:i}),e.jsx("div",{className:"flex gap-2 border-b",children:[{key:"status",label:"Sistem Durumu",icon:_},{key:"features",label:"Özellik Yönetimi",icon:A},{key:"circuit",label:"Circuit Breaker",icon:C}].map(t=>e.jsxs("button",{onClick:()=>v(t.key),className:l("flex items-center gap-2 px-4 py-3 border-b-2 transition-colors",b===t.key?"border-primary text-primary font-medium":"border-transparent text-muted-foreground hover:text-foreground"),children:[e.jsx(t.icon,{className:"h-4 w-4"}),t.label]},t.key))}),e.jsxs(R,{mode:"wait",children:[b==="status"&&s&&e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-4",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Bağlantı Durumu"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"API Bağlantısı",connected:s.health.api_connection},{label:"Veritabanı",connected:s.health.database_connection},{label:"Cache",connected:s.health.cache_connection},{label:"Son Başarılı İstek",connected:!!s.health.last_successful_request}].map(t=>e.jsxs("div",{className:l("p-3 rounded-lg border flex items-center gap-3",t.connected?"border-green-500/30 bg-green-500/5":"border-red-500/30 bg-red-500/5"),children:[t.connected?e.jsx(I,{className:"h-5 w-5 text-green-500"}):e.jsx(y,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-sm",children:t.label})]},t.label))})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Özellik Durumları"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:s.features.map(t=>e.jsxs("div",{className:l("p-3 rounded-lg border",t.enabled?"border-green-500/30 bg-green-500/5":"border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:l("text-xs px-2 py-0.5 rounded-full",t.enabled?"bg-green-500/20 text-green-500":"bg-muted text-muted-foreground"),children:t.enabled?"Aktif":"Pasif"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H(t.rollout_stage)})]}),e.jsx("p",{className:"text-sm font-medium",children:T(t.feature)}),t.rollout_stage==="gradual_rollout"&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.rollout_percentage,"% kullanıcı"]})]},t.feature))})]})]},"status"),b==="features"&&r&&e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"card p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Özellik Yönetimi"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Her bir AI özelliğini ayrı ayrı kontrol edin. Rollout aşamalarını kullanarak özellikleri kademeli olarak yayınlayabilirsiniz."}),e.jsx("div",{className:"space-y-3",children:r.features.map(t=>e.jsx(ee,{feature:t,onToggle:z,onRolloutChange:B,disabled:r.kill_switch.active},t.id))}),r.kill_switch.active&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/30 flex items-center gap-2 text-sm text-yellow-600",children:[e.jsx(S,{className:"h-4 w-4"}),"Kill switch aktif olduğu için özellik ayarları değiştirilemez."]})]},"features"),b==="circuit"&&(s==null?void 0:s.circuit_breaker)&&j&&e.jsxs(k.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"card p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Circuit Breaker Durumu"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Circuit breaker, AI API'sine yapılan istekleri izler ve çok fazla hata oluştuğunda sistemi korumak için istekleri geçici olarak engeller."}),e.jsx("div",{className:l("p-6 rounded-lg border-2 mb-6",s.circuit_breaker.state==="closed"?"border-green-500/30 bg-green-500/5":s.circuit_breaker.state==="open"?"border-red-500/30 bg-red-500/5":"border-yellow-500/30 bg-yellow-500/5"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:l("p-4 rounded-full",s.circuit_breaker.state==="closed"?"bg-green-500/10":s.circuit_breaker.state==="open"?"bg-red-500/10":"bg-yellow-500/10"),children:e.jsx(C,{className:l("h-8 w-8",j.color)})}),e.jsxs("div",{children:[e.jsx("p",{className:l("text-xl font-bold",j.color),children:j.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j.description})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hata Sayısı"}),e.jsx("p",{className:"text-2xl font-bold text-red-500",children:s.circuit_breaker.failure_count})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Başarılı İstek"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:s.circuit_breaker.success_count})]}),s.circuit_breaker.last_failure&&e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Son Hata"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(s.circuit_breaker.last_failure).toLocaleString("tr-TR")})]}),s.circuit_breaker.next_retry&&e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sonraki Deneme"}),e.jsx("p",{className:"text-sm font-medium",children:new Date(s.circuit_breaker.next_retry).toLocaleString("tr-TR")})]})]})]},"circuit")]})]})}export{oe as default};
