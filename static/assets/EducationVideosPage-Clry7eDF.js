import{j as e,u as he,a as xe,b as Z}from"./query-CZD0ZRD-.js";import{r as i}from"./vendor-izpyVFLd.js";import{c as f,a as ge,B as N,I as V}from"./index-D2ID2HJ6.js";import{m as g,a0 as E,n as K,av as pe,B as be,d as ye,a2 as fe,A as H,q as je,ab as W,aw as ee,a5 as F,i as ve,ao as Ne,ap as we,ax as se,as as ae,o as ke,X as _e}from"./ui-CGOJK0BY.js";import{a as T}from"./api-CsRKlOc7.js";import"./charts-Db6Lds24.js";function Se({videoId:a,title:o,className:r,autoplay:n=!1,startAt:u=0,onProgress:m,onComplete:w,onError:d}){const[k,h]=i.useState(!0),[_,p]=i.useState(null),L=i.useRef(null),j=(()=>{const c=new URLSearchParams({rel:"0",modestbranding:"1",enablejsapi:"1",origin:window.location.origin});return n&&c.set("autoplay","1"),u>0&&c.set("start",String(u)),`https://www.youtube.com/embed/${a}?${c.toString()}`})(),S=()=>{h(!1)},z=()=>{h(!1),p("Video yüklenirken bir hata oluştu"),d==null||d("Video yüklenirken bir hata oluştu")};return e.jsx("div",{className:f("relative w-full bg-black rounded-lg overflow-hidden",r),children:e.jsxs("div",{className:"relative pt-[56.25%]",children:[k&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"h-10 w-10 animate-spin text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Video yükleniyor..."})]})}),_&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"h-8 w-8 text-red-500"})}),e.jsx("p",{className:"text-white font-medium mb-2",children:"Video oynatılamıyor"}),e.jsx("p",{className:"text-white/60 text-sm",children:_})]})}),e.jsx("iframe",{ref:L,src:j,title:o||"YouTube Video",className:"absolute inset-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,onLoad:S,onError:z})]})})}function Ce({video:a,onClick:o,onPlay:r,className:n}){const[u,m]=i.useState(!1),w={turkish:"Türkçe",mathematics:"Matematik",science:"Fen Bilimleri",social_studies:"Sosyal Bilgiler",english:"İngilizce",physics:"Fizik",chemistry:"Kimya",biology:"Biyoloji",history:"Tarih",geography:"Coğrafya",philosophy:"Felsefe",religious_culture:"Din Kültürü",literature:"Edebiyat",geometry:"Geometri",other:"Diğer"};return e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:f("bg-card border rounded-xl overflow-hidden hover:border-primary/50 transition-all cursor-pointer group",n),onClick:o,children:[e.jsxs("div",{className:"relative aspect-video bg-gray-100 dark:bg-gray-800",children:[u?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200 dark:bg-gray-700",children:e.jsx(E,{className:"h-12 w-12 text-gray-400"})}):e.jsx("img",{src:`https://img.youtube.com/vi/${a.youtube_id}/hqdefault.jpg`,alt:a.title,className:"w-full h-full object-cover",loading:"lazy",onError:()=>m(!0)}),e.jsx("div",{className:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("button",{onClick:d=>{d.stopPropagation(),r==null||r()},className:"w-14 h-14 rounded-full bg-primary/90 flex items-center justify-center text-white hover:bg-primary transition-colors",children:e.jsx(E,{className:"h-6 w-6 ml-1",fill:"currentColor"})})}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded",children:a.duration_formatted||"00:00"}),a.is_system_video&&e.jsx("div",{className:"absolute top-2 left-2 bg-primary text-white text-xs px-2 py-1 rounded font-medium",children:"Sistem"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2 mb-2 group-hover:text-primary transition-colors",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:a.grade_display}),e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:w[a.subject]||a.subject})]}),a.view_count!==void 0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[a.view_count.toLocaleString("tr-TR")," görüntülenme"]})]})]})}function Ve({video:a,isOpen:o,onClose:r,onProgress:n}){return!o||!a?null:e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:r,children:e.jsxs(g.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-5xl bg-card rounded-xl overflow-hidden shadow-2xl",onClick:u=>u.stopPropagation(),children:[e.jsx(Se,{videoId:a.youtube_id,title:a.title,autoplay:!0,onProgress:n}),e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:a.grade_display}),a.creator_name&&e.jsxs("span",{children:["• ",a.creator_name]})]}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),e.jsx("button",{onClick:r,className:"absolute top-4 right-4 w-10 h-10 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-colors",children:"×"})]})})}const te={grade_1:"1. Sınıf",grade_2:"2. Sınıf",grade_3:"3. Sınıf",grade_4:"4. Sınıf",grade_5:"5. Sınıf",grade_6:"6. Sınıf",grade_7:"7. Sınıf",grade_8:"8. Sınıf",grade_9:"9. Sınıf",grade_10:"10. Sınıf",grade_11:"11. Sınıf",grade_12:"12. Sınıf",graduate:"Mezun"},Ee={turkish:"Türkçe",mathematics:"Matematik",science:"Fen Bilimleri",social_studies:"Sosyal Bilgiler",english:"İngilizce",physics:"Fizik",chemistry:"Kimya",biology:"Biyoloji",history:"Tarih",geography:"Coğrafya",philosophy:"Felsefe",religious_culture:"Din Kültürü",literature:"Edebiyat",geometry:"Geometri",other:"Diğer"};async function Te(a){return(await T.get("/education-videos",{params:a})).data}async function Le(a){return(await T.post("/education-videos",a)).data.data}async function ze(a){await T.delete(`/education-videos/${a}`)}async function Ae(a,o,r){return(await T.post(`/education-videos/${a}/progress`,{watched_seconds:o,position:r})).data}function G(a){const o=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/youtube\.com\/v\/([a-zA-Z0-9_-]{11})/];for(const r of o){const n=a.match(r);if(n)return n[1]}return null}const le=[{key:"primary",label:"İlkokul",icon:pe,grades:["grade_1","grade_2","grade_3","grade_4"]},{key:"middle",label:"Ortaokul",icon:be,grades:["grade_5","grade_6","grade_7","grade_8"]},{key:"high",label:"Lise",icon:ye,grades:["grade_9","grade_10","grade_11","grade_12"]},{key:"graduate",label:"Mezun",icon:fe,grades:["graduate"]}],ie=[{value:"turkish",label:"Türkçe"},{value:"mathematics",label:"Matematik"},{value:"geometry",label:"Geometri"},{value:"science",label:"Fen Bilimleri"},{value:"physics",label:"Fizik"},{value:"chemistry",label:"Kimya"},{value:"biology",label:"Biyoloji"},{value:"social_studies",label:"Sosyal Bilgiler"},{value:"history",label:"Tarih"},{value:"geography",label:"Coğrafya"},{value:"english",label:"İngilizce"},{value:"literature",label:"Edebiyat"},{value:"philosophy",label:"Felsefe"},{value:"religious_culture",label:"Din Kültürü"},{value:"other",label:"Diğer"}];function Ke(){const{user:a}=ge(),o=he(),r=(a==null?void 0:a.role)==="super_admin",n=(a==null?void 0:a.role)==="teacher",u=r||n,[m,w]=i.useState("high"),[d,k]=i.useState("all"),[h,_]=i.useState("all"),[p,L]=i.useState(""),[j,S]=i.useState("grid"),[z,c]=i.useState(!1),[re,q]=i.useState(!1),[A,I]=i.useState(null),[R,v]=i.useState(null),[C,Y]=i.useState(null),[l,x]=i.useState({youtube_url:"",title:"",description:"",grade_level:"grade_9",subject:"mathematics",topic:"",tags:[]}),b=(s,t)=>{Y({type:s,message:t}),setTimeout(()=>Y(null),3e3)},{data:U,isLoading:oe,isError:ne,refetch:ce}=xe({queryKey:["educationVideos",m,d,h,p],queryFn:async()=>{const s={education_level:m,per_page:50};return d!=="all"&&(s.grade_level=d),h!=="all"&&(s.subject=h),p&&(s.search=p),await Te(s)}}),$=(s,t)=>{var J,X;const y=(X=(J=s==null?void 0:s.response)==null?void 0:J.data)==null?void 0:X.error;return typeof y=="string"?y:y!=null&&y.message?y.message:s!=null&&s.message?s.message:t},B=Z({mutationFn:Le,onSuccess:()=>{o.invalidateQueries({queryKey:["educationVideos"]}),c(!1),x({youtube_url:"",title:"",description:"",grade_level:"grade_9",subject:"mathematics",topic:"",tags:[]}),b("success","Video başarıyla eklendi")},onError:s=>{b("error",$(s,"Video eklenirken hata oluştu"))}}),de=Z({mutationFn:ze,onSuccess:()=>{o.invalidateQueries({queryKey:["educationVideos"]}),b("success","Video silindi")},onError:s=>{b("error",$(s,"Video silinirken hata oluştu"))}}),P=i.useMemo(()=>{const s=U;return Array.isArray(s==null?void 0:s.data)?s.data:[]},[U]),M=le.find(s=>s.key===m),ue=()=>{if(!l.youtube_url||!l.title){b("error","YouTube URL ve başlık zorunludur");return}if(!G(l.youtube_url)){b("error","Geçersiz YouTube URL");return}B.mutate(l)},D=s=>{I(s),q(!0)},O=s=>{confirm(`"${s.title}" videosu silinecek. Emin misiniz?`)&&de.mutate(s.id)},me=(s,t)=>{A&&Ae(A.id,s,t)},Q=s=>r?s.is_system_video:n?!s.is_system_video&&s.created_by===(a==null?void 0:a.id):!1;return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx(H,{children:C&&e.jsxs(g.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:f("fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",C.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"),children:[C.type==="success"?e.jsx(je,{className:"h-5 w-5"}):e.jsx(W,{className:"h-5 w-5"}),C.message]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ee,{className:"h-7 w-7 text-red-500"}),"Eğitim Videoları"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Sınıf ve derse göre eğitim videoları"})]}),u&&e.jsxs(N,{onClick:()=>c(!0),className:"gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),"Video Ekle"]})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:le.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>{w(s.key),k("all")},className:f("flex items-center gap-2 px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-colors",m===s.key?"bg-primary text-white":"bg-muted hover:bg-muted/80"),children:[e.jsx(t,{className:"h-4 w-4"}),s.label]},s.key)})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[M&&M.grades.length>1&&e.jsxs("select",{value:d,onChange:s=>k(s.target.value),className:"px-3 py-2 bg-card border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"Tüm Sınıflar"}),M.grades.map(s=>e.jsx("option",{value:s,children:te[s]},s))]}),e.jsxs("select",{value:h,onChange:s=>_(s.target.value),className:"px-3 py-2 bg-card border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"Tüm Dersler"}),ie.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{value:p,onChange:s=>L(s.target.value),placeholder:"Video ara...",className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-1 bg-muted rounded-lg p-1",children:[e.jsx("button",{onClick:()=>S("grid"),className:f("p-2 rounded",j==="grid"?"bg-card shadow":"hover:bg-card/50"),children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>S("list"),className:f("p-2 rounded",j==="list"?"bg-card shadow":"hover:bg-card/50"),children:e.jsx(we,{className:"h-4 w-4"})})]})]}),oe?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-primary"})}):ne?e.jsxs("div",{className:"text-center py-12 bg-card border rounded-xl",children:[e.jsx(W,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Videolar yüklenemedi"}),e.jsx(N,{onClick:()=>ce(),children:"Tekrar Dene"})]}):P.length===0?e.jsxs("div",{className:"text-center py-12 bg-card border rounded-xl",children:[e.jsx(ee,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Henüz Video Yok"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Bu kategoride henüz video bulunmuyor"}),u&&e.jsxs(N,{onClick:()=>c(!0),children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Video Ekle"]})]}):j==="grid"?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:P.map(s=>e.jsxs("div",{className:"relative group",children:[e.jsx(Ce,{video:s,onClick:()=>D(s),onPlay:()=>D(s)}),Q(s)&&e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),v(s),c(!0)},className:"p-2 bg-white/90 rounded-lg hover:bg-white shadow",children:e.jsx(se,{className:"h-4 w-4 text-gray-700"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),O(s)},className:"p-2 bg-white/90 rounded-lg hover:bg-white shadow",children:e.jsx(ae,{className:"h-4 w-4 text-red-600"})})]})]},s.id))}):e.jsx("div",{className:"space-y-2",children:P.map(s=>e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-4 p-3 bg-card border rounded-lg hover:border-primary/50 cursor-pointer group",onClick:()=>D(s),children:[e.jsxs("div",{className:"relative w-40 aspect-video rounded overflow-hidden shrink-0 bg-gray-200 dark:bg-gray-700",children:[e.jsx("img",{src:`https://img.youtube.com/vi/${s.youtube_id}/hqdefault.jpg`,alt:s.title,className:"w-full h-full object-cover",onError:t=>{t.target.style.display="none"}}),e.jsx("div",{className:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity",children:e.jsx(E,{className:"h-8 w-8 text-white",fill:"currentColor"})}),e.jsx("span",{className:"absolute bottom-1 right-1 bg-black/80 text-white text-xs px-1.5 py-0.5 rounded",children:s.duration_formatted})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate group-hover:text-primary transition-colors",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:s.grade_display}),e.jsx("span",{children:"•"}),e.jsx("span",{children:Ee[s.subject]||s.subject}),s.view_count!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),s.view_count]})]})]})]}),Q(s)&&e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),v(s),c(!0)},className:"p-2 hover:bg-muted rounded",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),O(s)},className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded text-red-600",children:e.jsx(ae,{className:"h-4 w-4"})})]})]},s.id))}),e.jsx(Ve,{video:A,isOpen:re,onClose:()=>{q(!1),I(null)},onProgress:me}),e.jsx(H,{children:z&&e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",onClick:()=>{c(!1),v(null)},children:e.jsxs(g.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-card rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:R?"Video Düzenle":"Yeni Video Ekle"}),e.jsx("button",{onClick:()=>{c(!1),v(null)},className:"p-2 hover:bg-muted rounded-lg",children:e.jsx(_e,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"YouTube URL *"}),e.jsx(V,{value:l.youtube_url,onChange:s=>x({...l,youtube_url:s.target.value}),placeholder:"https://www.youtube.com/watch?v=..."}),l.youtube_url&&G(l.youtube_url)&&e.jsx("div",{className:"mt-2 aspect-video rounded overflow-hidden",children:e.jsx("img",{src:`https://img.youtube.com/vi/${G(l.youtube_url)}/hqdefault.jpg`,alt:"Thumbnail",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Başlık *"}),e.jsx(V,{value:l.title,onChange:s=>x({...l,title:s.target.value}),placeholder:"Video başlığı"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Açıklama"}),e.jsx("textarea",{value:l.description,onChange:s=>x({...l,description:s.target.value}),placeholder:"Video açıklaması",className:"w-full px-3 py-2 bg-background border rounded-lg text-sm resize-none h-20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Sınıf Seviyesi *"}),e.jsx("select",{value:l.grade_level,onChange:s=>x({...l,grade_level:s.target.value}),className:"w-full px-3 py-2 bg-background border rounded-lg text-sm",children:Object.entries(te).map(([s,t])=>e.jsx("option",{value:s,children:t},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ders *"}),e.jsx("select",{value:l.subject,onChange:s=>x({...l,subject:s.target.value}),className:"w-full px-3 py-2 bg-background border rounded-lg text-sm",children:ie.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Konu (Opsiyonel)"}),e.jsx(V,{value:l.topic,onChange:s=>x({...l,topic:s.target.value}),placeholder:"Örn: Üçgenler, Osmanlı Tarihi..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t",children:[e.jsx(N,{variant:"ghost",onClick:()=>{c(!1),v(null)},children:"İptal"}),e.jsxs(N,{onClick:ue,disabled:B.isPending,children:[B.isPending?e.jsx(K,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(F,{className:"h-4 w-4 mr-2"}),R?"Güncelle":"Ekle"]})]})]})})})]})}export{Ke as default};
