import{j as e}from"./query-CZD0ZRD-.js";import{r as d}from"./vendor-izpyVFLd.js";import{c as o}from"./index-D2ID2HJ6.js";import{f as F,h as K,i as q,c as R}from"./aiAdminService-8FoxhY52.js";import{R as w,b as k,p as b,f as A,Z as L,a as E,c as I,s as P,a7 as S,C as B,b9 as C,T as D,ac as M,x as U,m as y,ab as V,w as G}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";import"./api-CsRKlOc7.js";function c({title:i,value:l,icon:t,trend:n,subtitle:a,color:m="blue"}){const s={blue:"text-blue-500 bg-blue-500/10",green:"text-green-500 bg-green-500/10",yellow:"text-yellow-500 bg-yellow-500/10",red:"text-red-500 bg-red-500/10",purple:"text-purple-500 bg-purple-500/10"};return e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:o("p-2.5 rounded-lg",s[m]),children:e.jsx(t,{className:"h-5 w-5"})}),n&&e.jsxs("div",{className:o("flex items-center gap-1 text-sm font-medium",n.isPositive?"text-green-500":"text-red-500"),children:[n.isPositive?e.jsx(D,{className:"h-4 w-4"}):e.jsx(M,{className:"h-4 w-4"}),Math.abs(n.value).toFixed(1),"%"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-3xl font-bold",children:l}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i}),a&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:a})]})]})}function O({data:i}){const l=Math.max(...i.map(t=>t.request_count));return e.jsx("div",{className:"space-y-3",children:i.map(t=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:R(t.feature)}),e.jsxs("span",{className:"text-muted-foreground",children:[t.request_count.toLocaleString()," istek"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx(y.div,{initial:{width:0},animate:{width:`${t.request_count/l*100}%`},transition:{duration:.5,delay:.1},className:"h-full bg-primary rounded-full"})}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.token_count.toLocaleString()," token"]}),e.jsxs("span",{children:[t.avg_response_time.toFixed(0),"ms ort."]}),e.jsxs("span",{className:o(t.error_rate>5?"text-red-500":"text-green-500"),children:[t.error_rate.toFixed(1),"% hata"]})]})]},t.feature))})}function H({data:i,metric:l}){const t=i.map(s=>{switch(l){case"requests":return s.requests;case"tokens":return s.tokens;case"users":return s.unique_users;case"errors":return s.errors}}),n=Math.max(...t,1),a=Math.min(...t,0),m=n-a||1;return e.jsx("div",{className:"h-32 flex items-end gap-1",children:i.slice(-14).map((s,h)=>{const p=((t[i.length-14+h]||0)-a)/m*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsx(y.div,{initial:{height:0},animate:{height:`${Math.max(p,5)}%`},transition:{duration:.3,delay:h*.02},className:o("w-full rounded-t",l==="errors"?"bg-red-500/70":"bg-primary/70")}),e.jsx("span",{className:"text-[9px] text-muted-foreground -rotate-45 origin-left",children:new Date(s.date).toLocaleDateString("tr-TR",{day:"numeric",month:"short"})})]},s.date)})})}function Z({data:i,budget:l}){const t=Math.max(...i.map(n=>n.cost_usd),l.daily_limit_usd);return e.jsxs("div",{className:"h-40 flex items-end gap-1 relative",children:[e.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-red-500/50",style:{bottom:`${l.daily_limit_usd/t*100}%`},children:e.jsxs("span",{className:"absolute right-0 -top-4 text-xs text-red-500",children:["Limit: $",l.daily_limit_usd]})}),i.slice(-14).map((n,a)=>{const m=n.cost_usd/t*100,s=n.cost_usd>l.daily_limit_usd;return e.jsx("div",{className:"flex-1 flex flex-col items-center gap-1",children:e.jsx(y.div,{initial:{height:0},animate:{height:`${Math.max(m,2)}%`},transition:{duration:.3,delay:a*.02},className:o("w-full rounded-t",s?"bg-red-500":"bg-green-500/70"),title:`$${n.cost_usd.toFixed(2)}`})},n.date)})]})}function X({data:i}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-red-500/10 border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-2xl font-bold text-red-500",children:i.summary.total_errors})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Toplam Hata"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-2xl font-bold text-yellow-500",children:i.summary.total_timeouts})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Timeout"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Son Hatalar"}),i.errors.slice(0,5).map((l,t)=>e.jsxs("div",{className:"p-3 rounded-lg border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:R(l.feature)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.error_type})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:[l.count,"x"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(l.date).toLocaleDateString("tr-TR")})]})]},t))]})]})}function ae(){const[i,l]=d.useState(!0),[t,n]=d.useState(!1),[a,m]=d.useState(null),[s,h]=d.useState(null),[g,p]=d.useState(null),[v,_]=d.useState(null),[x,T]=d.useState(30),j=d.useCallback(async(r=!1)=>{try{r?n(!0):l(!0);const[N,$,z]=await Promise.all([F({days:x}),K({days:x}),q({days:Math.min(x,30)})]);m(N),h($),p(z),_(null)}catch(N){_(N.message||"Veri yüklenirken hata oluştu")}finally{l(!1),n(!1)}},[x]);d.useEffect(()=>{j()},[j]);const f=r=>r>=1e6?(r/1e6).toFixed(1)+"M":r>=1e3?(r/1e3).toFixed(1)+"K":r.toString(),u=r=>"$"+r.toFixed(2);return i?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(w,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Dashboard yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(k,{className:"h-7 w-7 text-primary"}),"AI Dashboard"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"AI kullanım istatistikleri ve maliyet analizi"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:x,onChange:r=>T(Number(r.target.value)),className:"px-3 py-2 rounded-lg border bg-background",children:[e.jsx("option",{value:7,children:"Son 7 gün"}),e.jsx("option",{value:14,children:"Son 14 gün"}),e.jsx("option",{value:30,children:"Son 30 gün"}),e.jsx("option",{value:60,children:"Son 60 gün"}),e.jsx("option",{value:90,children:"Son 90 gün"})]}),e.jsxs("button",{onClick:()=>j(!0),disabled:t,className:o("flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-muted transition-colors",t&&"opacity-50 cursor-not-allowed"),children:[e.jsx(w,{className:o("h-4 w-4",t&&"animate-spin")}),"Yenile"]})]})]}),v&&e.jsxs("div",{className:"p-4 rounded-lg bg-red-500/10 border border-red-500/30 flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-sm text-red-500",children:v})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-blue-500/10 border border-blue-500/30 flex items-start gap-3",children:[e.jsx(A,{className:"h-5 w-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"KVKK/GDPR Uyumlu Veriler"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Bu dashboard'daki tüm veriler anonimleştirilmiştir. Kullanıcı kimlik bilgileri, sorular ve AI yanıtları kaydedilmez."})]})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(c,{title:"Toplam İstek",value:f(a.summary.total_requests),icon:L,color:"blue",subtitle:`${x} günde`}),e.jsx(c,{title:"Toplam Token",value:f(a.summary.total_tokens),icon:E,color:"purple",subtitle:"Kullanılan"}),e.jsx(c,{title:"Benzersiz Kullanıcı",value:f(a.summary.unique_users),icon:I,color:"green"}),e.jsx(c,{title:"Başarı Oranı",value:`${a.summary.success_rate.toFixed(1)}%`,icon:P,color:a.summary.success_rate>=95?"green":"yellow"})]}),s&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(c,{title:"Günlük Maliyet",value:u(s.budget.daily_used_usd),icon:S,color:s.budget.is_alert_triggered?"red":"green",subtitle:`/ ${u(s.budget.daily_limit_usd)} limit`,trend:s.change_percentage?{value:s.change_percentage,isPositive:s.change_percentage<0}:void 0}),e.jsx(c,{title:"Aylık Maliyet",value:u(s.budget.monthly_used_usd),icon:B,color:s.budget.monthly_utilization_percent>80?"yellow":"green",subtitle:`/ ${u(s.budget.monthly_limit_usd)} limit`}),e.jsx(c,{title:"Günlük Kullanım",value:`${s.budget.daily_utilization_percent.toFixed(0)}%`,icon:C,color:s.budget.daily_utilization_percent>80?"yellow":"blue"}),e.jsx(c,{title:"Ort. İstek Maliyeti",value:u(s.current_period.cost_per_request),icon:D,color:"blue"})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[a&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-primary"}),"Günlük Kullanım Trendi"]}),e.jsx(H,{data:a.daily_trend,metric:"requests"})]}),s&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-green-500"}),"Günlük Maliyet"]}),e.jsx(Z,{data:s.daily_costs,budget:s.budget})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[a&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-primary"}),"Özellik Kullanımı"]}),e.jsx(O,{data:a.by_feature})]}),g&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-red-500"}),"Hata Özeti"]}),e.jsx(X,{data:g})]})]}),s&&s.optimization_suggestions.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-green-500"}),"Maliyet Optimizasyon Önerileri"]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.optimization_suggestions.map(r=>e.jsxs("div",{className:"p-4 rounded-lg border hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h4",{className:"font-medium",children:r.title}),e.jsx("span",{className:o("text-xs px-2 py-0.5 rounded-full",r.implementation_difficulty==="easy"?"bg-green-500/20 text-green-500":r.implementation_difficulty==="medium"?"bg-yellow-500/20 text-yellow-500":"bg-red-500/20 text-red-500"),children:r.implementation_difficulty==="easy"?"Kolay":r.implementation_difficulty==="medium"?"Orta":"Zor"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:r.description}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t",children:[e.jsxs("span",{className:"text-sm font-medium text-green-500",children:["~",r.potential_savings_percent,"% tasarruf"]}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]})]},r.id))})]}),a&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Veri Dönemi: ",new Date(a.period.start_date).toLocaleDateString("tr-TR")," - ",new Date(a.period.end_date).toLocaleDateString("tr-TR")]})]})}export{ae as default};
