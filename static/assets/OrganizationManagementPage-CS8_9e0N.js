import{u as D,a as L,b as K,j as e}from"./query-CZD0ZRD-.js";import{b as R,r as h}from"./vendor-izpyVFLd.js";import{c as U,B as c,I as i}from"./index-D2ID2HJ6.js";import{c as $,d as G,g as H}from"./organizationService-gsUiKwkj.js";import{A as O,m as p,q as X,ab as f,e as M,a5 as y,i as V,n as P,d as J,B as W,be as Z,c as ee,a1 as se,as as ae,X as te}from"./ui-CGOJK0BY.js";import"./charts-Db6Lds24.js";import"./api-CsRKlOc7.js";function de(){var k,C,z,_,A;console.log("OrganizationManagementPage rendering...");const S=R(),N=D(),[g,B]=h.useState(""),[E,l]=h.useState(!1),[a,n]=h.useState({name:"",email:"",phone:"",max_students:100,max_teachers:20,max_admins:5}),[x,b]=h.useState(null),m=(s,t)=>{b({type:s,message:t}),setTimeout(()=>b(null),3e3)},{data:I,isLoading:T,isError:q,error:r,refetch:v}=L({queryKey:["organizations",{search:g}],queryFn:async()=>{try{const s=await H({search:g||void 0,per_page:100});return console.log("API Response:",s),s}catch(s){throw console.error("API Error:",s),s}},retry:1,refetchOnMount:!0,staleTime:0}),j=K({mutationFn:async s=>{console.log("Creating organization with data:",s);const t=await $(s);return console.log("Create response:",t),t},onSuccess:s=>{console.log("Create success:",s),N.invalidateQueries({queryKey:["organizations"]}),setTimeout(()=>v(),100),l(!1),n({name:"",email:"",phone:"",max_students:100,max_teachers:20,max_admins:5}),m("success","Kurum başarıyla oluşturuldu")},onError:s=>{var t,o,d,u;console.error("Kurum oluşturma hatası:",s),m("error",((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.error)||((u=(d=s.response)==null?void 0:d.data)==null?void 0:u.message)||"Kurum oluşturulamadı")}}),Q=K({mutationFn:s=>G(s),onSuccess:()=>{N.invalidateQueries({queryKey:["organizations"]}),m("success","Kurum silindi")},onError:()=>{m("error","Kurum silinemedi")}}),w=(()=>{var t;const s=I;return console.log("Organizations data:",s),Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray((t=s==null?void 0:s.data)==null?void 0:t.items)?s.data.items:Array.isArray(s)?s:[]})(),F=()=>{if(!a.name.trim()){m("error","Kurum adı zorunludur");return}console.log("Creating org:",a),j.mutate(a)},Y=(s,t)=>{confirm(`"${t}" kurumunu silmek istediğinize emin misiniz?`)&&Q.mutate(s)};return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsx(O,{children:x&&e.jsxs(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:U("fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2",x.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"),children:[x.type==="success"?e.jsx(X,{className:"h-5 w-5"}):e.jsx(f,{className:"h-5 w-5"}),x.message]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(M,{className:"h-7 w-7 text-primary"}),"Kurumlar"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Kurumları yönetin ve kullanıcı atayın"})]}),e.jsxs(c,{onClick:()=>l(!0),className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Yeni Kurum"]})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(i,{value:g,onChange:s=>B(s.target.value),placeholder:"Kurum ara...",className:"pl-10 max-w-md"})]}),T?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(P,{className:"h-8 w-8 animate-spin text-primary"})}):q?e.jsxs("div",{className:"text-center py-12 bg-card border rounded-xl",children:[e.jsx(f,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Veri yüklenemedi"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:typeof((C=(k=r==null?void 0:r.response)==null?void 0:k.data)==null?void 0:C.error)=="string"?r.response.data.error:((A=(_=(z=r==null?void 0:r.response)==null?void 0:z.data)==null?void 0:_.error)==null?void 0:A.message)||(r==null?void 0:r.message)||"Bir hata oluştu"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"API ile iletişim kurulamadı. Lütfen oturum açtığınızdan emin olun."}),e.jsx(c,{onClick:()=>v(),children:"Tekrar Dene"})]}):w.length===0?e.jsxs("div",{className:"text-center py-12 bg-card border rounded-xl",children:[e.jsx(M,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Henüz Kurum Yok"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"İlk kurumu oluşturarak başlayın"}),e.jsxs(c,{onClick:()=>l(!0),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Kurum Oluştur"]})]}):e.jsx("div",{className:"space-y-3",children:w.map(s=>{var t,o,d,u;return e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-card border rounded-xl p-4 hover:border-primary/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold shrink-0",style:{backgroundColor:s.primary_color||"#3B82F6"},children:(t=s.name)==null?void 0:t.substring(0,2).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-4 w-4"}),((o=s.usage)==null?void 0:o.current_students)||s.current_students||0," Öğrenci"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-4 w-4"}),((d=s.usage)==null?void 0:d.current_teachers)||s.current_teachers||0," Öğretmen"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4"}),((u=s.usage)==null?void 0:u.current_admins)||s.current_admins||0," Admin"]})]})]}),e.jsx("div",{className:"hidden sm:block",children:s.is_active!==!1?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx(X,{className:"h-3 w-3"}),"Aktif"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",children:[e.jsx(f,{className:"h-3 w-3"}),"Pasif"]})})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs(c,{size:"sm",onClick:()=>S(`/super-admin/organizations/${s.id}`),className:"gap-1",children:[e.jsx(ee,{className:"h-4 w-4"}),"Yönet",e.jsx(se,{className:"h-4 w-4"})]}),e.jsx("button",{onClick:()=>Y(s.id,s.name),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg text-red-600",title:"Sil",children:e.jsx(ae,{className:"h-4 w-4"})})]})]})},s.id)})}),e.jsx(O,{children:E&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>l(!1),children:e.jsxs(p.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-card rounded-xl shadow-xl w-full max-w-md mx-4",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Yeni Kurum Oluştur"}),e.jsx("button",{onClick:()=>l(!1),className:"p-2 hover:bg-muted rounded-lg",children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(i,{label:"Kurum Adı *",value:a.name,onChange:s=>n({...a,name:s.target.value}),placeholder:"Örn: ABC Eğitim Kurumu"}),e.jsx(i,{label:"E-posta",type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value}),placeholder:"info@kurum.com"}),e.jsx(i,{label:"Telefon",value:a.phone,onChange:s=>n({...a,phone:s.target.value}),placeholder:"+90 XXX XXX XX XX"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(i,{label:"Max Öğrenci",type:"number",value:a.max_students,onChange:s=>n({...a,max_students:parseInt(s.target.value)||0})}),e.jsx(i,{label:"Max Öğretmen",type:"number",value:a.max_teachers,onChange:s=>n({...a,max_teachers:parseInt(s.target.value)||0})}),e.jsx(i,{label:"Max Admin",type:"number",value:a.max_admins,onChange:s=>n({...a,max_admins:parseInt(s.target.value)||0})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 border-t",children:[e.jsx(c,{variant:"ghost",onClick:()=>l(!1),children:"İptal"}),e.jsxs(c,{onClick:F,disabled:j.isPending,children:[j.isPending?e.jsx(P,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(y,{className:"h-4 w-4 mr-2"}),"Oluştur"]})]})]})})})]})}export{de as default};
