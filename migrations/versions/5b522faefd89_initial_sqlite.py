"""initial-sqlite

Revision ID: 5b522faefd89
Revises: 
Create Date: 2025-12-29 01:51:52.497362

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '5b522faefd89'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('aggregated_metrics',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('metric_name', sa.String(length=100), nullable=False),
    sa.Column('period_type', sa.String(length=20), nullable=False),
    sa.Column('period_start', sa.DateTime(), nullable=False),
    sa.Column('period_end', sa.DateTime(), nullable=False),
    sa.Column('dimension_name', sa.String(length=50), nullable=True),
    sa.Column('dimension_value', sa.String(length=200), nullable=True),
    sa.Column('count', sa.Integer(), nullable=True),
    sa.Column('sum_value', sa.Float(), nullable=True),
    sa.Column('avg_value', sa.Float(), nullable=True),
    sa.Column('min_value', sa.Float(), nullable=True),
    sa.Column('max_value', sa.Float(), nullable=True),
    sa.Column('p50_value', sa.Float(), nullable=True),
    sa.Column('p95_value', sa.Float(), nullable=True),
    sa.Column('p99_value', sa.Float(), nullable=True),
    sa.Column('error_count', sa.Integer(), nullable=True),
    sa.Column('error_rate', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('aggregated_metrics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_aggregated_metrics_metric_name'), ['metric_name'], unique=False)
        batch_op.create_index(batch_op.f('ix_aggregated_metrics_period_start'), ['period_start'], unique=False)

    op.create_table('ai_data_retention_logs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('action', sa.String(length=50), nullable=False),
    sa.Column('target_type', sa.String(length=50), nullable=False),
    sa.Column('target_count', sa.Integer(), nullable=True),
    sa.Column('details', sa.Text(), nullable=True),
    sa.Column('performed_by', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('categories',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('icon', sa.String(length=50), nullable=True),
    sa.Column('parent_id', sa.Integer(), nullable=True),
    sa.Column('order_index', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['parent_id'], ['categories.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name'),
    sa.UniqueConstraint('slug')
    )
    op.create_table('error_logs',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('error_type', sa.String(length=200), nullable=False),
    sa.Column('error_message', sa.Text(), nullable=False),
    sa.Column('severity', sa.String(length=20), nullable=False),
    sa.Column('fingerprint', sa.String(length=64), nullable=True),
    sa.Column('stack_trace', sa.Text(), nullable=True),
    sa.Column('request_id', sa.String(length=36), nullable=True),
    sa.Column('endpoint', sa.String(length=200), nullable=True),
    sa.Column('http_method', sa.String(length=10), nullable=True),
    sa.Column('request_url', sa.String(length=500), nullable=True),
    sa.Column('request_headers', sa.JSON(), nullable=True),
    sa.Column('request_body', sa.Text(), nullable=True),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('user_email', sa.String(length=255), nullable=True),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('environment', sa.String(length=50), nullable=True),
    sa.Column('server_name', sa.String(length=100), nullable=True),
    sa.Column('python_version', sa.String(length=20), nullable=True),
    sa.Column('extra_data', sa.JSON(), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('is_resolved', sa.Boolean(), nullable=True),
    sa.Column('resolved_at', sa.DateTime(), nullable=True),
    sa.Column('resolved_by', sa.Integer(), nullable=True),
    sa.Column('resolution_notes', sa.Text(), nullable=True),
    sa.Column('occurrence_count', sa.Integer(), nullable=True),
    sa.Column('first_seen_at', sa.DateTime(), nullable=True),
    sa.Column('last_seen_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('error_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_error_logs_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_error_logs_endpoint'), ['endpoint'], unique=False)
        batch_op.create_index(batch_op.f('ix_error_logs_error_type'), ['error_type'], unique=False)
        batch_op.create_index(batch_op.f('ix_error_logs_fingerprint'), ['fingerprint'], unique=False)
        batch_op.create_index(batch_op.f('ix_error_logs_is_resolved'), ['is_resolved'], unique=False)
        batch_op.create_index(batch_op.f('ix_error_logs_severity'), ['severity'], unique=False)

    op.create_table('organizations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('email', sa.String(length=255), nullable=True),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('address', sa.Text(), nullable=True),
    sa.Column('website', sa.String(length=255), nullable=True),
    sa.Column('logo_url', sa.String(length=500), nullable=True),
    sa.Column('primary_color', sa.String(length=7), nullable=True),
    sa.Column('secondary_color', sa.String(length=7), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('max_students', sa.Integer(), nullable=True),
    sa.Column('max_teachers', sa.Integer(), nullable=True),
    sa.Column('max_admins', sa.Integer(), nullable=True),
    sa.Column('max_courses', sa.Integer(), nullable=True),
    sa.Column('max_storage_gb', sa.Integer(), nullable=True),
    sa.Column('current_students', sa.Integer(), nullable=True),
    sa.Column('current_teachers', sa.Integer(), nullable=True),
    sa.Column('current_admins', sa.Integer(), nullable=True),
    sa.Column('current_courses', sa.Integer(), nullable=True),
    sa.Column('storage_used_mb', sa.Integer(), nullable=True),
    sa.Column('features', sa.JSON(), nullable=True),
    sa.Column('subscription_plan', sa.String(length=50), nullable=True),
    sa.Column('subscription_start', sa.DateTime(), nullable=True),
    sa.Column('subscription_end', sa.DateTime(), nullable=True),
    sa.Column('api_key', sa.String(length=64), nullable=True),
    sa.Column('api_secret', sa.String(length=128), nullable=True),
    sa.Column('settings', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('api_key'),
    sa.UniqueConstraint('slug')
    )
    with op.batch_alter_table('organizations', schema=None) as batch_op:
        batch_op.create_index('idx_org_active', ['is_active'], unique=False)
        batch_op.create_index('idx_org_slug', ['slug'], unique=False)
        batch_op.create_index('idx_org_status', ['status'], unique=False)

    op.create_table('performance_metrics',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('metric_type', sa.String(length=50), nullable=False),
    sa.Column('metric_name', sa.String(length=200), nullable=False),
    sa.Column('request_id', sa.String(length=36), nullable=True),
    sa.Column('endpoint', sa.String(length=200), nullable=True),
    sa.Column('http_method', sa.String(length=10), nullable=True),
    sa.Column('duration_ms', sa.Float(), nullable=False),
    sa.Column('is_slow', sa.Boolean(), nullable=True),
    sa.Column('status_code', sa.Integer(), nullable=True),
    sa.Column('query_count', sa.Integer(), nullable=True),
    sa.Column('cache_hits', sa.Integer(), nullable=True),
    sa.Column('cache_misses', sa.Integer(), nullable=True),
    sa.Column('memory_used_mb', sa.Float(), nullable=True),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('details', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('performance_metrics', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_performance_metrics_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_performance_metrics_endpoint'), ['endpoint'], unique=False)
        batch_op.create_index(batch_op.f('ix_performance_metrics_is_slow'), ['is_slow'], unique=False)
        batch_op.create_index(batch_op.f('ix_performance_metrics_metric_type'), ['metric_type'], unique=False)

    op.create_table('permissions',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('resource', sa.String(length=50), nullable=False),
    sa.Column('action', sa.String(length=50), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('request_logs',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('request_id', sa.String(length=36), nullable=False),
    sa.Column('http_method', sa.String(length=10), nullable=False),
    sa.Column('endpoint', sa.String(length=200), nullable=False),
    sa.Column('full_url', sa.String(length=500), nullable=True),
    sa.Column('query_params', sa.JSON(), nullable=True),
    sa.Column('status_code', sa.Integer(), nullable=False),
    sa.Column('response_size', sa.Integer(), nullable=True),
    sa.Column('duration_ms', sa.Float(), nullable=False),
    sa.Column('is_slow', sa.Boolean(), nullable=True),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('request_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_request_logs_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_request_logs_endpoint'), ['endpoint'], unique=False)
        batch_op.create_index(batch_op.f('ix_request_logs_is_slow'), ['is_slow'], unique=False)
        batch_op.create_index(batch_op.f('ix_request_logs_request_id'), ['request_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_request_logs_status_code'), ['status_code'], unique=False)
        batch_op.create_index(batch_op.f('ix_request_logs_user_id'), ['user_id'], unique=False)

    op.create_table('roles',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=50), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_system', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('security_events',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('event_type', sa.String(length=50), nullable=False),
    sa.Column('severity', sa.String(length=20), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('user_email', sa.String(length=255), nullable=True),
    sa.Column('username', sa.String(length=100), nullable=True),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('request_path', sa.String(length=500), nullable=True),
    sa.Column('request_method', sa.String(length=10), nullable=True),
    sa.Column('request_id', sa.String(length=36), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('details', sa.JSON(), nullable=True),
    sa.Column('country', sa.String(length=100), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('is_resolved', sa.Boolean(), nullable=True),
    sa.Column('resolved_at', sa.DateTime(), nullable=True),
    sa.Column('resolved_by', sa.Integer(), nullable=True),
    sa.Column('resolution_notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('security_events', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_security_events_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_security_events_event_type'), ['event_type'], unique=False)
        batch_op.create_index(batch_op.f('ix_security_events_ip_address'), ['ip_address'], unique=False)
        batch_op.create_index(batch_op.f('ix_security_events_is_resolved'), ['is_resolved'], unique=False)
        batch_op.create_index(batch_op.f('ix_security_events_severity'), ['severity'], unique=False)
        batch_op.create_index(batch_op.f('ix_security_events_user_id'), ['user_id'], unique=False)

    op.create_table('token_blacklist',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('jti', sa.String(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('token_blacklist', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_token_blacklist_jti'), ['jti'], unique=True)

    op.create_table('role_permissions',
    sa.Column('role_id', sa.Integer(), nullable=False),
    sa.Column('permission_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['permission_id'], ['permissions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('role_id', 'permission_id')
    )
    op.create_table('users',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('first_name', sa.String(length=100), nullable=False),
    sa.Column('last_name', sa.String(length=100), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('avatar_url', sa.String(length=500), nullable=True),
    sa.Column('organization_id', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_verified', sa.Boolean(), nullable=True),
    sa.Column('is_deleted', sa.Boolean(), nullable=True),
    sa.Column('force_password_change', sa.Boolean(), nullable=True),
    sa.Column('password_changed_at', sa.DateTime(), nullable=True),
    sa.Column('failed_login_attempts', sa.Integer(), nullable=True),
    sa.Column('locked_until', sa.DateTime(), nullable=True),
    sa.Column('password_reset_token', sa.String(length=64), nullable=True),
    sa.Column('password_reset_expires', sa.DateTime(), nullable=True),
    sa.Column('verification_token', sa.String(length=64), nullable=True),
    sa.Column('role_id', sa.Integer(), nullable=False),
    sa.Column('last_login_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('users', schema=None) as batch_op:
        batch_op.create_index('idx_users_created', ['created_at'], unique=False)
        batch_op.create_index('idx_users_last_login', ['last_login_at'], unique=False)
        batch_op.create_index('idx_users_organization', ['organization_id'], unique=False)
        batch_op.create_index('idx_users_role_active', ['role_id', 'is_active'], unique=False)
        batch_op.create_index('idx_users_verified_active', ['is_verified', 'is_active'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_email'), ['email'], unique=True)
        batch_op.create_index(batch_op.f('ix_users_is_active'), ['is_active'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_is_deleted'), ['is_deleted'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_organization_id'), ['organization_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_password_reset_token'), ['password_reset_token'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_role_id'), ['role_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_users_verification_token'), ['verification_token'], unique=False)

    op.create_table('admin_action_logs',
    sa.Column('admin_id', sa.Integer(), nullable=False),
    sa.Column('action_type', sa.String(length=50), nullable=False),
    sa.Column('target_type', sa.String(length=50), nullable=True),
    sa.Column('target_id', sa.Integer(), nullable=True),
    sa.Column('target_name', sa.String(length=255), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('old_values', sa.JSON(), nullable=True),
    sa.Column('new_values', sa.JSON(), nullable=True),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('success', sa.Boolean(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['admin_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('admin_action_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_admin_action_logs_created_at'), ['created_at'], unique=False)
        batch_op.create_index('ix_admin_logs_action', ['action_type'], unique=False)
        batch_op.create_index('ix_admin_logs_admin', ['admin_id'], unique=False)
        batch_op.create_index('ix_admin_logs_created', ['created_at'], unique=False)
        batch_op.create_index('ix_admin_logs_target', ['target_type', 'target_id'], unique=False)

    op.create_table('ai_chat_sessions',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('session_id', sa.String(length=64), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=True),
    sa.Column('context_type', sa.String(length=50), nullable=True),
    sa.Column('context_id', sa.Integer(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('model_name', sa.String(length=50), nullable=True),
    sa.Column('model_version', sa.String(length=20), nullable=True),
    sa.Column('message_count', sa.Integer(), nullable=True),
    sa.Column('total_tokens_used', sa.Integer(), nullable=True),
    sa.Column('is_anonymized', sa.Boolean(), nullable=True),
    sa.Column('anonymized_at', sa.DateTime(), nullable=True),
    sa.Column('is_deleted', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.Column('last_activity_at', sa.DateTime(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_chat_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_chat_sessions_session_id'), ['session_id'], unique=True)

    op.create_table('ai_configurations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('key', sa.String(length=100), nullable=False),
    sa.Column('value', sa.JSON(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_configurations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_configurations_key'), ['key'], unique=True)

    op.create_table('ai_data_retention_policies',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('target_table', sa.String(length=100), nullable=False),
    sa.Column('retention_days', sa.Integer(), nullable=False),
    sa.Column('anonymization_days', sa.Integer(), nullable=True),
    sa.Column('deletion_days', sa.Integer(), nullable=True),
    sa.Column('action', sa.String(length=50), nullable=False),
    sa.Column('legal_basis', sa.String(length=100), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('run_schedule', sa.String(length=50), nullable=True),
    sa.Column('last_run_at', sa.DateTime(), nullable=True),
    sa.Column('next_run_at', sa.DateTime(), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('ai_prompt_templates',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('version', sa.String(length=20), nullable=False),
    sa.Column('feature', sa.String(length=50), nullable=False),
    sa.Column('system_prompt', sa.Text(), nullable=False),
    sa.Column('user_prompt_template', sa.Text(), nullable=False),
    sa.Column('required_variables', sa.JSON(), nullable=True),
    sa.Column('optional_variables', sa.JSON(), nullable=True),
    sa.Column('model_name', sa.String(length=50), nullable=True),
    sa.Column('max_tokens', sa.Integer(), nullable=True),
    sa.Column('temperature', sa.Float(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('roles_allowed', sa.JSON(), nullable=True),
    sa.Column('is_default', sa.Boolean(), nullable=True),
    sa.Column('ab_test_group', sa.String(length=20), nullable=True),
    sa.Column('ab_test_weight', sa.Float(), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=True),
    sa.Column('avg_tokens_used', sa.Float(), nullable=True),
    sa.Column('avg_response_time_ms', sa.Float(), nullable=True),
    sa.Column('avg_feedback_rating', sa.Float(), nullable=True),
    sa.Column('success_rate', sa.Float(), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('changelog', sa.Text(), nullable=True),
    sa.Column('content_hash', sa.String(length=64), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name', 'version', name='uq_prompt_name_version')
    )
    with op.batch_alter_table('ai_prompt_templates', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_prompt_templates_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_prompt_templates_feature'), ['feature'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_prompt_templates_name'), ['name'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_prompt_templates_status'), ['status'], unique=False)
        batch_op.create_index('ix_prompt_feature_status', ['feature', 'status'], unique=False)

    op.create_table('ai_quotas',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('daily_tokens_used', sa.Integer(), nullable=True),
    sa.Column('monthly_tokens_used', sa.Integer(), nullable=True),
    sa.Column('daily_requests_count', sa.Integer(), nullable=True),
    sa.Column('monthly_requests_count', sa.Integer(), nullable=True),
    sa.Column('last_request_at', sa.DateTime(), nullable=True),
    sa.Column('daily_reset_at', sa.Date(), nullable=True),
    sa.Column('monthly_reset_at', sa.Date(), nullable=True),
    sa.Column('is_blocked', sa.Boolean(), nullable=True),
    sa.Column('blocked_until', sa.DateTime(), nullable=True),
    sa.Column('block_reason', sa.String(length=255), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_table('ai_usage_logs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('feature', sa.String(length=50), nullable=False),
    sa.Column('tokens_used', sa.Integer(), nullable=False),
    sa.Column('request_data', sa.JSON(), nullable=True),
    sa.Column('response_summary', sa.String(length=500), nullable=True),
    sa.Column('processing_time_ms', sa.Integer(), nullable=True),
    sa.Column('is_mock', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_usage_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_usage_logs_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_usage_logs_feature'), ['feature'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_usage_logs_user_id'), ['user_id'], unique=False)

    op.create_table('ai_usage_summaries',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('period_type', sa.String(length=10), nullable=False),
    sa.Column('period_date', sa.Date(), nullable=False),
    sa.Column('total_requests', sa.Integer(), nullable=True),
    sa.Column('successful_requests', sa.Integer(), nullable=True),
    sa.Column('failed_requests', sa.Integer(), nullable=True),
    sa.Column('total_tokens_input', sa.BigInteger(), nullable=True),
    sa.Column('total_tokens_output', sa.BigInteger(), nullable=True),
    sa.Column('estimated_cost', sa.Numeric(precision=10, scale=6), nullable=True),
    sa.Column('avg_response_time_ms', sa.Float(), nullable=True),
    sa.Column('max_response_time_ms', sa.Integer(), nullable=True),
    sa.Column('feature_breakdown', sa.JSON(), nullable=True),
    sa.Column('model_breakdown', sa.JSON(), nullable=True),
    sa.Column('avg_feedback_rating', sa.Float(), nullable=True),
    sa.Column('feedback_count', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'period_type', 'period_date', name='uq_usage_summary')
    )
    with op.batch_alter_table('ai_usage_summaries', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_usage_summaries_user_id'), ['user_id'], unique=False)
        batch_op.create_index('ix_usage_summary_period', ['period_type', 'period_date'], unique=False)

    op.create_table('ai_violations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('violation_type', sa.String(length=50), nullable=False),
    sa.Column('severity', sa.Integer(), nullable=False),
    sa.Column('details', sa.JSON(), nullable=True),
    sa.Column('resolved', sa.Boolean(), nullable=True),
    sa.Column('resolved_at', sa.DateTime(), nullable=True),
    sa.Column('resolved_by', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['resolved_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_violations', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_violations_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_violations_user_id'), ['user_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_violations_violation_type'), ['violation_type'], unique=False)

    op.create_table('audit_logs',
    sa.Column('id', sa.BigInteger(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('user_email', sa.String(length=255), nullable=True),
    sa.Column('user_role', sa.String(length=50), nullable=True),
    sa.Column('session_id', sa.String(length=100), nullable=True),
    sa.Column('action', sa.String(length=50), nullable=False),
    sa.Column('action_category', sa.String(length=50), nullable=True),
    sa.Column('resource_type', sa.String(length=50), nullable=True),
    sa.Column('resource_id', sa.Integer(), nullable=True),
    sa.Column('resource_name', sa.String(length=255), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('severity', sa.String(length=20), nullable=True),
    sa.Column('old_values', sa.JSON(), nullable=True),
    sa.Column('new_values', sa.JSON(), nullable=True),
    sa.Column('changed_fields', sa.JSON(), nullable=True),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.String(length=500), nullable=True),
    sa.Column('request_method', sa.String(length=10), nullable=True),
    sa.Column('request_path', sa.String(length=500), nullable=True),
    sa.Column('request_id', sa.String(length=100), nullable=True),
    sa.Column('country', sa.String(length=100), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('success', sa.Boolean(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('extra_data', sa.JSON(), nullable=True),
    sa.Column('duration_ms', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('audit_logs', schema=None) as batch_op:
        batch_op.create_index('idx_audit_logs_action', ['action'], unique=False)
        batch_op.create_index('idx_audit_logs_created', ['created_at'], unique=False)
        batch_op.create_index('idx_audit_logs_created_severity', ['created_at', 'severity'], unique=False)
        batch_op.create_index('idx_audit_logs_resource', ['resource_type', 'resource_id'], unique=False)
        batch_op.create_index('idx_audit_logs_resource_action', ['resource_type', 'action'], unique=False)
        batch_op.create_index('idx_audit_logs_session', ['session_id'], unique=False)
        batch_op.create_index('idx_audit_logs_severity', ['severity'], unique=False)
        batch_op.create_index('idx_audit_logs_user', ['user_id'], unique=False)
        batch_op.create_index('idx_audit_logs_user_action', ['user_id', 'action'], unique=False)
        batch_op.create_index('idx_audit_logs_user_created', ['user_id', 'created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_audit_logs_user_id'), ['user_id'], unique=False)

    op.create_table('content_ai_interactions',
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('content_category', sa.Enum('VIDEO', 'DOCUMENT', 'QUIZ', 'LIVE_SESSION', 'ASSIGNMENT', name='contentcategory'), nullable=False),
    sa.Column('content_id', sa.Integer(), nullable=False),
    sa.Column('interaction_type', sa.String(length=50), nullable=False),
    sa.Column('user_input', sa.Text(), nullable=True),
    sa.Column('response_summary', sa.String(length=500), nullable=True),
    sa.Column('response_time_ms', sa.Integer(), nullable=True),
    sa.Column('tokens_used', sa.Integer(), nullable=True),
    sa.Column('was_helpful', sa.Boolean(), nullable=True),
    sa.Column('feedback_rating', sa.Integer(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('content_ai_interactions', schema=None) as batch_op:
        batch_op.create_index('ix_ai_interactions_content', ['content_category', 'content_id'], unique=False)
        batch_op.create_index('ix_ai_interactions_expires', ['expires_at'], unique=False)
        batch_op.create_index('ix_ai_interactions_user_date', ['user_id', 'created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_interactions_content_id'), ['content_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_interactions_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_interactions_user_id'), ['user_id'], unique=False)

    op.create_table('content_ai_suggestions',
    sa.Column('content_category', sa.Enum('VIDEO', 'DOCUMENT', 'QUIZ', 'LIVE_SESSION', 'ASSIGNMENT', name='contentcategory'), nullable=False),
    sa.Column('content_id', sa.Integer(), nullable=False),
    sa.Column('suggestion_type', sa.Enum('EXAMPLES', 'QUIZ', 'SUMMARY', 'SIMPLIFIED', 'ENHANCEMENT', name='suggestiontype'), nullable=False),
    sa.Column('suggested_content', sa.Text(), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'APPROVED', 'REJECTED', 'APPLIED', 'EXPIRED', name='suggestionstatus'), nullable=False),
    sa.Column('suggested_by_id', sa.Integer(), nullable=False),
    sa.Column('reviewed_by_id', sa.Integer(), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(), nullable=True),
    sa.Column('review_notes', sa.Text(), nullable=True),
    sa.Column('rejection_reason', sa.String(length=500), nullable=True),
    sa.Column('applied_by_id', sa.Integer(), nullable=True),
    sa.Column('applied_at', sa.DateTime(), nullable=True),
    sa.Column('ai_model_used', sa.String(length=50), nullable=True),
    sa.Column('ai_tokens_used', sa.Integer(), nullable=True),
    sa.Column('ai_prompt_used', sa.Text(), nullable=True),
    sa.Column('applied_version_id', sa.Integer(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['applied_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['reviewed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['suggested_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('content_ai_suggestions', schema=None) as batch_op:
        batch_op.create_index('ix_ai_suggestions_content', ['content_category', 'content_id'], unique=False)
        batch_op.create_index('ix_ai_suggestions_status_date', ['status', 'created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_suggestions_content_category'), ['content_category'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_suggestions_content_id'), ['content_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_suggestions_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_suggestions_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_ai_suggestions_suggested_by_id'), ['suggested_by_id'], unique=False)

    op.create_table('content_approval_queue',
    sa.Column('content_type', sa.String(length=50), nullable=False),
    sa.Column('content_id', sa.Integer(), nullable=False),
    sa.Column('content_title', sa.String(length=255), nullable=False),
    sa.Column('submitted_by_id', sa.Integer(), nullable=False),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('priority', sa.Integer(), nullable=True),
    sa.Column('assigned_to_id', sa.Integer(), nullable=True),
    sa.Column('assigned_at', sa.DateTime(), nullable=True),
    sa.Column('reviewed_by_id', sa.Integer(), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(), nullable=True),
    sa.Column('reviewer_notes', sa.Text(), nullable=True),
    sa.Column('rejection_reason', sa.String(length=100), nullable=True),
    sa.Column('rejection_details', sa.Text(), nullable=True),
    sa.Column('review_time_minutes', sa.Integer(), nullable=True),
    sa.Column('revision_count', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['assigned_to_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['reviewed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['submitted_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('content_approval_queue', schema=None) as batch_op:
        batch_op.create_index('ix_approval_queue_assigned', ['assigned_to_id'], unique=False)
        batch_op.create_index('ix_approval_queue_content', ['content_type', 'content_id'], unique=False)
        batch_op.create_index('ix_approval_queue_priority', ['priority', 'created_at'], unique=False)
        batch_op.create_index('ix_approval_queue_status', ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_approval_queue_created_at'), ['created_at'], unique=False)

    op.create_table('content_progress',
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('content_type', sa.Enum('VIDEO', 'DOCUMENT', 'QUIZ', name='contenttype'), nullable=False),
    sa.Column('content_id', sa.Integer(), nullable=False),
    sa.Column('progress_percentage', sa.Float(), nullable=True),
    sa.Column('last_position', sa.Integer(), nullable=True),
    sa.Column('is_completed', sa.Boolean(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('first_accessed_at', sa.DateTime(), nullable=True),
    sa.Column('last_accessed_at', sa.DateTime(), nullable=True),
    sa.Column('access_count', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'content_type', 'content_id', name='unique_user_content_progress')
    )
    with op.batch_alter_table('content_progress', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_content_progress_content_id'), ['content_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_progress_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_progress_is_completed'), ['is_completed'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_progress_user_id'), ['user_id'], unique=False)

    op.create_table('content_versions',
    sa.Column('content_category', sa.Enum('VIDEO', 'DOCUMENT', 'QUIZ', 'LIVE_SESSION', 'ASSIGNMENT', name='contentcategory'), nullable=False),
    sa.Column('content_id', sa.Integer(), nullable=False),
    sa.Column('version_number', sa.Integer(), nullable=False),
    sa.Column('version_label', sa.String(length=100), nullable=True),
    sa.Column('changed_by_id', sa.Integer(), nullable=False),
    sa.Column('change_summary', sa.String(length=500), nullable=True),
    sa.Column('previous_version_id', sa.Integer(), nullable=True),
    sa.Column('content_snapshot', sa.JSON(), nullable=False),
    sa.Column('changes_diff', sa.JSON(), nullable=True),
    sa.Column('is_current', sa.Boolean(), nullable=True),
    sa.Column('is_published_version', sa.Boolean(), nullable=True),
    sa.Column('restored_from_version_id', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['changed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['previous_version_id'], ['content_versions.id'], ),
    sa.ForeignKeyConstraint(['restored_from_version_id'], ['content_versions.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('content_category', 'content_id', 'version_number', name='uq_content_version_number')
    )
    with op.batch_alter_table('content_versions', schema=None) as batch_op:
        batch_op.create_index('ix_content_versions_content', ['content_category', 'content_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_versions_content_category'), ['content_category'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_versions_content_id'), ['content_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_versions_created_at'), ['created_at'], unique=False)
        batch_op.create_index('ix_content_versions_current', ['content_category', 'content_id', 'is_current'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_versions_is_current'), ['is_current'], unique=False)

    op.create_table('courses',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('short_description', sa.String(length=500), nullable=True),
    sa.Column('thumbnail_url', sa.String(length=500), nullable=True),
    sa.Column('price', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('currency', sa.String(length=3), nullable=True),
    sa.Column('is_free', sa.Boolean(), nullable=True),
    sa.Column('is_published', sa.Boolean(), nullable=True),
    sa.Column('is_featured', sa.Boolean(), nullable=True),
    sa.Column('slug', sa.String(length=250), nullable=True),
    sa.Column('meta_title', sa.String(length=200), nullable=True),
    sa.Column('meta_description', sa.String(length=500), nullable=True),
    sa.Column('total_students', sa.Integer(), nullable=True),
    sa.Column('total_videos', sa.Integer(), nullable=True),
    sa.Column('total_duration_minutes', sa.Integer(), nullable=True),
    sa.Column('average_rating', sa.Numeric(precision=3, scale=2), nullable=True),
    sa.Column('teacher_id', sa.Integer(), nullable=False),
    sa.Column('category_id', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.Column('published_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['category_id'], ['categories.id'], ),
    sa.ForeignKeyConstraint(['teacher_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('slug')
    )
    with op.batch_alter_table('courses', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_courses_is_published'), ['is_published'], unique=False)

    op.create_table('notifications',
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('notification_type', sa.String(length=50), nullable=True),
    sa.Column('action_url', sa.String(length=500), nullable=True),
    sa.Column('data', sa.Text(), nullable=True),
    sa.Column('is_read', sa.Boolean(), nullable=True),
    sa.Column('read_at', sa.DateTime(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('notifications', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_notifications_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_notifications_is_read'), ['is_read'], unique=False)
        batch_op.create_index(batch_op.f('ix_notifications_user_id'), ['user_id'], unique=False)

    op.create_table('organization_invitations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('organization_id', sa.Integer(), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('role', sa.String(length=50), nullable=False),
    sa.Column('token', sa.String(length=64), nullable=False),
    sa.Column('invited_by_id', sa.Integer(), nullable=True),
    sa.Column('is_used', sa.Boolean(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=False),
    sa.Column('used_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['invited_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['organization_id'], ['organizations.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('token')
    )
    with op.batch_alter_table('organization_invitations', schema=None) as batch_op:
        batch_op.create_index('idx_invitation_email', ['email'], unique=False)
        batch_op.create_index('idx_invitation_token', ['token'], unique=False)

    op.create_table('packages',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('short_description', sa.String(length=255), nullable=True),
    sa.Column('package_type', sa.String(length=20), nullable=False),
    sa.Column('duration_days', sa.Integer(), nullable=True),
    sa.Column('price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('discount_price', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('currency', sa.String(length=3), nullable=True),
    sa.Column('features', sa.JSON(), nullable=True),
    sa.Column('max_courses', sa.Integer(), nullable=True),
    sa.Column('max_downloads', sa.Integer(), nullable=True),
    sa.Column('max_live_sessions', sa.Integer(), nullable=True),
    sa.Column('ai_questions_per_day', sa.Integer(), nullable=True),
    sa.Column('ai_questions_per_month', sa.Integer(), nullable=True),
    sa.Column('course_ids', sa.JSON(), nullable=True),
    sa.Column('category_ids', sa.JSON(), nullable=True),
    sa.Column('all_courses_access', sa.Boolean(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('is_published', sa.Boolean(), nullable=True),
    sa.Column('is_featured', sa.Boolean(), nullable=True),
    sa.Column('display_order', sa.Integer(), nullable=True),
    sa.Column('total_subscribers', sa.Integer(), nullable=True),
    sa.Column('total_revenue', sa.Numeric(precision=15, scale=2), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.CheckConstraint("duration_days > 0 OR package_type = 'lifetime'", name='ck_packages_duration_valid'),
    sa.CheckConstraint('discount_price IS NULL OR discount_price >= 0', name='ck_packages_discount_positive'),
    sa.CheckConstraint('price >= 0', name='ck_packages_price_positive'),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('packages', schema=None) as batch_op:
        batch_op.create_index('idx_packages_active_published', ['status', 'is_published'], unique=False)
        batch_op.create_index('idx_packages_status', ['status'], unique=False)
        batch_op.create_index('idx_packages_type', ['package_type'], unique=False)
        batch_op.create_index(batch_op.f('ix_packages_slug'), ['slug'], unique=True)

    op.create_table('system_announcements',
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('announcement_type', sa.String(length=20), nullable=True),
    sa.Column('starts_at', sa.DateTime(), nullable=True),
    sa.Column('ends_at', sa.DateTime(), nullable=True),
    sa.Column('target_roles', sa.JSON(), nullable=True),
    sa.Column('target_user_ids', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_dismissible', sa.Boolean(), nullable=True),
    sa.Column('show_on_dashboard', sa.Boolean(), nullable=True),
    sa.Column('show_on_login', sa.Boolean(), nullable=True),
    sa.Column('view_count', sa.Integer(), nullable=True),
    sa.Column('dismiss_count', sa.Integer(), nullable=True),
    sa.Column('created_by_id', sa.Integer(), nullable=False),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['created_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('system_announcements', schema=None) as batch_op:
        batch_op.create_index('ix_announcements_active', ['is_active', 'starts_at', 'ends_at'], unique=False)
        batch_op.create_index('ix_announcements_target', ['target_roles'], unique=False)
        batch_op.create_index(batch_op.f('ix_system_announcements_created_at'), ['created_at'], unique=False)

    op.create_table('system_settings',
    sa.Column('key', sa.String(length=100), nullable=False),
    sa.Column('value', sa.Text(), nullable=True),
    sa.Column('default_value', sa.Text(), nullable=True),
    sa.Column('category', sa.String(length=50), nullable=False),
    sa.Column('setting_type', sa.String(length=20), nullable=False),
    sa.Column('label', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('help_text', sa.String(length=500), nullable=True),
    sa.Column('validation_rules', sa.JSON(), nullable=True),
    sa.Column('allowed_values', sa.JSON(), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('is_editable', sa.Boolean(), nullable=True),
    sa.Column('requires_restart', sa.Boolean(), nullable=True),
    sa.Column('display_order', sa.Integer(), nullable=True),
    sa.Column('updated_by_id', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['updated_by_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('key')
    )
    with op.batch_alter_table('system_settings', schema=None) as batch_op:
        batch_op.create_index('ix_system_settings_category', ['category'], unique=False)
        batch_op.create_index(batch_op.f('ix_system_settings_created_at'), ['created_at'], unique=False)
        batch_op.create_index('ix_system_settings_key', ['key'], unique=True)

    op.create_table('ai_chat_messages',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('session_id', sa.Integer(), nullable=False),
    sa.Column('role', sa.String(length=20), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('tokens_used', sa.Integer(), nullable=True),
    sa.Column('extra_data', sa.Text(), nullable=True),
    sa.Column('feedback_rating', sa.Integer(), nullable=True),
    sa.Column('feedback_text', sa.Text(), nullable=True),
    sa.Column('is_anonymized', sa.Boolean(), nullable=True),
    sa.Column('original_content_hash', sa.String(length=64), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['ai_chat_sessions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('ai_prompt_usage_logs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('template_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=True),
    sa.Column('session_id', sa.Integer(), nullable=True),
    sa.Column('variables_used', sa.JSON(), nullable=True),
    sa.Column('tokens_input', sa.Integer(), nullable=True),
    sa.Column('tokens_output', sa.Integer(), nullable=True),
    sa.Column('response_time_ms', sa.Integer(), nullable=True),
    sa.Column('success', sa.Boolean(), nullable=True),
    sa.Column('error_type', sa.String(length=50), nullable=True),
    sa.Column('error_message', sa.String(length=500), nullable=True),
    sa.Column('feedback_rating', sa.Integer(), nullable=True),
    sa.Column('feedback_helpful', sa.Boolean(), nullable=True),
    sa.Column('ab_test_group', sa.String(length=20), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['session_id'], ['ai_chat_sessions.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['ai_prompt_templates.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('ai_prompt_usage_logs', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_ai_prompt_usage_logs_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_prompt_usage_logs_template_id'), ['template_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_ai_prompt_usage_logs_user_id'), ['user_id'], unique=False)

    op.create_table('coaching_notes',
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('coach_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('note_type', sa.String(length=50), nullable=True),
    sa.Column('is_visible_to_student', sa.Boolean(), nullable=True),
    sa.Column('follow_up_date', sa.DateTime(), nullable=True),
    sa.Column('is_follow_up_completed', sa.Boolean(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(), nullable=True),
    sa.Column('deleted_by_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['coach_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['deleted_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('coaching_notes', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_coaching_notes_coach_id'), ['coach_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_coaching_notes_course_id'), ['course_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_coaching_notes_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_coaching_notes_deleted_at'), ['deleted_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_coaching_notes_is_deleted'), ['is_deleted'], unique=False)
        batch_op.create_index(batch_op.f('ix_coaching_notes_student_id'), ['student_id'], unique=False)

    op.create_table('content_approvals',
    sa.Column('content_category', sa.Enum('VIDEO', 'DOCUMENT', 'QUIZ', 'LIVE_SESSION', 'ASSIGNMENT', name='contentcategory'), nullable=False),
    sa.Column('content_id', sa.Integer(), nullable=False),
    sa.Column('previous_status', sa.Enum('DRAFT', 'PENDING_REVIEW', 'APPROVED', 'REJECTED', 'PUBLISHED', 'ARCHIVED', name='contentstatus'), nullable=False),
    sa.Column('new_status', sa.Enum('DRAFT', 'PENDING_REVIEW', 'APPROVED', 'REJECTED', 'PUBLISHED', 'ARCHIVED', name='contentstatus'), nullable=False),
    sa.Column('reviewed_by_id', sa.Integer(), nullable=False),
    sa.Column('reviewed_at', sa.DateTime(), nullable=False),
    sa.Column('rejection_reason', sa.Enum('INAPPROPRIATE_CONTENT', 'LOW_QUALITY', 'DUPLICATE', 'COPYRIGHT_VIOLATION', 'INCOMPLETE', 'TECHNICAL_ISSUE', 'OTHER', name='rejectionreason'), nullable=True),
    sa.Column('rejection_details', sa.Text(), nullable=True),
    sa.Column('reviewer_notes', sa.Text(), nullable=True),
    sa.Column('version_id', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['reviewed_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['version_id'], ['content_versions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('content_approvals', schema=None) as batch_op:
        batch_op.create_index('ix_content_approvals_content', ['content_category', 'content_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_approvals_content_category'), ['content_category'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_approvals_content_id'), ['content_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_content_approvals_created_at'), ['created_at'], unique=False)
        batch_op.create_index('ix_content_approvals_reviewed_at', ['reviewed_at'], unique=False)

    op.create_table('enrollments',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('progress_percent', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('last_accessed_at', sa.DateTime(), nullable=True),
    sa.Column('payment_id', sa.String(length=100), nullable=True),
    sa.Column('amount_paid', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('enrolled_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'course_id', name='unique_enrollment')
    )
    op.create_table('evaluations',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('teacher_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('rating', sa.Integer(), nullable=True),
    sa.Column('feedback', sa.Text(), nullable=True),
    sa.Column('strengths', sa.JSON(), nullable=True),
    sa.Column('improvements', sa.JSON(), nullable=True),
    sa.Column('goals', sa.JSON(), nullable=True),
    sa.Column('performance_data', sa.JSON(), nullable=True),
    sa.Column('is_visible_to_student', sa.Boolean(), nullable=True),
    sa.Column('evaluation_date', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['teacher_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('performance_reviews',
    sa.Column('student_id', sa.Integer(), nullable=False),
    sa.Column('reviewer_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=True),
    sa.Column('period_start', sa.DateTime(), nullable=False),
    sa.Column('period_end', sa.DateTime(), nullable=False),
    sa.Column('overall_score', sa.Float(), nullable=True),
    sa.Column('attendance_rate', sa.Float(), nullable=True),
    sa.Column('assignment_completion_rate', sa.Float(), nullable=True),
    sa.Column('exam_average', sa.Float(), nullable=True),
    sa.Column('engagement_score', sa.Integer(), nullable=True),
    sa.Column('participation_score', sa.Integer(), nullable=True),
    sa.Column('improvement_score', sa.Integer(), nullable=True),
    sa.Column('strengths', sa.Text(), nullable=True),
    sa.Column('areas_for_improvement', sa.Text(), nullable=True),
    sa.Column('recommendations', sa.Text(), nullable=True),
    sa.Column('is_published', sa.Boolean(), nullable=True),
    sa.Column('published_at', sa.DateTime(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['reviewer_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['student_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('performance_reviews', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_performance_reviews_course_id'), ['course_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_performance_reviews_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_performance_reviews_student_id'), ['student_id'], unique=False)

    op.create_table('topics',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('order_index', sa.Integer(), nullable=True),
    sa.Column('is_published', sa.Boolean(), nullable=True),
    sa.Column('is_free_preview', sa.Boolean(), nullable=True),
    sa.Column('total_videos', sa.Integer(), nullable=True),
    sa.Column('total_questions', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('user_packages',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('package_id', sa.Integer(), nullable=False),
    sa.Column('starts_at', sa.DateTime(), nullable=False),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('subscription_status', sa.String(length=20), nullable=False),
    sa.Column('payment_status', sa.String(length=20), nullable=True),
    sa.Column('payment_method', sa.String(length=50), nullable=True),
    sa.Column('payment_reference', sa.String(length=100), nullable=True),
    sa.Column('transaction_id', sa.String(length=100), nullable=True),
    sa.Column('amount_paid', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=True),
    sa.Column('discount_code', sa.String(length=50), nullable=True),
    sa.Column('discount_amount', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('auto_renew', sa.Boolean(), nullable=True),
    sa.Column('renewal_reminder_sent', sa.Boolean(), nullable=True),
    sa.Column('cancelled_at', sa.DateTime(), nullable=True),
    sa.Column('cancellation_reason', sa.Text(), nullable=True),
    sa.Column('last_accessed_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['package_id'], ['packages.id'], ondelete='RESTRICT'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'package_id', 'starts_at', name='uq_user_package_subscription')
    )
    with op.batch_alter_table('user_packages', schema=None) as batch_op:
        batch_op.create_index('idx_user_packages_active_expires', ['subscription_status', 'expires_at'], unique=False)
        batch_op.create_index('idx_user_packages_expires', ['expires_at'], unique=False)
        batch_op.create_index('idx_user_packages_package', ['package_id'], unique=False)
        batch_op.create_index('idx_user_packages_status', ['subscription_status'], unique=False)
        batch_op.create_index('idx_user_packages_user', ['user_id'], unique=False)
        batch_op.create_index('idx_user_packages_user_status', ['user_id', 'subscription_status'], unique=False)
        batch_op.create_index(batch_op.f('ix_user_packages_transaction_id'), ['transaction_id'], unique=False)

    op.create_table('assignments',
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('instructions', sa.Text(), nullable=True),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('topic_id', sa.Integer(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('DRAFT', 'PUBLISHED', 'CLOSED', name='assignmentstatus'), nullable=False),
    sa.Column('due_date', sa.DateTime(), nullable=True),
    sa.Column('available_from', sa.DateTime(), nullable=True),
    sa.Column('max_score', sa.Float(), nullable=True),
    sa.Column('pass_score', sa.Float(), nullable=True),
    sa.Column('allow_late_submission', sa.Boolean(), nullable=True),
    sa.Column('late_penalty_percent', sa.Float(), nullable=True),
    sa.Column('max_file_size_mb', sa.Integer(), nullable=True),
    sa.Column('allowed_file_types', sa.String(length=255), nullable=True),
    sa.Column('submission_count', sa.Integer(), nullable=True),
    sa.Column('average_score', sa.Float(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(), nullable=True),
    sa.Column('deleted_by_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['deleted_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['topic_id'], ['topics.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('assignments', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_assignments_course_id'), ['course_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignments_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignments_deleted_at'), ['deleted_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignments_due_date'), ['due_date'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignments_is_deleted'), ['is_deleted'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignments_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignments_topic_id'), ['topic_id'], unique=False)

    op.create_table('documents',
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('file_url', sa.String(length=500), nullable=False),
    sa.Column('file_name', sa.String(length=255), nullable=False),
    sa.Column('file_size', sa.Integer(), nullable=True),
    sa.Column('file_type', sa.Enum('PDF', 'DOC', 'SLIDE', 'SPREADSHEET', 'OTHER', name='documenttype'), nullable=False),
    sa.Column('mime_type', sa.String(length=100), nullable=True),
    sa.Column('topic_id', sa.Integer(), nullable=False),
    sa.Column('uploaded_by', sa.Integer(), nullable=True),
    sa.Column('is_downloadable', sa.Boolean(), nullable=True),
    sa.Column('order', sa.Integer(), nullable=True),
    sa.Column('download_count', sa.Integer(), nullable=True),
    sa.Column('content_status', sa.Enum('DRAFT', 'PENDING_REVIEW', 'APPROVED', 'REJECTED', 'PUBLISHED', 'ARCHIVED', name='contentstatus'), nullable=False),
    sa.Column('current_version', sa.Integer(), nullable=True),
    sa.Column('submitted_for_review_at', sa.DateTime(), nullable=True),
    sa.Column('approved_at', sa.DateTime(), nullable=True),
    sa.Column('approved_by_id', sa.Integer(), nullable=True),
    sa.Column('published_at', sa.DateTime(), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('extra_data', sa.JSON(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(), nullable=True),
    sa.Column('deleted_by_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['deleted_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['topic_id'], ['topics.id'], ),
    sa.ForeignKeyConstraint(['uploaded_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('documents', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_documents_content_status'), ['content_status'], unique=False)
        batch_op.create_index(batch_op.f('ix_documents_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_documents_deleted_at'), ['deleted_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_documents_is_deleted'), ['is_deleted'], unique=False)
        batch_op.create_index('ix_documents_status_content', ['content_status', 'is_deleted'], unique=False)
        batch_op.create_index(batch_op.f('ix_documents_topic_id'), ['topic_id'], unique=False)
        batch_op.create_index('ix_documents_topic_order', ['topic_id', 'order'], unique=False)
        batch_op.create_index('ix_documents_uploaded_by', ['uploaded_by'], unique=False)

    op.create_table('exams',
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('instructions', sa.Text(), nullable=True),
    sa.Column('exam_type', sa.Enum('QUIZ', 'MIDTERM', 'FINAL', 'PRACTICE', 'HOMEWORK', name='examtype'), nullable=False),
    sa.Column('status', sa.Enum('DRAFT', 'PUBLISHED', 'CLOSED', 'ARCHIVED', name='examstatus'), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('topic_id', sa.Integer(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=False),
    sa.Column('duration_minutes', sa.Integer(), nullable=True),
    sa.Column('pass_score', sa.Float(), nullable=True),
    sa.Column('max_attempts', sa.Integer(), nullable=True),
    sa.Column('shuffle_questions', sa.Boolean(), nullable=True),
    sa.Column('shuffle_answers', sa.Boolean(), nullable=True),
    sa.Column('show_answers_after', sa.Boolean(), nullable=True),
    sa.Column('available_from', sa.DateTime(), nullable=True),
    sa.Column('available_until', sa.DateTime(), nullable=True),
    sa.Column('total_questions', sa.Integer(), nullable=True),
    sa.Column('total_points', sa.Float(), nullable=True),
    sa.Column('average_score', sa.Float(), nullable=True),
    sa.Column('attempt_count', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(), nullable=True),
    sa.Column('deleted_by_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['deleted_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['topic_id'], ['topics.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('exams', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_exams_course_id'), ['course_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_exams_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_exams_deleted_at'), ['deleted_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_exams_is_deleted'), ['is_deleted'], unique=False)
        batch_op.create_index(batch_op.f('ix_exams_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_exams_topic_id'), ['topic_id'], unique=False)

    op.create_table('live_sessions',
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('topic_id', sa.Integer(), nullable=True),
    sa.Column('host_id', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('DRAFT', 'SCHEDULED', 'LIVE', 'ENDED', 'CANCELLED', name='sessionstatus'), nullable=False),
    sa.Column('platform', sa.Enum('ZOOM', 'GOOGLE_MEET', 'MICROSOFT_TEAMS', 'JITSI', 'WEBEX', 'CUSTOM', name='sessionplatform'), nullable=False),
    sa.Column('meeting_url', sa.String(length=500), nullable=False),
    sa.Column('meeting_id', sa.String(length=100), nullable=True),
    sa.Column('meeting_password', sa.String(length=50), nullable=True),
    sa.Column('access_token', sa.String(length=64), nullable=True),
    sa.Column('scheduled_start', sa.DateTime(), nullable=False),
    sa.Column('scheduled_end', sa.DateTime(), nullable=False),
    sa.Column('actual_start', sa.DateTime(), nullable=True),
    sa.Column('actual_end', sa.DateTime(), nullable=True),
    sa.Column('duration_minutes', sa.Integer(), nullable=True),
    sa.Column('recurrence_type', sa.Enum('NONE', 'DAILY', 'WEEKLY', 'BIWEEKLY', 'MONTHLY', name='recurrencetype'), nullable=False),
    sa.Column('recurrence_end_date', sa.DateTime(), nullable=True),
    sa.Column('parent_session_id', sa.Integer(), nullable=True),
    sa.Column('max_participants', sa.Integer(), nullable=True),
    sa.Column('is_recording_enabled', sa.Boolean(), nullable=True),
    sa.Column('recording_url', sa.String(length=500), nullable=True),
    sa.Column('require_enrollment', sa.Boolean(), nullable=True),
    sa.Column('require_registration', sa.Boolean(), nullable=True),
    sa.Column('early_join_minutes', sa.Integer(), nullable=True),
    sa.Column('late_join_allowed', sa.Boolean(), nullable=True),
    sa.Column('late_join_minutes', sa.Integer(), nullable=True),
    sa.Column('reminder_sent', sa.Boolean(), nullable=True),
    sa.Column('reminder_24h_sent', sa.Boolean(), nullable=True),
    sa.Column('reminder_1h_sent', sa.Boolean(), nullable=True),
    sa.Column('participant_count', sa.Integer(), nullable=True),
    sa.Column('peak_participants', sa.Integer(), nullable=True),
    sa.Column('materials', sa.JSON(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(), nullable=True),
    sa.Column('deleted_by_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ),
    sa.ForeignKeyConstraint(['deleted_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['host_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['parent_session_id'], ['live_sessions.id'], ),
    sa.ForeignKeyConstraint(['topic_id'], ['topics.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('live_sessions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_live_sessions_access_token'), ['access_token'], unique=True)
        batch_op.create_index(batch_op.f('ix_live_sessions_course_id'), ['course_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_sessions_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_sessions_deleted_at'), ['deleted_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_sessions_host_id'), ['host_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_sessions_is_deleted'), ['is_deleted'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_sessions_scheduled_start'), ['scheduled_start'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_sessions_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_live_sessions_topic_id'), ['topic_id'], unique=False)

    op.create_table('student_progress',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('course_id', sa.Integer(), nullable=False),
    sa.Column('topic_id', sa.Integer(), nullable=True),
    sa.Column('videos_total', sa.Integer(), nullable=True),
    sa.Column('videos_completed', sa.Integer(), nullable=True),
    sa.Column('total_watch_time_seconds', sa.Integer(), nullable=True),
    sa.Column('questions_total', sa.Integer(), nullable=True),
    sa.Column('questions_attempted', sa.Integer(), nullable=True),
    sa.Column('questions_correct', sa.Integer(), nullable=True),
    sa.Column('exams_total', sa.Integer(), nullable=True),
    sa.Column('exams_attempted', sa.Integer(), nullable=True),
    sa.Column('exams_passed', sa.Integer(), nullable=True),
    sa.Column('best_exam_score', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('average_exam_score', sa.Numeric(precision=5, scale=2), nullable=True),
    sa.Column('total_points', sa.Integer(), nullable=True),
    sa.Column('last_activity_at', sa.DateTime(), nullable=True),
    sa.Column('streak_days', sa.Integer(), nullable=True),
    sa.Column('last_streak_date', sa.Date(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['course_id'], ['courses.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['topic_id'], ['topics.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'course_id', 'topic_id', name='unique_student_topic_progress')
    )
    op.create_table('videos',
    sa.Column('title', sa.String(length=255), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('order', sa.Integer(), nullable=False),
    sa.Column('provider', sa.Enum('YOUTUBE', 'VIMEO', 'LOCAL', 'BUNNY', name='videoprovider'), nullable=False),
    sa.Column('video_id', sa.String(length=255), nullable=True),
    sa.Column('video_url', sa.String(length=500), nullable=True),
    sa.Column('thumbnail_url', sa.String(length=500), nullable=True),
    sa.Column('duration', sa.Integer(), nullable=True),
    sa.Column('status', sa.Enum('PROCESSING', 'READY', 'ERROR', name='videostatus'), nullable=False),
    sa.Column('content_status', sa.Enum('DRAFT', 'PENDING_REVIEW', 'APPROVED', 'REJECTED', 'PUBLISHED', 'ARCHIVED', name='contentstatus'), nullable=False),
    sa.Column('topic_id', sa.Integer(), nullable=False),
    sa.Column('uploaded_by', sa.Integer(), nullable=True),
    sa.Column('is_free_preview', sa.Boolean(), nullable=True),
    sa.Column('is_downloadable', sa.Boolean(), nullable=True),
    sa.Column('view_count', sa.Integer(), nullable=True),
    sa.Column('current_version', sa.Integer(), nullable=True),
    sa.Column('submitted_for_review_at', sa.DateTime(), nullable=True),
    sa.Column('approved_at', sa.DateTime(), nullable=True),
    sa.Column('approved_by_id', sa.Integer(), nullable=True),
    sa.Column('published_at', sa.DateTime(), nullable=True),
    sa.Column('tags', sa.JSON(), nullable=True),
    sa.Column('extra_data', sa.JSON(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('is_deleted', sa.Boolean(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(), nullable=True),
    sa.Column('deleted_by_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['deleted_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['topic_id'], ['topics.id'], ),
    sa.ForeignKeyConstraint(['uploaded_by'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('videos', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_videos_content_status'), ['content_status'], unique=False)
        batch_op.create_index(batch_op.f('ix_videos_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_videos_deleted_at'), ['deleted_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_videos_is_deleted'), ['is_deleted'], unique=False)
        batch_op.create_index('ix_videos_status_content', ['content_status', 'is_deleted'], unique=False)
        batch_op.create_index(batch_op.f('ix_videos_topic_id'), ['topic_id'], unique=False)
        batch_op.create_index('ix_videos_topic_order', ['topic_id', 'order'], unique=False)
        batch_op.create_index('ix_videos_uploaded_by', ['uploaded_by'], unique=False)

    op.create_table('assignment_submissions',
    sa.Column('assignment_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('submission_text', sa.Text(), nullable=True),
    sa.Column('file_url', sa.String(length=500), nullable=True),
    sa.Column('file_name', sa.String(length=255), nullable=True),
    sa.Column('status', sa.Enum('SUBMITTED', 'GRADING', 'GRADED', 'RETURNED', name='submissionstatus'), nullable=False),
    sa.Column('is_late', sa.Boolean(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(), nullable=False),
    sa.Column('score', sa.Float(), nullable=True),
    sa.Column('feedback', sa.Text(), nullable=True),
    sa.Column('graded_at', sa.DateTime(), nullable=True),
    sa.Column('graded_by', sa.Integer(), nullable=True),
    sa.Column('revision_count', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['assignment_id'], ['assignments.id'], ),
    sa.ForeignKeyConstraint(['graded_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('assignment_id', 'user_id', name='unique_assignment_user')
    )
    with op.batch_alter_table('assignment_submissions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_assignment_submissions_assignment_id'), ['assignment_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignment_submissions_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignment_submissions_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_assignment_submissions_user_id'), ['user_id'], unique=False)

    op.create_table('exam_attempts',
    sa.Column('exam_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('IN_PROGRESS', 'SUBMITTED', 'GRADED', 'TIMED_OUT', name='attemptstatus'), nullable=False),
    sa.Column('started_at', sa.DateTime(), nullable=False),
    sa.Column('submitted_at', sa.DateTime(), nullable=True),
    sa.Column('graded_at', sa.DateTime(), nullable=True),
    sa.Column('score', sa.Float(), nullable=True),
    sa.Column('max_score', sa.Float(), nullable=True),
    sa.Column('percentage', sa.Float(), nullable=True),
    sa.Column('passed', sa.Boolean(), nullable=True),
    sa.Column('question_order', sa.JSON(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['exam_id'], ['exams.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('exam_attempts', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_exam_attempts_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_exam_attempts_exam_id'), ['exam_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_exam_attempts_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_exam_attempts_user_id'), ['user_id'], unique=False)

    op.create_table('questions',
    sa.Column('question_text', sa.Text(), nullable=False),
    sa.Column('question_type', sa.Enum('SINGLE_CHOICE', 'MULTIPLE_CHOICE', 'TRUE_FALSE', 'SHORT_ANSWER', 'ESSAY', 'FILL_BLANK', name='questiontype'), nullable=False),
    sa.Column('image_url', sa.String(length=500), nullable=True),
    sa.Column('explanation', sa.Text(), nullable=True),
    sa.Column('points', sa.Float(), nullable=True),
    sa.Column('order', sa.Integer(), nullable=True),
    sa.Column('exam_id', sa.Integer(), nullable=False),
    sa.Column('correct_answer_text', sa.Text(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['exam_id'], ['exams.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('questions', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_questions_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_questions_exam_id'), ['exam_id'], unique=False)

    op.create_table('session_attendances',
    sa.Column('session_id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('status', sa.Enum('REGISTERED', 'JOINED', 'LEFT', 'ABSENT', name='attendancestatus'), nullable=False),
    sa.Column('registered_at', sa.DateTime(), nullable=True),
    sa.Column('joined_at', sa.DateTime(), nullable=True),
    sa.Column('left_at', sa.DateTime(), nullable=True),
    sa.Column('duration_minutes', sa.Integer(), nullable=True),
    sa.Column('join_count', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['live_sessions.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('session_id', 'user_id', name='unique_session_user')
    )
    with op.batch_alter_table('session_attendances', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_session_attendances_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_session_attendances_session_id'), ['session_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_session_attendances_status'), ['status'], unique=False)
        batch_op.create_index(batch_op.f('ix_session_attendances_user_id'), ['user_id'], unique=False)

    op.create_table('video_progress',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('video_id', sa.Integer(), nullable=False),
    sa.Column('watched_seconds', sa.Integer(), nullable=True),
    sa.Column('last_position', sa.Integer(), nullable=True),
    sa.Column('is_completed', sa.Boolean(), nullable=True),
    sa.Column('watch_count', sa.Integer(), nullable=True),
    sa.Column('first_watched_at', sa.DateTime(), nullable=True),
    sa.Column('last_watched_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['video_id'], ['videos.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'video_id', name='unique_video_progress')
    )
    op.create_table('answers',
    sa.Column('answer_text', sa.Text(), nullable=False),
    sa.Column('is_correct', sa.Boolean(), nullable=True),
    sa.Column('order', sa.Integer(), nullable=True),
    sa.Column('question_id', sa.Integer(), nullable=False),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['question_id'], ['questions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('answers', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_answers_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_answers_question_id'), ['question_id'], unique=False)

    op.create_table('attempt_answers',
    sa.Column('attempt_id', sa.Integer(), nullable=False),
    sa.Column('question_id', sa.Integer(), nullable=False),
    sa.Column('selected_answer_ids', sa.JSON(), nullable=True),
    sa.Column('answer_text', sa.Text(), nullable=True),
    sa.Column('is_correct', sa.Boolean(), nullable=True),
    sa.Column('points_earned', sa.Float(), nullable=True),
    sa.Column('grader_comment', sa.Text(), nullable=True),
    sa.Column('graded_by', sa.Integer(), nullable=True),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['attempt_id'], ['exam_attempts.id'], ),
    sa.ForeignKeyConstraint(['graded_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['question_id'], ['questions.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    with op.batch_alter_table('attempt_answers', schema=None) as batch_op:
        batch_op.create_index(batch_op.f('ix_attempt_answers_attempt_id'), ['attempt_id'], unique=False)
        batch_op.create_index(batch_op.f('ix_attempt_answers_created_at'), ['created_at'], unique=False)
        batch_op.create_index(batch_op.f('ix_attempt_answers_question_id'), ['question_id'], unique=False)

    op.create_table('question_attempts',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('question_id', sa.Integer(), nullable=False),
    sa.Column('selected_answer_ids', sa.JSON(), nullable=True),
    sa.Column('text_answer', sa.Text(), nullable=True),
    sa.Column('answer_data', sa.JSON(), nullable=True),
    sa.Column('is_correct', sa.Boolean(), nullable=False),
    sa.Column('points_earned', sa.Float(), nullable=True),
    sa.Column('max_points', sa.Float(), nullable=True),
    sa.Column('feedback', sa.Text(), nullable=True),
    sa.Column('grading_details', sa.JSON(), nullable=True),
    sa.Column('time_spent_seconds', sa.Integer(), nullable=True),
    sa.Column('hint_used', sa.Boolean(), nullable=True),
    sa.Column('context_type', sa.String(length=20), nullable=True),
    sa.Column('context_id', sa.Integer(), nullable=True),
    sa.Column('graded_by', sa.Integer(), nullable=True),
    sa.Column('graded_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['graded_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['question_id'], ['questions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('question_attempts')
    with op.batch_alter_table('attempt_answers', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_attempt_answers_question_id'))
        batch_op.drop_index(batch_op.f('ix_attempt_answers_created_at'))
        batch_op.drop_index(batch_op.f('ix_attempt_answers_attempt_id'))

    op.drop_table('attempt_answers')
    with op.batch_alter_table('answers', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_answers_question_id'))
        batch_op.drop_index(batch_op.f('ix_answers_created_at'))

    op.drop_table('answers')
    op.drop_table('video_progress')
    with op.batch_alter_table('session_attendances', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_session_attendances_user_id'))
        batch_op.drop_index(batch_op.f('ix_session_attendances_status'))
        batch_op.drop_index(batch_op.f('ix_session_attendances_session_id'))
        batch_op.drop_index(batch_op.f('ix_session_attendances_created_at'))

    op.drop_table('session_attendances')
    with op.batch_alter_table('questions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_questions_exam_id'))
        batch_op.drop_index(batch_op.f('ix_questions_created_at'))

    op.drop_table('questions')
    with op.batch_alter_table('exam_attempts', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_exam_attempts_user_id'))
        batch_op.drop_index(batch_op.f('ix_exam_attempts_status'))
        batch_op.drop_index(batch_op.f('ix_exam_attempts_exam_id'))
        batch_op.drop_index(batch_op.f('ix_exam_attempts_created_at'))

    op.drop_table('exam_attempts')
    with op.batch_alter_table('assignment_submissions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_assignment_submissions_user_id'))
        batch_op.drop_index(batch_op.f('ix_assignment_submissions_status'))
        batch_op.drop_index(batch_op.f('ix_assignment_submissions_created_at'))
        batch_op.drop_index(batch_op.f('ix_assignment_submissions_assignment_id'))

    op.drop_table('assignment_submissions')
    with op.batch_alter_table('videos', schema=None) as batch_op:
        batch_op.drop_index('ix_videos_uploaded_by')
        batch_op.drop_index('ix_videos_topic_order')
        batch_op.drop_index(batch_op.f('ix_videos_topic_id'))
        batch_op.drop_index('ix_videos_status_content')
        batch_op.drop_index(batch_op.f('ix_videos_is_deleted'))
        batch_op.drop_index(batch_op.f('ix_videos_deleted_at'))
        batch_op.drop_index(batch_op.f('ix_videos_created_at'))
        batch_op.drop_index(batch_op.f('ix_videos_content_status'))

    op.drop_table('videos')
    op.drop_table('student_progress')
    with op.batch_alter_table('live_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_live_sessions_topic_id'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_status'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_scheduled_start'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_is_deleted'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_host_id'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_deleted_at'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_created_at'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_course_id'))
        batch_op.drop_index(batch_op.f('ix_live_sessions_access_token'))

    op.drop_table('live_sessions')
    with op.batch_alter_table('exams', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_exams_topic_id'))
        batch_op.drop_index(batch_op.f('ix_exams_status'))
        batch_op.drop_index(batch_op.f('ix_exams_is_deleted'))
        batch_op.drop_index(batch_op.f('ix_exams_deleted_at'))
        batch_op.drop_index(batch_op.f('ix_exams_created_at'))
        batch_op.drop_index(batch_op.f('ix_exams_course_id'))

    op.drop_table('exams')
    with op.batch_alter_table('documents', schema=None) as batch_op:
        batch_op.drop_index('ix_documents_uploaded_by')
        batch_op.drop_index('ix_documents_topic_order')
        batch_op.drop_index(batch_op.f('ix_documents_topic_id'))
        batch_op.drop_index('ix_documents_status_content')
        batch_op.drop_index(batch_op.f('ix_documents_is_deleted'))
        batch_op.drop_index(batch_op.f('ix_documents_deleted_at'))
        batch_op.drop_index(batch_op.f('ix_documents_created_at'))
        batch_op.drop_index(batch_op.f('ix_documents_content_status'))

    op.drop_table('documents')
    with op.batch_alter_table('assignments', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_assignments_topic_id'))
        batch_op.drop_index(batch_op.f('ix_assignments_status'))
        batch_op.drop_index(batch_op.f('ix_assignments_is_deleted'))
        batch_op.drop_index(batch_op.f('ix_assignments_due_date'))
        batch_op.drop_index(batch_op.f('ix_assignments_deleted_at'))
        batch_op.drop_index(batch_op.f('ix_assignments_created_at'))
        batch_op.drop_index(batch_op.f('ix_assignments_course_id'))

    op.drop_table('assignments')
    with op.batch_alter_table('user_packages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_user_packages_transaction_id'))
        batch_op.drop_index('idx_user_packages_user_status')
        batch_op.drop_index('idx_user_packages_user')
        batch_op.drop_index('idx_user_packages_status')
        batch_op.drop_index('idx_user_packages_package')
        batch_op.drop_index('idx_user_packages_expires')
        batch_op.drop_index('idx_user_packages_active_expires')

    op.drop_table('user_packages')
    op.drop_table('topics')
    with op.batch_alter_table('performance_reviews', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_performance_reviews_student_id'))
        batch_op.drop_index(batch_op.f('ix_performance_reviews_created_at'))
        batch_op.drop_index(batch_op.f('ix_performance_reviews_course_id'))

    op.drop_table('performance_reviews')
    op.drop_table('evaluations')
    op.drop_table('enrollments')
    with op.batch_alter_table('content_approvals', schema=None) as batch_op:
        batch_op.drop_index('ix_content_approvals_reviewed_at')
        batch_op.drop_index(batch_op.f('ix_content_approvals_created_at'))
        batch_op.drop_index(batch_op.f('ix_content_approvals_content_id'))
        batch_op.drop_index(batch_op.f('ix_content_approvals_content_category'))
        batch_op.drop_index('ix_content_approvals_content')

    op.drop_table('content_approvals')
    with op.batch_alter_table('coaching_notes', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_coaching_notes_student_id'))
        batch_op.drop_index(batch_op.f('ix_coaching_notes_is_deleted'))
        batch_op.drop_index(batch_op.f('ix_coaching_notes_deleted_at'))
        batch_op.drop_index(batch_op.f('ix_coaching_notes_created_at'))
        batch_op.drop_index(batch_op.f('ix_coaching_notes_course_id'))
        batch_op.drop_index(batch_op.f('ix_coaching_notes_coach_id'))

    op.drop_table('coaching_notes')
    with op.batch_alter_table('ai_prompt_usage_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_prompt_usage_logs_user_id'))
        batch_op.drop_index(batch_op.f('ix_ai_prompt_usage_logs_template_id'))
        batch_op.drop_index(batch_op.f('ix_ai_prompt_usage_logs_created_at'))

    op.drop_table('ai_prompt_usage_logs')
    op.drop_table('ai_chat_messages')
    with op.batch_alter_table('system_settings', schema=None) as batch_op:
        batch_op.drop_index('ix_system_settings_key')
        batch_op.drop_index(batch_op.f('ix_system_settings_created_at'))
        batch_op.drop_index('ix_system_settings_category')

    op.drop_table('system_settings')
    with op.batch_alter_table('system_announcements', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_system_announcements_created_at'))
        batch_op.drop_index('ix_announcements_target')
        batch_op.drop_index('ix_announcements_active')

    op.drop_table('system_announcements')
    with op.batch_alter_table('packages', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_packages_slug'))
        batch_op.drop_index('idx_packages_type')
        batch_op.drop_index('idx_packages_status')
        batch_op.drop_index('idx_packages_active_published')

    op.drop_table('packages')
    with op.batch_alter_table('organization_invitations', schema=None) as batch_op:
        batch_op.drop_index('idx_invitation_token')
        batch_op.drop_index('idx_invitation_email')

    op.drop_table('organization_invitations')
    with op.batch_alter_table('notifications', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_notifications_user_id'))
        batch_op.drop_index(batch_op.f('ix_notifications_is_read'))
        batch_op.drop_index(batch_op.f('ix_notifications_created_at'))

    op.drop_table('notifications')
    with op.batch_alter_table('courses', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_courses_is_published'))

    op.drop_table('courses')
    with op.batch_alter_table('content_versions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_versions_is_current'))
        batch_op.drop_index('ix_content_versions_current')
        batch_op.drop_index(batch_op.f('ix_content_versions_created_at'))
        batch_op.drop_index(batch_op.f('ix_content_versions_content_id'))
        batch_op.drop_index(batch_op.f('ix_content_versions_content_category'))
        batch_op.drop_index('ix_content_versions_content')

    op.drop_table('content_versions')
    with op.batch_alter_table('content_progress', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_progress_user_id'))
        batch_op.drop_index(batch_op.f('ix_content_progress_is_completed'))
        batch_op.drop_index(batch_op.f('ix_content_progress_created_at'))
        batch_op.drop_index(batch_op.f('ix_content_progress_content_id'))

    op.drop_table('content_progress')
    with op.batch_alter_table('content_approval_queue', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_approval_queue_created_at'))
        batch_op.drop_index('ix_approval_queue_status')
        batch_op.drop_index('ix_approval_queue_priority')
        batch_op.drop_index('ix_approval_queue_content')
        batch_op.drop_index('ix_approval_queue_assigned')

    op.drop_table('content_approval_queue')
    with op.batch_alter_table('content_ai_suggestions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_ai_suggestions_suggested_by_id'))
        batch_op.drop_index(batch_op.f('ix_content_ai_suggestions_status'))
        batch_op.drop_index(batch_op.f('ix_content_ai_suggestions_created_at'))
        batch_op.drop_index(batch_op.f('ix_content_ai_suggestions_content_id'))
        batch_op.drop_index(batch_op.f('ix_content_ai_suggestions_content_category'))
        batch_op.drop_index('ix_ai_suggestions_status_date')
        batch_op.drop_index('ix_ai_suggestions_content')

    op.drop_table('content_ai_suggestions')
    with op.batch_alter_table('content_ai_interactions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_content_ai_interactions_user_id'))
        batch_op.drop_index(batch_op.f('ix_content_ai_interactions_created_at'))
        batch_op.drop_index(batch_op.f('ix_content_ai_interactions_content_id'))
        batch_op.drop_index('ix_ai_interactions_user_date')
        batch_op.drop_index('ix_ai_interactions_expires')
        batch_op.drop_index('ix_ai_interactions_content')

    op.drop_table('content_ai_interactions')
    with op.batch_alter_table('audit_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_audit_logs_user_id'))
        batch_op.drop_index('idx_audit_logs_user_created')
        batch_op.drop_index('idx_audit_logs_user_action')
        batch_op.drop_index('idx_audit_logs_user')
        batch_op.drop_index('idx_audit_logs_severity')
        batch_op.drop_index('idx_audit_logs_session')
        batch_op.drop_index('idx_audit_logs_resource_action')
        batch_op.drop_index('idx_audit_logs_resource')
        batch_op.drop_index('idx_audit_logs_created_severity')
        batch_op.drop_index('idx_audit_logs_created')
        batch_op.drop_index('idx_audit_logs_action')

    op.drop_table('audit_logs')
    with op.batch_alter_table('ai_violations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_violations_violation_type'))
        batch_op.drop_index(batch_op.f('ix_ai_violations_user_id'))
        batch_op.drop_index(batch_op.f('ix_ai_violations_created_at'))

    op.drop_table('ai_violations')
    with op.batch_alter_table('ai_usage_summaries', schema=None) as batch_op:
        batch_op.drop_index('ix_usage_summary_period')
        batch_op.drop_index(batch_op.f('ix_ai_usage_summaries_user_id'))

    op.drop_table('ai_usage_summaries')
    with op.batch_alter_table('ai_usage_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_usage_logs_user_id'))
        batch_op.drop_index(batch_op.f('ix_ai_usage_logs_feature'))
        batch_op.drop_index(batch_op.f('ix_ai_usage_logs_created_at'))

    op.drop_table('ai_usage_logs')
    op.drop_table('ai_quotas')
    with op.batch_alter_table('ai_prompt_templates', schema=None) as batch_op:
        batch_op.drop_index('ix_prompt_feature_status')
        batch_op.drop_index(batch_op.f('ix_ai_prompt_templates_status'))
        batch_op.drop_index(batch_op.f('ix_ai_prompt_templates_name'))
        batch_op.drop_index(batch_op.f('ix_ai_prompt_templates_feature'))
        batch_op.drop_index(batch_op.f('ix_ai_prompt_templates_created_at'))

    op.drop_table('ai_prompt_templates')
    op.drop_table('ai_data_retention_policies')
    with op.batch_alter_table('ai_configurations', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_configurations_key'))

    op.drop_table('ai_configurations')
    with op.batch_alter_table('ai_chat_sessions', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_ai_chat_sessions_session_id'))

    op.drop_table('ai_chat_sessions')
    with op.batch_alter_table('admin_action_logs', schema=None) as batch_op:
        batch_op.drop_index('ix_admin_logs_target')
        batch_op.drop_index('ix_admin_logs_created')
        batch_op.drop_index('ix_admin_logs_admin')
        batch_op.drop_index('ix_admin_logs_action')
        batch_op.drop_index(batch_op.f('ix_admin_action_logs_created_at'))

    op.drop_table('admin_action_logs')
    with op.batch_alter_table('users', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_users_verification_token'))
        batch_op.drop_index(batch_op.f('ix_users_role_id'))
        batch_op.drop_index(batch_op.f('ix_users_password_reset_token'))
        batch_op.drop_index(batch_op.f('ix_users_organization_id'))
        batch_op.drop_index(batch_op.f('ix_users_is_deleted'))
        batch_op.drop_index(batch_op.f('ix_users_is_active'))
        batch_op.drop_index(batch_op.f('ix_users_email'))
        batch_op.drop_index('idx_users_verified_active')
        batch_op.drop_index('idx_users_role_active')
        batch_op.drop_index('idx_users_organization')
        batch_op.drop_index('idx_users_last_login')
        batch_op.drop_index('idx_users_created')

    op.drop_table('users')
    op.drop_table('role_permissions')
    with op.batch_alter_table('token_blacklist', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_token_blacklist_jti'))

    op.drop_table('token_blacklist')
    with op.batch_alter_table('security_events', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_security_events_user_id'))
        batch_op.drop_index(batch_op.f('ix_security_events_severity'))
        batch_op.drop_index(batch_op.f('ix_security_events_is_resolved'))
        batch_op.drop_index(batch_op.f('ix_security_events_ip_address'))
        batch_op.drop_index(batch_op.f('ix_security_events_event_type'))
        batch_op.drop_index(batch_op.f('ix_security_events_created_at'))

    op.drop_table('security_events')
    op.drop_table('roles')
    with op.batch_alter_table('request_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_request_logs_user_id'))
        batch_op.drop_index(batch_op.f('ix_request_logs_status_code'))
        batch_op.drop_index(batch_op.f('ix_request_logs_request_id'))
        batch_op.drop_index(batch_op.f('ix_request_logs_is_slow'))
        batch_op.drop_index(batch_op.f('ix_request_logs_endpoint'))
        batch_op.drop_index(batch_op.f('ix_request_logs_created_at'))

    op.drop_table('request_logs')
    op.drop_table('permissions')
    with op.batch_alter_table('performance_metrics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_performance_metrics_metric_type'))
        batch_op.drop_index(batch_op.f('ix_performance_metrics_is_slow'))
        batch_op.drop_index(batch_op.f('ix_performance_metrics_endpoint'))
        batch_op.drop_index(batch_op.f('ix_performance_metrics_created_at'))

    op.drop_table('performance_metrics')
    with op.batch_alter_table('organizations', schema=None) as batch_op:
        batch_op.drop_index('idx_org_status')
        batch_op.drop_index('idx_org_slug')
        batch_op.drop_index('idx_org_active')

    op.drop_table('organizations')
    with op.batch_alter_table('error_logs', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_error_logs_severity'))
        batch_op.drop_index(batch_op.f('ix_error_logs_is_resolved'))
        batch_op.drop_index(batch_op.f('ix_error_logs_fingerprint'))
        batch_op.drop_index(batch_op.f('ix_error_logs_error_type'))
        batch_op.drop_index(batch_op.f('ix_error_logs_endpoint'))
        batch_op.drop_index(batch_op.f('ix_error_logs_created_at'))

    op.drop_table('error_logs')
    op.drop_table('categories')
    op.drop_table('ai_data_retention_logs')
    with op.batch_alter_table('aggregated_metrics', schema=None) as batch_op:
        batch_op.drop_index(batch_op.f('ix_aggregated_metrics_period_start'))
        batch_op.drop_index(batch_op.f('ix_aggregated_metrics_metric_name'))

    op.drop_table('aggregated_metrics')
    # ### end Alembic commands ###
